import{e as l,j as E}from"../../../../../chunks/index2.js";import{M as g}from"../../../../../chunks/musicResponsiveListItemRenderer.js";import{i as h}from"../../../../../chunks/utils.js";import"../../../../../chunks/index.js";import{b as Q}from"../../../../../chunks/request.js";const y={all:"",songs:"EgWKAQIIAWoKEAMQBBAJEAoQBQ%3D%3D",videos:"EgWKAQIQAWoKEAMQBBAJEAoQBQ%3D%3D",albums:"EgWKAQIYAWoKEAMQBBAJEAoQBQ%3D%3D",artists:"EgWKAQIgAWoKEAMQBBAJEAoQBQ%3D%3D",community_playlists:"EgeKAQQoAEABagwQDhAKEAkQAxAEEAU%3D",featured_playlists:"EgeKAQQoADgBagwQDhAKEAMQBBAJEAU%3D",all_playlists:"EgWKAQIoAWoKEAMQBBAKEAUQCQ%3D%3D"},K=async({url:i})=>{const n=i.searchParams,a=n.get("q")??"",o=n.get("filter")??void 0,s=n.get("ctoken")??"",e=n.get("itct")??"",r=y[o]??void 0;try{const t=await Q("search",{context:{client:{clientName:"WEB_REMIX",clientVersion:"1.20220404.01.00"}},params:{browseId:"",query:decodeURIComponent(a),params:o!=="all"?`${r}`:void 0},headers:null,continuation:s!==""?{continuation:s,ctoken:s,itct:`${e}`,type:"next"}:void 0});if(!t)throw l(500,"Failed to send the search request");if(!t.ok)throw l(t.status,t.statusText);const c=await t.json();console.log("RESPONSE",c);const m=Array.isArray(c?.contents?.tabbedSearchResultsRenderer?.tabs)&&c?.contents?.tabbedSearchResultsRenderer?.tabs[0]?.tabRenderer?.content?.sectionListRenderer?.contents,p=c?.continuationContents?.musicShelfContinuation,A=s!==""?b(p,o):f(m,o);return console.log("RESULTS",A),E(A)}catch(t){throw console.error(t),l(500,t)}};function b(i,n){const a=x;Array.isArray(i?.continuations)&&i?.continuations[0]?.nextContinuationData;const o=n.includes("playlists")?"playlists":n,s=d(i.contents,o);return{continuation:a,results:s,type:"next"}}function f(i=[],n){const a=[],o={};let s=i.length;for(;--s>-1;){const e={contents:[],header:{title:""}},r=i[s];if(r&&r.itemSectionRenderer)continue;const t=r.musicShelfRenderer;if(t){const c=Array.isArray(t.contents)&&t.contents;if(Array.isArray(t?.continuations)&&t?.continuations[0].nextContinuationData&&Object.assign(o,t.continuations[0].nextContinuationData),t.title&&(e.header.title=t.title?.runs[0]?.text),c){const u=d(c,e.header?.title?.toLowerCase().replace(/\s/gm,"_"));e.contents=u}a.unshift(e)}}return{results:a,continuation:o}}function d(i,n){const a=[];let o=i.length;for(;--o>-1;){const s=i[o],e=g(s),r=n==="top_result"&&e.endpoint?.pageType?.match(/SINGLE|ALBUM/i)?"albums":n;if(Object.assign(e,{type:r}),r.includes("playlists")||r==="albums"){let t="";h(e.subtitle,c=>t+=c.text),Object.assign(e,{metaData:t,browseId:s.musicResponsiveListItemRenderer?.navigationEndpoint?.browseEndpoint?.browseId,playlistId:s.musicResponsiveListItemRenderer.menu?.menuRenderer?.items[0]?.menuNavigationItemRenderer?.navigationEndpoint?.watchPlaylistEndpoint?.playlistId})}n==="songs"&&Object.assign(e,{album:e.subtitle.at(-3).pageType?.includes("ALBUM")&&e.subtitle.at(-3)}),a.unshift(e)}return a}export{K as GET};
