function Je(Te,Fe){for(var De=0;De<Fe.length;De++){const xe=Fe[De];if(typeof xe!="string"&&!Array.isArray(xe)){for(const ie in xe)if(ie!=="default"&&!(ie in Te)){const Ae=Object.getOwnPropertyDescriptor(xe,ie);Ae&&Object.defineProperty(Te,ie,Ae.get?Ae:{enumerable:!0,get:()=>xe[ie]})}}}return Object.freeze(Object.defineProperty(Te,Symbol.toStringTag,{value:"Module"}))}var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function et(Te){return Te&&Te.__esModule&&Object.prototype.hasOwnProperty.call(Te,"default")?Te.default:Te}var we={exports:{}};(function(Te,Fe){typeof window<"u"&&function(xe,ie){Te.exports=ie()}(qe,()=>(()=>{var De={"./src/config.ts":(W,B,L)=>{L.r(B),L.d(B,{enableStreamingMode:()=>v,hlsDefaultConfig:()=>r,mergeConfig:()=>o});var b=L("./src/controller/abr-controller.ts"),D=L("./src/controller/audio-stream-controller.ts"),P=L("./src/controller/audio-track-controller.ts"),I=L("./src/controller/subtitle-stream-controller.ts"),M=L("./src/controller/subtitle-track-controller.ts"),A=L("./src/controller/buffer-controller.ts"),x=L("./src/controller/timeline-controller.ts"),S=L("./src/controller/cap-level-controller.ts"),m=L("./src/controller/fps-controller.ts"),E=L("./src/controller/eme-controller.ts"),_=L("./src/controller/cmcd-controller.ts"),y=L("./src/utils/xhr-loader.ts"),p=L("./src/utils/fetch-loader.ts"),l=L("./src/utils/cues.ts"),n=L("./src/utils/mediakeys-helper.ts"),t=L("./src/utils/logger.ts");function u(){return u=Object.assign?Object.assign.bind():function(s){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var a in d)Object.prototype.hasOwnProperty.call(d,a)&&(s[a]=d[a])}return s},u.apply(this,arguments)}function h(s,c){var d=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);c&&(a=a.filter(function(g){return Object.getOwnPropertyDescriptor(s,g).enumerable})),d.push.apply(d,a)}return d}function i(s){for(var c=1;c<arguments.length;c++){var d=arguments[c]!=null?arguments[c]:{};c%2?h(Object(d),!0).forEach(function(a){e(s,a,d[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(d)):h(Object(d)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(d,a))})}return s}function e(s,c,d){return c in s?Object.defineProperty(s,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):s[c]=d,s}var r=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:b.default,bufferController:A.default,capLevelController:S.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:n.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},f()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:M.default,timelineController:x.TimelineController,audioStreamController:D.default,audioTrackController:P.default,emeController:E.default,cmcdController:_.default});function f(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function o(s,c){if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(c.liveMaxLatencyDurationCount!==void 0&&(c.liveSyncDurationCount===void 0||c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(c.liveMaxLatencyDuration!==void 0&&(c.liveSyncDuration===void 0||c.liveMaxLatencyDuration<=c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return u({},s,c)}function v(s){var c=s.loader;if(c!==p.default&&c!==y.default)t.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var d=(0,p.fetchSupported)();d&&(s.loader=p.default,s.progressive=!0,s.enableSoftwareAES=!0,t.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>E});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/ewma-bandwidth-estimator.ts"),P=L("./src/events.ts"),I=L("./src/errors.ts"),M=L("./src/types/loader.ts"),A=L("./src/utils/logger.ts");function x(_,y){for(var p=0;p<y.length;p++){var l=y[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(_,l.key,l)}}function S(_,y,p){return y&&x(_.prototype,y),p&&x(_,p),Object.defineProperty(_,"prototype",{writable:!1}),_}var m=function(){function _(p){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=p;var l=p.config;this.bwEstimator=new D.default(l.abrEwmaSlowVoD,l.abrEwmaFastVoD,l.abrEwmaDefaultEstimate),this.registerListeners()}var y=_.prototype;return y.registerListeners=function(){var l=this.hls;l.on(P.Events.FRAG_LOADING,this.onFragLoading,this),l.on(P.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(P.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var l=this.hls;l.off(P.Events.FRAG_LOADING,this.onFragLoading,this),l.off(P.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(P.Events.ERROR,this.onError,this)},y.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},y.onFragLoading=function(l,n){var t=n.frag;if(t.type===M.PlaylistLevelType.MAIN&&!this.timer){var u;this.fragCurrent=t,this.partCurrent=(u=n.part)!=null?u:null,this.timer=self.setInterval(this.onCheck,100)}},y.onLevelLoaded=function(l,n){var t=this.hls.config;n.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},y._abandonRulesCheck=function(){var l=this.fragCurrent,n=this.partCurrent,t=this.hls,u=t.autoLevelEnabled;t.config;var h=t.media;if(!(!l||!h)){var i=n?n.stats:l.stats,e=n?n.duration:l.duration;if(i.aborted||i.loaded&&i.loaded===i.total||l.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!u||h.paused||!h.playbackRate||!h.readyState)){var r=t.mainForwardBufferInfo;if(r!==null){var f=performance.now()-i.loading.start,o=Math.abs(h.playbackRate);if(!(f<=500*e/o)){var v=i.loaded&&i.loading.first,s=this.bwEstimator.getEstimate(),c=t.levels,d=t.minAutoLevel,a=c[l.level],g=i.total||Math.max(i.loaded,Math.round(e*a.maxBitrate/8)),T=v?i.loaded*1e3/f:0,R=T?(g-i.loaded)/T:g*8/s,C=r.len/o;if(!(R<=C)){var O=Number.POSITIVE_INFINITY,F;for(F=l.level-1;F>d;F--){var U=c[F].maxBitrate;if(O=T?e*U/(8*.8*T):e*U/s,O<C)break}O>=R||(A.logger.warn("Fragment "+l.sn+(n?" part "+n.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+((0,b.isFiniteNumber)(s)?(s/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+O.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),t.nextLoadLevel=F,v&&this.bwEstimator.sample(f,i.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),t.trigger(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:n,stats:i}))}}}}}},y.onFragLoaded=function(l,n){var t=n.frag,u=n.part;if(t.type===M.PlaylistLevelType.MAIN&&(0,b.isFiniteNumber)(t.sn)){var h=u?u.stats:t.stats,i=u?u.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var e=this.hls.levels[t.level],r=(e.loaded?e.loaded.bytes:0)+h.loaded,f=(e.loaded?e.loaded.duration:0)+i;e.loaded={bytes:r,duration:f},e.realBitrate=Math.round(8*r/f)}if(t.bitrateTest){var o={stats:h,frag:t,part:u,id:t.type};this.onFragBuffered(P.Events.FRAG_BUFFERED,o)}}},y.onFragBuffered=function(l,n){var t=n.frag,u=n.part,h=u?u.stats:t.stats;if(!h.aborted&&!(t.type!==M.PlaylistLevelType.MAIN||t.sn==="initSegment")){var i=h.parsing.end-h.loading.start;this.bwEstimator.sample(i,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},y.onError=function(l,n){switch(n.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},y.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},y.getNextABRAutoLevel=function(){var l=this.fragCurrent,n=this.partCurrent,t=this.hls,u=t.maxAutoLevel,h=t.config,i=t.minAutoLevel,e=t.media,r=n?n.duration:l?l.duration:0;e&&e.currentTime;var f=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,v=t.mainForwardBufferInfo,s=(v?v.len:0)/f,c=this.findBestLevel(o,i,u,s,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(c>=0)return c;A.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=r?Math.min(r,h.maxStarvationDelay):h.maxStarvationDelay,a=h.abrBandWidthFactor,g=h.abrBandWidthUpFactor;if(!s){var T=this.bitrateTestDelay;if(T){var R=r?Math.min(r,h.maxLoadingDelay):h.maxLoadingDelay;d=R-T,A.logger.trace("bitrate test took "+Math.round(1e3*T)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),a=g=1}}return c=this.findBestLevel(o,i,u,s+d,a,g),Math.max(c,0)},y.findBestLevel=function(l,n,t,u,h,i){for(var e,r=this.fragCurrent,f=this.partCurrent,o=this.lastLoadedFragLevel,v=this.hls.levels,s=v[o],c=!!(s!=null&&(e=s.details)!==null&&e!==void 0&&e.live),d=s==null?void 0:s.codecSet,a=f?f.duration:r?r.duration:0,g=t;g>=n;g--){var T=v[g];if(!(!T||d&&T.codecSet!==d)){var R=T.details,C=(f?R==null?void 0:R.partTarget:R==null?void 0:R.averagetargetduration)||a,O=void 0;g<=o?O=h*l:O=i*l;var F=v[g].maxBitrate,U=F*C/O;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(O)+"/"+F+"/"+C+"/"+u+"/"+U),O>F&&(U===0||!(0,b.isFiniteNumber)(U)||c&&!this.bitrateTestDelay||U<u))return g}}return-1},S(_,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,n=this.bwEstimator;if(l!==-1&&!n.canEstimate())return l;var t=this.getNextABRAutoLevel();return l!==-1&&this.hls.levels[t].loadError?l:(l!==-1&&(t=Math.min(l,t)),t)},set:function(l){this._nextAutoLevel=l}}]),_}();const E=m},"./src/controller/audio-stream-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>e});var b=L("./src/polyfills/number.ts"),D=L("./src/controller/base-stream-controller.ts"),P=L("./src/events.ts"),I=L("./src/utils/buffer-helper.ts"),M=L("./src/controller/fragment-tracker.ts"),A=L("./src/types/level.ts"),x=L("./src/types/loader.ts"),S=L("./src/loader/fragment.ts"),m=L("./src/demux/chunk-cache.ts"),E=L("./src/demux/transmuxer-interface.ts"),_=L("./src/types/transmuxer.ts"),y=L("./src/controller/fragment-finders.ts"),p=L("./src/utils/discontinuities.ts"),l=L("./src/errors.ts");function n(){return n=Object.assign?Object.assign.bind():function(r){for(var f=1;f<arguments.length;f++){var o=arguments[f];for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&(r[v]=o[v])}return r},n.apply(this,arguments)}function t(r,f){r.prototype=Object.create(f.prototype),r.prototype.constructor=r,u(r,f)}function u(r,f){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,s){return v.__proto__=s,v},u(r,f)}var h=100,i=function(r){t(f,r);function f(v,s){var c;return c=r.call(this,v,s,"[audio-stream-controller]")||this,c.videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c.cachedTrackLoadedData=null,c._registerListeners(),c}var o=f.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var s=this.hls;s.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(P.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(P.Events.ERROR,this.onError,this),s.on(P.Events.BUFFER_RESET,this.onBufferReset,this),s.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(P.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var s=this.hls;s.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(P.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(P.Events.ERROR,this.onError,this),s.off(P.Events.BUFFER_RESET,this.onBufferReset,this),s.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(P.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onInitPtsFound=function(s,c){var d=c.frag,a=c.id,g=c.initPTS;if(a==="main"){var T=d.cc;this.initPTS[d.cc]=g,this.log("InitPTS for cc: "+T+" found from main: "+g),this.videoTrackCC=T,this.state===D.State.WAITING_INIT_PTS&&this.tick()}},o.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=D.State.STOPPED;return}var c=this.lastCurrentTime;this.stopLoad(),this.setInterval(h),this.fragLoadError=0,c>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),s=c,this.state=D.State.IDLE):(this.loadedmetadata=!1,this.state=D.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},o.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_TRACK:{var s,c=this.levels,d=this.trackId,a=c==null||(s=c[d])===null||s===void 0?void 0:s.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=D.State.WAITING_INIT_PTS}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var g,T=performance.now(),R=this.retryDate;(!R||T>=R||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=D.State.IDLE);break}case D.State.WAITING_INIT_PTS:{var C=this.waitingData;if(C){var O=C.frag,F=C.part,U=C.cache,k=C.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.FRAG_LOADING;var N=U.flush(),w={frag:O,part:F,payload:N,networkDetails:null};this._handleFragmentLoadProgress(w),k&&r.prototype._handleFragmentLoadComplete.call(this,w)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),G=I.BufferHelper.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole),H=(0,y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,O);H<0&&(this.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=D.State.IDLE}}this.onTickEnd()},o.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.IDLE)},o.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},o.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var c=this.mediaBuffer?this.mediaBuffer:s,d=c.buffered;!this.loadedmetadata&&d.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},o.doTickIdle=function(){var s,c,d=this.hls,a=this.levels,g=this.media,T=this.trackId,R=d.config;if(!(!a||!a[T])&&!(!g&&(this.startFragRequested||!R.startFragPrefetch))){var C=a[T],O=C.details;if(!O||O.live&&this.levelLastLoaded!==T||this.waitForCdnTuneIn(O)){this.state=D.State.WAITING_TRACK;return}var F=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&F&&(this.bufferFlushed=!1,this.afterBufferFlushed(F,S.ElementaryStreamTypes.AUDIO,x.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(F,x.PlaylistLevelType.AUDIO);if(U!==null){var k=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,x.PlaylistLevelType.MAIN),N=U.len,w=this.getMaxBufferLength(k==null?void 0:k.len),K=this.audioSwitch;if(!(N>=w&&!K)){if(!K&&this._streamEnded(U,O)){d.trigger(P.Events.BUFFER_EOS,{type:"audio"}),this.state=D.State.ENDED;return}var G=O.fragments,H=G[0].start,V=U.end;if(K&&g){var X=this.getLoadPosition();V=X,O.PTSKnown&&X<H&&(U.end>H||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),g.currentTime=H+.05)}if(!(k&&V>k.end+O.targetduration)&&!((!k||!k.len)&&U.len)){var Y=this.getNextFragment(V,O);if(!Y){this.bufferFlushed=!0;return}((s=Y.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((c=Y.decryptdata)!==null&&c!==void 0&&c.key)?this.loadKey(Y,O):this.loadFragment(Y,O,V)}}}}},o.getMaxBufferLength=function(s){var c=r.prototype.getMaxBufferLength.call(this);return s?Math.max(c,s):c},o.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},o.onAudioTracksUpdated=function(s,c){var d=c.audioTracks;this.resetTransmuxer(),this.levels=d.map(function(a){return new A.Level(a)})},o.onAudioTrackSwitching=function(s,c){var d=!!c.url;this.trackId=c.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(h):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=D.State.IDLE):this.state=D.State.STOPPED,this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},o.onLevelLoaded=function(s,c){this.mainDetails=c.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(P.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},o.onAudioTrackLoaded=function(s,c){var d;if(this.mainDetails==null){this.cachedTrackLoadedData=c;return}var a=this.levels,g=c.details,T=c.id;if(!a){this.warn("Audio tracks were reset while loading level "+T);return}this.log("Track "+T+" loaded ["+g.startSN+","+g.endSN+"],duration:"+g.totalduration);var R=a[T],C=0;if(g.live||(d=R.details)!==null&&d!==void 0&&d.live){var O=this.mainDetails;if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed||!O)return;!R.details&&g.hasProgramDateTime&&O.hasProgramDateTime?((0,p.alignMediaPlaylistByPDT)(g,O),C=g.fragments[0].start):C=this.alignPlaylists(g,R.details)}R.details=g,this.levelLastLoaded=T,!this.startFragRequested&&(this.mainDetails||!g.live)&&this.setStartPosition(R.details,C),this.state===D.State.WAITING_TRACK&&!this.waitForCdnTuneIn(g)&&(this.state=D.State.IDLE),this.tick()},o._handleFragmentLoadProgress=function(s){var c,d=s.frag,a=s.part,g=s.payload,T=this.config,R=this.trackId,C=this.levels;if(!C){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var O=C[R];console.assert(O,"Audio track is defined on fragment load progress");var F=O.details;console.assert(F,"Audio track details are defined on fragment load progress");var U=T.defaultAudioCodec||O.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new E.default(this.hls,x.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[d.cc],w=(c=d.initSegment)===null||c===void 0?void 0:c.data;if(N!==void 0){var K=!1,G=a?a.index:-1,H=G!==-1,V=new _.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,g.byteLength,G,H);k.push(g,w,U,"",d,a,F.totalduration,K,V,N)}else{this.log("Unknown video PTS for cc "+d.cc+", waiting for video PTS before demuxing audio frag "+d.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+R);var X=this.waitingData=this.waitingData||{frag:d,part:a,cache:new m.default,complete:!1},Y=X.cache;Y.push(new Uint8Array(g)),this.waitingVideoCC=this.videoTrackCC,this.state=D.State.WAITING_INIT_PTS}},o._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}r.prototype._handleFragmentLoadComplete.call(this,s)},o.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},o.onBufferCreated=function(s,c){var d=c.tracks.audio;d&&(this.mediaBuffer=d.buffer||null),c.tracks.video&&(this.videoBuffer=c.tracks.video.buffer||null)},o.onFragBuffered=function(s,c){var d=c.frag,a=c.part;if(d.type===x.PlaylistLevelType.AUDIO){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(a?" p: "+a.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}d.sn!=="initSegment"&&(this.fragPrevious=d,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(P.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(d,a)}},o.onError=function(s,c){switch(c.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.AUDIO,c);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==D.State.ERROR&&this.state!==D.State.STOPPED&&(this.state=c.fatal?D.State.ERROR:D.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="audio"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var d=!0,a=this.getFwdBufferInfo(this.mediaBuffer,x.PlaylistLevelType.AUDIO);a&&a.len>.5&&(d=!this.reduceMaxBufferLength(a.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},o.onBufferFlushed=function(s,c){var d=c.type;d===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},o._handleTransmuxComplete=function(s){var c,d="audio",a=this.hls,g=s.remuxResult,T=s.chunkMeta,R=this.getCurrentContext(T);if(!R){this.warn("The loading context changed while buffering fragment "+T.sn+" of level "+T.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(T.level);return}var C=R.frag,O=R.part,F=R.level.details,U=g.audio,k=g.text,N=g.id3,w=g.initSegment;if(!(this.fragContextChanged(C)||!F)){if(this.state=D.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),w!=null&&w.tracks&&(this._bufferInitSegment(w.tracks,C,T),a.trigger(P.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:d,tracks:w.tracks})),U){var K=U.startPTS,G=U.endPTS,H=U.startDTS,V=U.endDTS;O&&(O.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:G,startDTS:H,endDTS:V}),C.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,K,G,H,V),this.bufferFragmentData(U,C,O,T)}if(N!=null&&(c=N.samples)!==null&&c!==void 0&&c.length){var X=n({id:d,frag:C,details:F},N);a.trigger(P.Events.FRAG_PARSING_METADATA,X)}if(k){var Y=n({id:d,frag:C,details:F},k);a.trigger(P.Events.FRAG_PARSING_USERDATA,Y)}}},o._bufferInitSegment=function(s,c,d){if(this.state===D.State.PARSING){s.video&&delete s.video;var a=s.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(P.Events.BUFFER_CODECS,s);var g=a.initSegment;if(g!=null&&g.byteLength){var T={type:"audio",frag:c,part:null,chunkMeta:d,parent:c.type,data:g};this.hls.trigger(P.Events.BUFFER_APPENDING,T)}this.tick()}}},o.loadFragment=function(s,c,d){var a=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||a===M.FragmentState.NOT_LOADED||a===M.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):c.live&&!(0,b.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=D.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,s,c,d)))},o.completeAudioSwitch=function(){var s=this.hls,c=this.media,d=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(P.Events.AUDIO_TRACK_SWITCHED,{id:d})},f}(D.default);const e=i},"./src/controller/audio-track-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>E});var b=L("./src/events.ts"),D=L("./src/errors.ts"),P=L("./src/controller/base-playlist-controller.ts"),I=L("./src/types/loader.ts");function M(_,y){for(var p=0;p<y.length;p++){var l=y[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(_,l.key,l)}}function A(_,y,p){return y&&M(_.prototype,y),p&&M(_,p),Object.defineProperty(_,"prototype",{writable:!1}),_}function x(_,y){_.prototype=Object.create(y.prototype),_.prototype.constructor=_,S(_,y)}function S(_,y){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,n){return l.__proto__=n,l},S(_,y)}var m=function(_){x(y,_);function y(l){var n;return n=_.call(this,l,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var p=y.prototype;return p.registerListeners=function(){var n=this.hls;n.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(b.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var n=this.hls;n.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(b.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(b.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,_.prototype.destroy.call(this)},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},p.onManifestParsed=function(n,t){this.tracks=t.audioTracks||[]},p.onAudioTrackLoaded=function(n,t){var u=t.id,h=t.details,i=this.tracksInGroup[u];if(!i){this.warn("Invalid audio track id "+u);return}var e=i.details;i.details=t.details,this.log("audioTrack "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,t,e))},p.onLevelLoading=function(n,t){this.switchLevel(t.level)},p.onLevelSwitching=function(n,t){this.switchLevel(t.level)},p.switchLevel=function(n){var t=this.hls.levels[n];if(t!=null&&t.audioGroupIds){var u=t.audioGroupIds[t.urlId];if(this.groupId!==u){this.groupId=u;var h=this.tracks.filter(function(e){return!u||e.groupId===u});this.selectDefaultTrack&&!h.some(function(e){return e.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var i={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(b.Events.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack()}}},p.onError=function(n,t){_.prototype.onError.call(this,n,t),!(t.fatal||!t.context)&&t.context.type===I.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},p.setAudioTrack=function(n){var t=this.tracksInGroup;if(n<0||n>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var u=t[this.trackId];this.log("Now switching to audio-track index "+n);var h=t[n],i=h.id,e=h.groupId,r=e===void 0?"":e,f=h.name,o=h.type,v=h.url;if(this.trackId=n,this.trackName=f,this.selectDefaultTrack=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHING,{id:i,groupId:r,name:f,type:o,url:v}),!(h.details&&!h.details.live)){var s=this.switchParams(h.url,u==null?void 0:u.details);this.loadPlaylist(s)}},p.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,u=this.findTrackId(t)||this.findTrackId();u!==-1?this.setAudioTrack(u):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},p.findTrackId=function(n){for(var t=this.tracksInGroup,u=0;u<t.length;u++){var h=t[u];if((!this.selectDefaultTrack||h.default)&&(!n||n===h.name))return h.id}return-1},p.loadPlaylist=function(n){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var u=t.id,h=t.groupId,i=t.url;if(n)try{i=n.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(b.Events.AUDIO_TRACK_LOADING,{url:i,id:u,groupId:h,deliveryDirectives:n||null})}},A(y,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),y}(P.default);const E=m},"./src/controller/base-playlist-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>A});var b=L("./src/polyfills/number.ts"),D=L("./src/types/level.ts"),P=L("./src/controller/level-helper.ts"),I=L("./src/utils/logger.ts"),M=L("./src/errors.ts"),A=function(){function x(m,E){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=I.logger.log.bind(I.logger,E+":"),this.warn=I.logger.warn.bind(I.logger,E+":"),this.hls=m}var S=x.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(E,_){_.fatal&&_.type===M.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(E,_){var y=_==null?void 0:_.renditionReports;if(y)for(var p=0;p<y.length;p++){var l=y[p],n=""+l.URI;if(n===E.slice(-n.length)){var t=parseInt(l["LAST-MSN"]),u=parseInt(l["LAST-PART"]);if(_&&this.hls.config.lowLatencyMode){var h=Math.min(_.age-_.partTarget,_.targetduration);u!==void 0&&h>_.partTarget&&(u+=1)}if((0,b.isFiniteNumber)(t))return new D.HlsUrlParameters(t,(0,b.isFiniteNumber)(u)?u:void 0,D.HlsSkip.No)}}},S.loadPlaylist=function(E){},S.shouldLoadTrack=function(E){return this.canLoad&&E&&!!E.url&&(!E.details||E.details.live)},S.playlistLoaded=function(E,_,y){var p=this,l=_.details,n=_.stats,t=n.loading.end?Math.max(0,self.performance.now()-n.loading.end):0;if(l.advancedDateTime=Date.now()-t,l.live||y!=null&&y.live){if(l.reloaded(y),y&&this.log("live playlist "+E+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),y&&l.fragments.length>0&&(0,P.mergeDetails)(y,l),!this.canLoad||!l.live)return;var u,h=void 0,i=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var e=this.hls.config.lowLatencyMode,r=l.lastPartSn,f=l.endSN,o=l.lastPartIndex,v=o!==-1,s=r===f,c=e?0:o;v?(h=s?f+1:r,i=s?c:o+1):h=f+1;var d=l.age,a=d+l.ageHeader,g=Math.min(a-l.partTarget,l.targetduration*1.5);if(g>0){if(y&&g>y.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+y.tuneInGoal+" to: "+g+" with playlist age: "+l.age),g=0;else{var T=Math.floor(g/l.targetduration);if(h+=T,i!==void 0){var R=Math.round(g%l.targetduration/l.partTarget);i+=R}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+d.toFixed(2)+"s goal: "+g+" skip sn "+T+" to part "+i)}l.tuneInGoal=g}if(u=this.getDeliveryDirectives(l,_.deliveryDirectives,h,i),e||!s){this.loadPlaylist(u);return}}else u=this.getDeliveryDirectives(l,_.deliveryDirectives,h,i);var C=(0,P.computeReloadInterval)(l,n);h!==void 0&&l.canBlockReload&&(C-=l.partTarget||1),this.log("reload live playlist "+E+" in "+Math.round(C)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(u)},C)}else this.clearTimer()},S.getDeliveryDirectives=function(E,_,y,p){var l=(0,D.getSkipValue)(E,y);return _!=null&&_.skip&&E.deltaUpdateFailed&&(y=_.msn,p=_.part,l=D.HlsSkip.No),new D.HlsUrlParameters(y,p,l)},S.retryLoadingOrFail=function(E){var _=this,y=this.hls.config,p=this.retryCount<y.levelLoadingMaxRetry;if(p){var l;if(this.retryCount++,E.details.indexOf("LoadTimeOut")>-1&&(l=E.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+E.details+'"'),this.loadPlaylist();else{var n=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return _.loadPlaylist()},n),this.warn("retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+E.details+'"')}}else this.warn('cannot recover from error "'+E.details+'"'),this.clearTimer(),E.fatal=!0;return p},x}()},"./src/controller/base-stream-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{State:()=>f,default:()=>o});var b=L("./src/polyfills/number.ts"),D=L("./src/task-loop.ts"),P=L("./src/controller/fragment-tracker.ts"),I=L("./src/utils/buffer-helper.ts"),M=L("./src/utils/logger.ts"),A=L("./src/events.ts"),x=L("./src/errors.ts"),S=L("./src/types/transmuxer.ts"),m=L("./src/utils/mp4-tools.ts"),E=L("./src/utils/discontinuities.ts"),_=L("./src/controller/fragment-finders.ts"),y=L("./src/controller/level-helper.ts"),p=L("./src/loader/fragment-loader.ts"),l=L("./src/crypt/decrypter.ts"),n=L("./src/utils/time-ranges.ts"),t=L("./src/types/loader.ts");function u(v,s){for(var c=0;c<s.length;c++){var d=s[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(v,d.key,d)}}function h(v,s,c){return s&&u(v.prototype,s),c&&u(v,c),Object.defineProperty(v,"prototype",{writable:!1}),v}function i(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function e(v,s){v.prototype=Object.create(s.prototype),v.prototype.constructor=v,r(v,s)}function r(v,s){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,a){return d.__proto__=a,d},r(v,s)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},o=function(v){e(s,v);function s(d,a,g){var T;return T=v.call(this)||this,T.hls=void 0,T.fragPrevious=null,T.fragCurrent=null,T.fragmentTracker=void 0,T.transmuxer=null,T._state=f.STOPPED,T.media=null,T.mediaBuffer=null,T.config=void 0,T.bitrateTest=!1,T.lastCurrentTime=0,T.nextLoadPosition=0,T.startPosition=0,T.loadedmetadata=!1,T.fragLoadError=0,T.retryDate=0,T.levels=null,T.fragmentLoader=void 0,T.levelLastLoaded=null,T.startFragRequested=!1,T.decrypter=void 0,T.initPTS=[],T.onvseeking=null,T.onvended=null,T.logPrefix="",T.log=void 0,T.warn=void 0,T.logPrefix=g,T.log=M.logger.log.bind(M.logger,g+":"),T.warn=M.logger.warn.bind(M.logger,g+":"),T.hls=d,T.fragmentLoader=new p.default(d.config),T.fragmentTracker=a,T.config=d.config,T.decrypter=new l.default(d,d.config),d.on(A.Events.KEY_LOADED,T.onKeyLoaded,i(T)),d.on(A.Events.LEVEL_SWITCHING,T.onLevelSwitching,i(T)),T}var c=s.prototype;return c.doTick=function(){this.onTickEnd()},c.onTickEnd=function(){},c.startLoad=function(a){},c.stopLoad=function(){this.fragmentLoader.abort();var a=this.fragCurrent;a&&this.fragmentTracker.removeFragment(a),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},c._streamEnded=function(a,g){var T=this.fragCurrent,R=this.fragmentTracker;if(!g.live&&T&&this.media&&T.sn>=g.endSN&&!a.nextStart){var C=g.partList;if(C!=null&&C.length){var O=C[C.length-1],F=I.BufferHelper.isBuffered(this.media,O.start+O.duration/2);return F}var U=R.getState(T);return U===P.FragmentState.PARTIAL||U===P.FragmentState.OK}return!1},c.onMediaAttached=function(a,g){var T=this.media=this.mediaBuffer=g.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),T.addEventListener("seeking",this.onvseeking),T.addEventListener("ended",this.onvended);var R=this.config;this.levels&&R.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(R.startPosition)},c.onMediaDetaching=function(){var a=this.media;a!=null&&a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&this.onvseeking&&this.onvended&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onMediaSeeking=function(){var a=this.config,g=this.fragCurrent,T=this.media,R=this.mediaBuffer,C=this.state,O=T?T.currentTime:0,F=I.BufferHelper.bufferInfo(R||T,O,a.maxBufferHole);if(this.log("media seeking to "+((0,b.isFiniteNumber)(O)?O.toFixed(3):O)+", state: "+C),C===f.ENDED)this.resetLoadingState();else if(g&&!F.len){var U=a.maxFragLookUpTolerance,k=g.start-U,N=g.start+g.duration+U,w=O>N;(O<k||w)&&(w&&g.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),g.loader.abort()),this.resetLoadingState())}T&&(this.lastCurrentTime=O),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=O),this.tickImmediate()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onKeyLoaded=function(a,g){if(!(this.state!==f.KEY_LOADING||g.frag!==this.fragCurrent||!this.levels)){this.state=f.IDLE;var T=this.levels[g.frag.level].details;T&&this.loadFragment(g.frag,T,g.frag.start)}},c.onLevelSwitching=function(a,g){this.fragLoadError=0},c.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(A.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},c.loadKey=function(a,g){this.log("Loading key for "+a.sn+" of ["+g.startSN+"-"+g.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+a.level),this.state=f.KEY_LOADING,this.fragCurrent=a,this.hls.trigger(A.Events.KEY_LOADING,{frag:a})},c.loadFragment=function(a,g,T){this._loadFragForPlayback(a,g,T)},c._loadFragForPlayback=function(a,g,T){var R=this,C=function(F){if(R.fragContextChanged(a)){R.warn("Fragment "+a.sn+(F.part?" p: "+F.part.index:"")+" of level "+a.level+" was dropped during download."),R.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,R._handleFragmentLoadProgress(F)};this._doFragLoad(a,g,T,C).then(function(O){if(O){R.fragLoadError=0;var F=R.state;if(R.fragContextChanged(a)){(F===f.FRAG_LOADING||!R.fragCurrent&&F===f.PARSING)&&(R.fragmentTracker.removeFragment(a),R.state=f.IDLE);return}"payload"in O&&(R.log("Loaded fragment "+a.sn+" of level "+a.level),R.hls.trigger(A.Events.FRAG_LOADED,O)),R._handleFragmentLoadComplete(O)}}).catch(function(O){R.state===f.STOPPED||R.state===f.ERROR||(R.warn(O),R.resetFragmentLoading(a))})},c.flushMainBuffer=function(a,g,T){if(T===void 0&&(T=null),!!(a-g)){var R={startOffset:a,endOffset:g,type:T};this.fragLoadError=0,this.hls.trigger(A.Events.BUFFER_FLUSHING,R)}},c._loadInitSegment=function(a){var g=this;this._doFragLoad(a).then(function(T){if(!T||g.fragContextChanged(a)||!g.levels)throw new Error("init load aborted");return T}).then(function(T){var R=g.hls,C=T.payload,O=a.decryptdata;if(C&&C.byteLength>0&&O&&O.key&&O.iv&&O.method==="AES-128"){var F=self.performance.now();return g.decrypter.webCryptoDecrypt(new Uint8Array(C),O.key.buffer,O.iv.buffer).then(function(U){var k=self.performance.now();return R.trigger(A.Events.FRAG_DECRYPTED,{frag:a,payload:U,stats:{tstart:F,tdecrypt:k}}),T.payload=U,T})}return T}).then(function(T){var R=g.fragCurrent,C=g.hls,O=g.levels;if(!O)throw new Error("init load aborted, missing levels");var F=O[a.level].details;console.assert(F,"Level details are defined when init segment is loaded");var U=a.stats;g.state=f.IDLE,g.fragLoadError=0,a.data=new Uint8Array(T.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),T.frag===R&&C.trigger(A.Events.FRAG_BUFFERED,{stats:U,frag:R,part:null,id:a.type}),g.tick()}).catch(function(T){g.state===f.STOPPED||g.state===f.ERROR||(g.warn(T),g.resetFragmentLoading(a))})},c.fragContextChanged=function(a){var g=this.fragCurrent;return!a||!g||a.level!==g.level||a.sn!==g.sn||a.urlId!==g.urlId},c.fragBufferedComplete=function(a,g){var T,R,C=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(g?" part: "+g.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+a.level+" "+(C?n.default.toString(I.BufferHelper.getBuffered(C)):"(detached)")),this.state=f.IDLE,C&&(!this.loadedmetadata&&C.buffered.length&&((T=this.fragCurrent)===null||T===void 0?void 0:T.sn)===((R=this.fragPrevious)===null||R===void 0?void 0:R.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},c.seekToStartPos=function(){},c._handleFragmentLoadComplete=function(a){var g=this.transmuxer;if(g){var T=a.frag,R=a.part,C=a.partsLoaded,O=!C||C.length===0||C.some(function(U){return!U}),F=new S.ChunkMetadata(T.level,T.sn,T.stats.chunkCount+1,0,R?R.index:-1,!O);g.flush(F)}},c._handleFragmentLoadProgress=function(a){},c._doFragLoad=function(a,g,T,R){var C=this;if(T===void 0&&(T=null),!this.levels)throw new Error("frag load aborted, missing levels");if(T=Math.max(a.start,T||0),this.config.lowLatencyMode&&g){var O=g.partList;if(O&&R){T>a.end&&g.fragmentHint&&(a=g.fragmentHint);var F=this.getNextPart(O,a,T);if(F>-1){var U=O[F];return this.log("Loading part sn: "+a.sn+" p: "+U.index+" cc: "+a.cc+" of playlist ["+g.startSN+"-"+g.endSN+"] parts [0-"+F+"-"+(O.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+a.level+", target: "+parseFloat(T.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=f.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:a,part:O[F],targetBufferTime:T}),this.doFragPartsLoad(a,O,F,R).catch(function(k){return C.handleFragLoadError(k)})}else if(!a.url||this.loadedEndOfParts(O,T))return Promise.resolve(null)}}return this.log("Loading fragment "+a.sn+" cc: "+a.cc+" "+(g?"of ["+g.startSN+"-"+g.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+a.level+", target: "+parseFloat(T.toFixed(3))),(0,b.isFiniteNumber)(a.sn)&&!this.bitrateTest&&(this.nextLoadPosition=a.start+a.duration),this.state=f.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:a,targetBufferTime:T}),this.fragmentLoader.load(a,R).catch(function(k){return C.handleFragLoadError(k)})},c.doFragPartsLoad=function(a,g,T,R){var C=this;return new Promise(function(O,F){var U=[],k=function N(w){var K=g[w];C.fragmentLoader.loadPart(a,K,R).then(function(G){U[K.index]=G;var H=G.part;C.hls.trigger(A.Events.FRAG_LOADED,G);var V=g[w+1];if(V&&V.fragment===a)N(w+1);else return O({frag:a,part:H,partsLoaded:U})}).catch(F)};k(T)})},c.handleFragLoadError=function(a){var g=a.data;return g&&g.details===x.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(g.frag,g.part):this.hls.trigger(A.Events.ERROR,g),null},c._handleTransmuxerFlush=function(a){var g=this.getCurrentContext(a);if(!g||this.state!==f.PARSING){this.fragCurrent||(this.state=f.IDLE);return}var T=g.frag,R=g.part,C=g.level,O=self.performance.now();T.stats.parsing.end=O,R&&(R.stats.parsing.end=O),this.updateLevelTiming(T,R,C,a.partial)},c.getCurrentContext=function(a){var g=this.levels,T=a.level,R=a.sn,C=a.part;if(!g||!g[T])return this.warn("Levels object was unset while buffering fragment "+R+" of level "+T+". The current chunk will not be buffered."),null;var O=g[T],F=C>-1?(0,y.getPartWith)(O,R,C):null,U=F?F.fragment:(0,y.getFragmentWithSN)(O,R,this.fragCurrent);return U?{frag:U,part:F,level:O}:null},c.bufferFragmentData=function(a,g,T,R){if(!(!a||this.state!==f.PARSING)){var C=a.data1,O=a.data2,F=C;if(C&&O&&(F=(0,m.appendUint8Array)(C,O)),!(!F||!F.length)){var U={type:a.type,frag:g,part:T,chunkMeta:R,parent:g.type,data:F};this.hls.trigger(A.Events.BUFFER_APPENDING,U),a.dropped&&a.independent&&!T&&this.flushBufferGap(g)}}},c.flushBufferGap=function(a){var g=this.media;if(g){if(!I.BufferHelper.isBuffered(g,g.currentTime)){this.flushMainBuffer(0,a.start);return}var T=g.currentTime,R=I.BufferHelper.bufferInfo(g,T,0),C=a.duration,O=Math.min(this.config.maxFragLookUpTolerance*2,C*.25),F=Math.max(Math.min(a.start-O,R.end-O),T+O);a.start-F>O&&this.flushMainBuffer(F,a.start)}},c.getFwdBufferInfo=function(a,g){var T=this.config,R=this.getLoadPosition();if(!(0,b.isFiniteNumber)(R))return null;var C=I.BufferHelper.bufferInfo(a,R,T.maxBufferHole);if(C.len===0&&C.nextStart!==void 0){var O=this.fragmentTracker.getBufferedFrag(R,g);if(O&&C.nextStart<O.end)return I.BufferHelper.bufferInfo(a,R,Math.max(C.nextStart,T.maxBufferHole))}return C},c.getMaxBufferLength=function(a){var g=this.config,T;return a?T=Math.max(8*g.maxBufferSize/a,g.maxBufferLength):T=g.maxBufferLength,Math.min(T,g.maxMaxBufferLength)},c.reduceMaxBufferLength=function(a){var g=this.config,T=a||g.maxBufferLength;return g.maxMaxBufferLength>=T?(g.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+g.maxMaxBufferLength+"s"),!0):!1},c.getNextFragment=function(a,g){var T=g.fragments,R=T.length;if(!R)return null;var C=this.config,O=T[0].start,F;if(g.live){var U=C.initialLiveManifestSize;if(R<U)return this.warn("Not enough fragments to start playback (have: "+R+", need: "+U+")"),null;!g.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(F=this.getInitialLiveFragment(g,T),this.startPosition=F?this.hls.liveSyncPosition||F.start:a)}else a<=O&&(F=T[0]);if(!F){var k=C.lowLatencyMode?g.partEnd:g.fragmentEnd;F=this.getFragmentAtPosition(a,k,g)}return this.mapToInitFragWhenRequired(F)},c.mapToInitFragWhenRequired=function(a){return a!=null&&a.initSegment&&!(a!=null&&a.initSegment.data)&&!this.bitrateTest?a.initSegment:a},c.getNextPart=function(a,g,T){for(var R=-1,C=!1,O=!0,F=0,U=a.length;F<U;F++){var k=a[F];if(O=O&&!k.independent,R>-1&&T<k.start)break;var N=k.loaded;!N&&(C||k.independent||O)&&k.fragment===g&&(R=F),C=N}return R},c.loadedEndOfParts=function(a,g){var T=a[a.length-1];return T&&g>T.start&&T.loaded},c.getInitialLiveFragment=function(a,g){var T=this.fragPrevious,R=null;if(T){if(a.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+T.programDateTime),R=(0,_.findFragmentByPDT)(g,T.endProgramDateTime,this.config.maxFragLookUpTolerance)),!R){var C=T.sn+1;if(C>=a.startSN&&C<=a.endSN){var O=g[C-a.startSN];T.cc===O.cc&&(R=O,this.log("Live playlist, switching playlist, load frag with next SN: "+R.sn))}R||(R=(0,_.findFragWithCC)(g,T.cc),R&&this.log("Live playlist, switching playlist, load frag with same CC: "+R.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(R=this.getFragmentAtPosition(F,this.bitrateTest?a.fragmentEnd:a.edge,a))}return R},c.getFragmentAtPosition=function(a,g,T){var R=this.config,C=this.fragPrevious,O=T.fragments,F=T.endSN,U=T.fragmentHint,k=R.maxFragLookUpTolerance,N=!!(R.lowLatencyMode&&T.partList&&U);N&&U&&!this.bitrateTest&&(O=O.concat(U),F=U.sn);var w;if(a<g){var K=a>g-k?0:k;w=(0,_.findFragmentByPTS)(C,O,a,K)}else w=O[O.length-1];if(w){var G=w.sn-T.startSN;if(this.fragmentTracker.getState(w)===P.FragmentState.OK&&(C=w),C&&w.sn===C.sn&&!N){var H=C&&w.level===C.level;if(H){var V=O[G+1];w.sn<F&&this.fragmentTracker.getState(V)!==P.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+V.sn),w=V):w=null}}}return w},c.synchronizeToLiveEdge=function(a){var g=this.config,T=this.media;if(T){var R=this.hls.liveSyncPosition,C=T.currentTime,O=a.fragments[0].start,F=a.edge,U=C>=O-g.maxFragLookUpTolerance&&C<=F;if(R!==null&&T.duration>R&&(C<R||!U)){var k=g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:g.liveMaxLatencyDurationCount*a.targetduration;(!U&&T.readyState<4||C<F-k)&&(this.loadedmetadata||(this.nextLoadPosition=R),T.readyState&&(this.warn("Playback: "+C.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+R.toFixed(3)),T.currentTime=R))}}},c.alignPlaylists=function(a,g){var T=this.levels,R=this.levelLastLoaded,C=this.fragPrevious,O=R!==null?T[R]:null,F=a.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var U=a.fragments[0].start,k=!g,N=a.alignedSliding&&(0,b.isFiniteNumber)(U);if(k||!N&&!U){(0,E.alignStream)(C,O,a);var w=a.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(g?g.startSN:"na")+"->"+a.startSN+" prev-sn: "+(C?C.sn:"na")+" fragments: "+F),w}return U},c.waitForCdnTuneIn=function(a){var g=3;return a.live&&a.canBlockReload&&a.partTarget&&a.tuneInGoal>Math.max(a.partHoldBack,a.partTarget*g)},c.setStartPosition=function(a,g){var T=this.startPosition;if(T<g&&(T=-1),T===-1||this.lastCurrentTime===-1){var R=a.startTimeOffset;(0,b.isFiniteNumber)(R)?(T=g+R,R<0&&(T+=a.totalduration),T=Math.min(Math.max(g,T),g+a.totalduration),this.log("Start time offset "+R+" found in playlist, adjust startPosition to "+T),this.startPosition=T):a.live?T=this.hls.liveSyncPosition||g:this.startPosition=T=0,this.lastCurrentTime=T}this.nextLoadPosition=T},c.getLoadPosition=function(){var a=this.media,g=0;return this.loadedmetadata&&a?g=a.currentTime:this.nextLoadPosition&&(g=this.nextLoadPosition),g},c.handleFragLoadAborted=function(a,g){this.transmuxer&&a.sn!=="initSegment"&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(g?" part"+g.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},c.resetFragmentLoading=function(a){(!this.fragCurrent||!this.fragContextChanged(a)&&this.state!==f.FRAG_LOADING_WAITING_RETRY)&&(this.state=f.IDLE)},c.onFragmentOrKeyLoadError=function(a,g){if(!g.fatal){var T=g.frag;if(!(!T||T.type!==a)){var R=this.fragCurrent;console.assert(R&&T.sn===R.sn&&T.level===R.level&&T.urlId===R.urlId,"Frag load error must match current frag to retry");var C=this.config;if(this.fragLoadError+1<=C.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var O=Math.min(Math.pow(2,this.fragLoadError)*C.fragLoadingRetryDelay,C.fragLoadingMaxRetryTimeout);this.warn("Fragment "+T.sn+" of "+a+" "+T.level+" failed to load, retrying in "+O+"ms"),this.retryDate=self.performance.now()+O,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else g.levelRetry?(a===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(M.logger.error(g.details+" reaches max retry, redispatch as fatal ..."),g.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}}},c.afterBufferFlushed=function(a,g,T){if(a){var R=I.BufferHelper.getBuffered(a);this.fragmentTracker.detectEvictedFragments(g,R,T),this.state===f.ENDED&&this.resetLoadingState()}},c.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},c.resetStartWhenNotLoaded=function(a){if(!this.loadedmetadata){this.startFragRequested=!1;var g=this.levels?this.levels[a].details:null;g!=null&&g.live?(this.startPosition=-1,this.setStartPosition(g,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},c.updateLevelTiming=function(a,g,T,R){var C=this,O=T.details;console.assert(!!O,"level.details must be defined");var F=Object.keys(a.elementaryStreams).reduce(function(U,k){var N=a.elementaryStreams[k];if(N){var w=N.endPTS-N.startPTS;if(w<=0)return C.warn("Could not parse fragment "+a.sn+" "+k+" duration reliably ("+w+")"),U||!1;var K=R?0:(0,y.updateFragPTSDTS)(O,a,N.startPTS,N.endPTS,N.startDTS,N.endDTS);return C.hls.trigger(A.Events.LEVEL_PTS_UPDATED,{details:O,level:T,drift:K,type:k,frag:a,start:N.startPTS,end:N.endPTS}),!0}return U},!1);F||(this.warn("Found no media in fragment "+a.sn+" of level "+T.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=f.PARSED,this.hls.trigger(A.Events.FRAG_PARSED,{frag:a,part:g})},c.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},h(s,[{key:"state",get:function(){return this._state},set:function(a){var g=this._state;g!==a&&(this._state=a,this.log(g+"->"+a))}}]),s}(D.default)},"./src/controller/buffer-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>_});var b=L("./src/polyfills/number.ts"),D=L("./src/events.ts"),P=L("./src/utils/logger.ts"),I=L("./src/errors.ts"),M=L("./src/utils/buffer-helper.ts"),A=L("./src/utils/mediasource-helper.ts"),x=L("./src/loader/fragment.ts"),S=L("./src/controller/buffer-operation-queue.ts"),m=(0,A.getMediaSource)(),E=/([ha]vc.)(?:\.[^.,]+)+/,_=function(){function y(l){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=n.hls,u=n.media,h=n.mediaSource;P.logger.log("[buffer-controller]: Media source opened"),u&&(n.updateMediaElementDuration(),t.trigger(D.Events.MEDIA_ATTACHED,{media:u})),h&&h.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){P.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){P.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var p=y.prototype;return p.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},p.destroy=function(){this.unregisterListeners(),this.details=null},p.registerListeners=function(){var n=this.hls;n.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(D.Events.BUFFER_RESET,this.onBufferReset,this),n.on(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.on(D.Events.BUFFER_EOS,this.onBufferEos,this),n.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(D.Events.FRAG_PARSED,this.onFragParsed,this),n.on(D.Events.FRAG_CHANGED,this.onFragChanged,this)},p.unregisterListeners=function(){var n=this.hls;n.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(D.Events.BUFFER_RESET,this.onBufferReset,this),n.off(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.off(D.Events.BUFFER_EOS,this.onBufferEos,this),n.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(D.Events.FRAG_PARSED,this.onFragParsed,this),n.off(D.Events.FRAG_CHANGED,this.onFragChanged,this)},p._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},p.onManifestParsed=function(n,t){var u=2;(t.audio&&!t.video||!t.altAudio)&&(u=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=u,this.details=null,P.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},p.onMediaAttaching=function(n,t){var u=this.media=t.media;if(u&&m){var h=this.mediaSource=new m;h.addEventListener("sourceopen",this._onMediaSourceOpen),h.addEventListener("sourceended",this._onMediaSourceEnded),h.addEventListener("sourceclose",this._onMediaSourceClose),u.src=self.URL.createObjectURL(h),this._objectUrl=u.src}},p.onMediaDetaching=function(){var n=this.media,t=this.mediaSource,u=this._objectUrl;if(t){if(P.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(h){P.logger.warn("[buffer-controller]: onMediaDetaching: "+h.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),n&&(u&&self.URL.revokeObjectURL(u),n.src===u?(n.removeAttribute("src"),n.load()):P.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.Events.MEDIA_DETACHED,void 0)},p.onBufferReset=function(){var n=this;this.getSourceBufferTypes().forEach(function(t){var u=n.sourceBuffer[t];try{u&&(n.removeBufferListeners(t),n.mediaSource&&n.mediaSource.removeSourceBuffer(u),n.sourceBuffer[t]=void 0)}catch(h){P.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",h)}}),this._initSourceBuffer()},p.onBufferCodecs=function(n,t){var u=this,h=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(i){if(h){var e=u.tracks[i];if(e&&typeof e.buffer.changeType=="function"){var r=t[i],f=r.id,o=r.codec,v=r.levelCodec,s=r.container,c=r.metadata,d=(e.levelCodec||e.codec).replace(E,"$1"),a=(v||o).replace(E,"$1");if(d!==a){var g=s+";codecs="+(v||o);u.appendChangeType(i,g),P.logger.log("[buffer-controller]: switching codec "+d+" to "+a),u.tracks[i]={buffer:e.buffer,codec:o,container:s,levelCodec:v,metadata:c,id:f}}}}else u.pendingTracks[i]=t[i]}),!h&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},p.appendChangeType=function(n,t){var u=this,h=this.operationQueue,i={execute:function(){var r=u.sourceBuffer[n];r&&(P.logger.log("[buffer-controller]: changing "+n+" sourceBuffer type to "+t),r.changeType(t)),h.shiftAndExecuteNext(n)},onStart:function(){},onComplete:function(){},onError:function(r){P.logger.warn("[buffer-controller]: Failed to change "+n+" SourceBuffer type",r)}};h.append(i,n)},p.onBufferAppending=function(n,t){var u=this,h=this.hls,i=this.operationQueue,e=this.tracks,r=t.data,f=t.type,o=t.frag,v=t.part,s=t.chunkMeta,c=s.buffering[f],d=self.performance.now();c.start=d;var a=o.stats.buffering,g=v?v.stats.buffering:null;a.start===0&&(a.start=d),g&&g.start===0&&(g.start=d);var T=e.audio,R=f==="audio"&&s.id===1&&(T==null?void 0:T.container)==="audio/mpeg",C={execute:function(){if(c.executeStart=self.performance.now(),R){var F=u.sourceBuffer[f];if(F){var U=o.start-F.timestampOffset;Math.abs(U)>=.1&&(P.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+o.start+" (delta: "+U+") sn: "+o.sn+")"),F.timestampOffset=o.start)}}u.appendExecutor(r,f)},onStart:function(){},onComplete:function(){var F=self.performance.now();c.executeEnd=c.end=F,a.first===0&&(a.first=F),g&&g.first===0&&(g.first=F);var U=u.sourceBuffer,k={};for(var N in U)k[N]=M.BufferHelper.getBuffered(U[N]);u.appendError=0,u.hls.trigger(D.Events.BUFFER_APPENDED,{type:f,frag:o,part:v,chunkMeta:s,parent:o.type,timeRanges:k})},onError:function(F){P.logger.error("[buffer-controller]: Error encountered while trying to append to the "+f+" SourceBuffer",F);var U={type:I.ErrorTypes.MEDIA_ERROR,parent:o.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=I.ErrorDetails.BUFFER_FULL_ERROR:(u.appendError++,U.details=I.ErrorDetails.BUFFER_APPEND_ERROR,u.appendError>h.config.appendErrorMaxRetry&&(P.logger.error("[buffer-controller]: Failed "+h.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0,h.stopLoad())),h.trigger(D.Events.ERROR,U)}};i.append(C,f)},p.onBufferFlushing=function(n,t){var u=this,h=this.operationQueue,i=function(r){return{execute:u.removeExecutor.bind(u,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){u.hls.trigger(D.Events.BUFFER_FLUSHED,{type:r})},onError:function(o){P.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",o)}}};t.type?h.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(function(e){h.append(i(e),e)})},p.onFragParsed=function(n,t){var u=this,h=t.frag,i=t.part,e=[],r=i?i.elementaryStreams:h.elementaryStreams;r[x.ElementaryStreamTypes.AUDIOVIDEO]?e.push("audiovideo"):(r[x.ElementaryStreamTypes.AUDIO]&&e.push("audio"),r[x.ElementaryStreamTypes.VIDEO]&&e.push("video"));var f=function(){var v=self.performance.now();h.stats.buffering.end=v,i&&(i.stats.buffering.end=v);var s=i?i.stats:h.stats;u.hls.trigger(D.Events.FRAG_BUFFERED,{frag:h,part:i,stats:s,id:h.type})};e.length===0&&P.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+h.type+" level: "+h.level+" sn: "+h.sn),this.blockBuffers(f,e)},p.onFragChanged=function(n,t){this.flushBackBuffer()},p.onBufferEos=function(n,t){var u=this,h=this.getSourceBufferTypes().reduce(function(i,e){var r=u.sourceBuffer[e];return(!t.type||t.type===e)&&r&&!r.ended&&(r.ended=!0,P.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),i&&!!(!r||r.ended)},!0);h&&this.blockBuffers(function(){var i=u.mediaSource;!i||i.readyState!=="open"||i.endOfStream()})},p.onLevelUpdated=function(n,t){var u=t.details;u.fragments.length&&(this.details=u,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},p.flushBackBuffer=function(){var n=this.hls,t=this.details,u=this.media,h=this.sourceBuffer;if(!(!u||t===null)){var i=this.getSourceBufferTypes();if(i.length){var e=t.live&&n.config.liveBackBufferLength!==null?n.config.liveBackBufferLength:n.config.backBufferLength;if(!(!(0,b.isFiniteNumber)(e)||e<0)){var r=u.currentTime,f=t.levelTargetDuration,o=Math.max(e,f),v=Math.floor(r/f)*f-o;i.forEach(function(s){var c=h[s];if(c){var d=M.BufferHelper.getBuffered(c);d.length>0&&v>d.start(0)&&(n.trigger(D.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),t.live&&n.trigger(D.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),n.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:s}))}})}}}},p.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var n=this.details,t=this.hls,u=this.media,h=this.mediaSource,i=n.fragments[0].start+n.totalduration,e=u.duration,r=(0,b.isFiniteNumber)(h.duration)?h.duration:0;n.live&&t.config.liveDurationInfinity?(P.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),h.duration=1/0,this.updateSeekableRange(n)):(i>r&&i>e||!(0,b.isFiniteNumber)(e))&&(P.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),h.duration=i)}},p.updateSeekableRange=function(n){var t=this.mediaSource,u=n.fragments,h=u.length;if(h&&n.live&&t!==null&&t!==void 0&&t.setLiveSeekableRange){var i=Math.max(0,u[0].start),e=Math.max(i,i+n.totalduration);t.setLiveSeekableRange(i,e)}},p.checkPendingTracks=function(){var n=this.bufferCodecEventsExpected,t=this.operationQueue,u=this.pendingTracks,h=Object.keys(u).length;if(h&&!n||h===2){this.createSourceBuffers(u),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length===0){this.hls.trigger(D.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}i.forEach(function(e){t.executeNext(e)})}},p.createSourceBuffers=function(n){var t=this.sourceBuffer,u=this.mediaSource;if(!u)throw Error("createSourceBuffers called when mediaSource was null");var h=0;for(var i in n)if(!t[i]){var e=n[i];if(!e)throw Error("source buffer exists for track "+i+", however track does not");var r=e.levelCodec||e.codec,f=e.container+";codecs="+r;P.logger.log("[buffer-controller]: creating sourceBuffer("+f+")");try{var o=t[i]=u.addSourceBuffer(f),v=i;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[i]={buffer:o,codec:r,container:e.container,levelCodec:e.levelCodec,metadata:e.metadata,id:e.id},h++}catch(s){P.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(D.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:f})}}h&&this.hls.trigger(D.Events.BUFFER_CREATED,{tracks:this.tracks})},p._onSBUpdateStart=function(n){var t=this.operationQueue,u=t.current(n);u.onStart()},p._onSBUpdateEnd=function(n){var t=this.operationQueue,u=t.current(n);u.onComplete(),t.shiftAndExecuteNext(n)},p._onSBUpdateError=function(n,t){P.logger.error("[buffer-controller]: "+n+" SourceBuffer error",t),this.hls.trigger(D.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var u=this.operationQueue.current(n);u&&u.onError(t)},p.removeExecutor=function(n,t,u){var h=this.media,i=this.mediaSource,e=this.operationQueue,r=this.sourceBuffer,f=r[n];if(!h||!i||!f){P.logger.warn("[buffer-controller]: Attempting to remove from the "+n+" SourceBuffer, but it does not exist"),e.shiftAndExecuteNext(n);return}var o=(0,b.isFiniteNumber)(h.duration)?h.duration:1/0,v=(0,b.isFiniteNumber)(i.duration)?i.duration:1/0,s=Math.max(0,t),c=Math.min(u,o,v);c>s?(P.logger.log("[buffer-controller]: Removing ["+s+","+c+"] from the "+n+" SourceBuffer"),console.assert(!f.updating,n+" sourceBuffer must not be updating"),f.remove(s,c)):e.shiftAndExecuteNext(n)},p.appendExecutor=function(n,t){var u=this.operationQueue,h=this.sourceBuffer,i=h[t];if(!i){P.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),u.shiftAndExecuteNext(t);return}i.ended=!1,console.assert(!i.updating,t+" sourceBuffer must not be updating"),i.appendBuffer(n)},p.blockBuffers=function(n,t){var u=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length){P.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(n);return}var h=this.operationQueue,i=t.map(function(e){return h.appendBlocker(e)});Promise.all(i).then(function(){n(),t.forEach(function(e){var r=u.sourceBuffer[e];(!r||!r.updating)&&h.shiftAndExecuteNext(e)})})},p.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},p.addBufferListener=function(n,t,u){var h=this.sourceBuffer[n];if(h){var i=u.bind(this,n);this.listeners[n].push({event:t,listener:i}),h.addEventListener(t,i)}},p.removeBufferListeners=function(n){var t=this.sourceBuffer[n];t&&this.listeners[n].forEach(function(u){t.removeEventListener(u.event,u.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>D});var b=L("./src/utils/logger.ts"),D=function(){function P(M){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=M}var I=P.prototype;return I.append=function(A,x){var S=this.queues[x];S.push(A),S.length===1&&this.buffers[x]&&this.executeNext(x)},I.insertAbort=function(A,x){var S=this.queues[x];S.unshift(A),this.executeNext(x)},I.appendBlocker=function(A){var x,S=new Promise(function(E){x=E}),m={execute:x,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(m,A),S},I.executeNext=function(A){var x=this.buffers,S=this.queues,m=x[A],E=S[A];if(E.length){var _=E[0];try{_.execute()}catch(y){b.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),_.onError(y),(!m||!m.updating)&&(E.shift(),this.executeNext(A))}}},I.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},I.current=function(A){return this.queues[A][0]},P}()},"./src/controller/cap-level-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>M});var b=L("./src/events.ts");function D(A,x){for(var S=0;S<x.length;S++){var m=x[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(A,m.key,m)}}function P(A,x,S){return x&&D(A.prototype,x),S&&D(A,S),Object.defineProperty(A,"prototype",{writable:!1}),A}var I=function(){function A(S){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=S,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var x=A.prototype;return x.setStreamController=function(m){this.streamController=m},x.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},x.registerListeners=function(){var m=this.hls;m.on(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},x.unregisterListener=function(){var m=this.hls;m.off(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},x.onFpsDropLevelCapping=function(m,E){A.isLevelAllowed(E.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(E.droppedLevel)},x.onMediaAttaching=function(m,E){this.media=E.media instanceof HTMLVideoElement?E.media:null},x.onManifestParsed=function(m,E){var _=this.hls;this.restrictedLevels=[],this.firstLevel=E.firstLevel,_.config.capLevelToPlayerSize&&E.video&&this.startCapping()},x.onBufferCodecs=function(m,E){var _=this.hls;_.config.capLevelToPlayerSize&&E.video&&this.startCapping()},x.onMediaDetaching=function(){this.stopCapping()},x.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var E=this.hls;E.autoLevelCapping=this.getMaxLevel(m.length-1),E.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=E.autoLevelCapping}}},x.getMaxLevel=function(m){var E=this,_=this.hls.levels;if(!_.length)return-1;var y=_.filter(function(p,l){return A.isLevelAllowed(l,E.restrictedLevels)&&l<=m});return this.clientRect=null,A.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},x.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},x.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},x.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,E={width:0,height:0};if(m){var _=m.getBoundingClientRect();E.width=_.width,E.height=_.height,!E.width&&!E.height&&(E.width=_.right-_.left||m.width||0,E.height=_.bottom-_.top||m.height||0)}return this.clientRect=E,E},A.isLevelAllowed=function(m,E){return E===void 0&&(E=[]),E.indexOf(m)===-1},A.getMaxLevelByMediaSize=function(m,E,_){if(!m||!m.length)return-1;for(var y=function(u,h){return h?u.width!==h.width||u.height!==h.height:!0},p=m.length-1,l=0;l<m.length;l+=1){var n=m[l];if((n.width>=E||n.height>=_)&&y(n,m[l+1])){p=l;break}}return p},P(A,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var m=1;if(!this.hls.config.ignoreDevicePixelRatio)try{m=self.devicePixelRatio}catch{}return m}}]),A}();const M=I},"./src/controller/cmcd-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>_});var b=L("./src/events.ts"),D=L("./src/types/cmcd.ts"),P=L("./src/utils/buffer-helper.ts"),I=L("./src/utils/logger.ts");function M(y,p){for(var l=0;l<p.length;l++){var n=p[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(y,n.key,n)}}function A(y,p,l){return p&&M(y.prototype,p),l&&M(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}function x(y,p){var l=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(l)return(l=l.call(y)).next.bind(l);if(Array.isArray(y)||(l=S(y))||p&&y&&typeof y.length=="number"){l&&(y=l);var n=0;return function(){return n>=y.length?{done:!0}:{done:!1,value:y[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(y,p){if(y){if(typeof y=="string")return m(y,p);var l=Object.prototype.toString.call(y).slice(8,-1);if(l==="Object"&&y.constructor&&(l=y.constructor.name),l==="Map"||l==="Set")return Array.from(y);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return m(y,p)}}function m(y,p){(p==null||p>y.length)&&(p=y.length);for(var l=0,n=new Array(p);l<p;l++)n[l]=y[l];return n}function E(){return E=Object.assign?Object.assign.bind():function(y){for(var p=1;p<arguments.length;p++){var l=arguments[p];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(y[n]=l[n])}return y},E.apply(this,arguments)}var _=function(){function y(l){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(h){try{n.apply(h,{ot:D.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(i){I.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(h){try{var i=h.frag,e=n.hls.levels[i.level],r=n.getObjectType(i),f={d:i.duration*1e3,ot:r};(r===D.CMCDObjectType.VIDEO||r===D.CMCDObjectType.AUDIO||r==D.CMCDObjectType.MUXED)&&(f.br=e.bitrate/1e3,f.tb=n.getTopBandwidth(r)/1e3,f.bl=n.getBufferLength(r)),n.apply(h,f)}catch(o){I.logger.warn("Could not generate segment CMCD data.",o)}},this.hls=l;var t=this.config=l.config,u=t.cmcd;u!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=u.sessionId||y.uuid(),this.cid=u.contentId,this.useHeaders=u.useHeaders===!0,this.registerListeners())}var p=y.prototype;return p.registerListeners=function(){var n=this.hls;n.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this)},p.unregisterListeners=function(){var n=this.hls;n.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},p.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},p.onMediaAttached=function(n,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},p.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},p.onBufferCreated=function(n,t){var u,h;this.audioBuffer=(u=t.tracks.audio)===null||u===void 0?void 0:u.buffer,this.videoBuffer=(h=t.tracks.video)===null||h===void 0?void 0:h.buffer},p.createData=function(){var n;return{v:D.CMCDVersion,sf:D.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(n=this.media)===null||n===void 0?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},p.apply=function(n,t){t===void 0&&(t={}),E(t,this.createData());var u=t.ot===D.CMCDObjectType.INIT||t.ot===D.CMCDObjectType.VIDEO||t.ot===D.CMCDObjectType.MUXED;if(this.starved&&u&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var h=y.toHeaders(t);if(!Object.keys(h).length)return;n.headers||(n.headers={}),E(n.headers,h)}else{var i=y.toQuery(t);if(!i)return;n.url=y.appendQueryToUri(n.url,i)}},p.getObjectType=function(n){var t=n.type;if(t==="subtitle")return D.CMCDObjectType.TIMED_TEXT;if(n.sn==="initSegment")return D.CMCDObjectType.INIT;if(t==="audio")return D.CMCDObjectType.AUDIO;if(t==="main")return this.hls.audioTracks.length?D.CMCDObjectType.VIDEO:D.CMCDObjectType.MUXED},p.getTopBandwidth=function(n){var t=0,u,h=this.hls;if(n===D.CMCDObjectType.AUDIO)u=h.audioTracks;else{var i=h.maxAutoLevel,e=i>-1?i+1:h.levels.length;u=h.levels.slice(0,e)}for(var r=x(u),f;!(f=r()).done;){var o=f.value;o.bitrate>t&&(t=o.bitrate)}return t>0?t:NaN},p.getBufferLength=function(n){var t=this.hls.media,u=n===D.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!u||!t)return NaN;var h=P.BufferHelper.bufferInfo(u,t.currentTime,this.config.maxBufferHole);return h.len*1e3},p.createPlaylistLoader=function(){var n=this.config.pLoader,t=this.applyPlaylistData,u=n||this.config.loader;return function(){function h(e){this.loader=void 0,this.loader=new u(e)}var i=h.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(r,f,o){t(r),this.loader.load(r,f,o)},A(h,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),h}()},p.createFragmentLoader=function(){var n=this.config.fLoader,t=this.applyFragmentData,u=n||this.config.loader;return function(){function h(e){this.loader=void 0,this.loader=new u(e)}var i=h.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(r,f,o){t(r),this.loader.load(r,f,o)},A(h,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),h}()},y.uuid=function(){var n=URL.createObjectURL(new Blob),t=n.toString();return URL.revokeObjectURL(n),t.slice(t.lastIndexOf("/")+1)},y.serialize=function(n){for(var t=[],u=function(R){return!Number.isNaN(R)&&R!=null&&R!==""&&R!==!1},h=function(R){return Math.round(R)},i=function(R){return h(R/100)*100},e=function(R){return encodeURIComponent(R)},r={br:h,d:h,bl:i,dl:i,mtp:i,nor:e,rtp:i,tb:h},f=Object.keys(n||{}).sort(),o=x(f),v;!(v=o()).done;){var s=v.value,c=n[s];if(u(c)&&!(s==="v"&&c===1)&&!(s=="pr"&&c===1)){var d=r[s];d&&(c=d(c));var a=typeof c,g=void 0;s==="ot"||s==="sf"||s==="st"?g=s+"="+c:a==="boolean"?g=s:a==="number"?g=s+"="+c:g=s+"="+JSON.stringify(c),t.push(g)}}return t.join(",")},y.toHeaders=function(n){for(var t=Object.keys(n),u={},h=["Object","Request","Session","Status"],i=[{},{},{},{}],e={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,f=t;r<f.length;r++){var o=f[r],v=e[o]!=null?e[o]:1;i[v][o]=n[o]}for(var s=0;s<i.length;s++){var c=y.serialize(i[s]);c&&(u["CMCD-"+h[s]]=c)}return u},y.toQuery=function(n){return"CMCD="+encodeURIComponent(y.serialize(n))},y.appendQueryToUri=function(n,t){if(!t)return n;var u=n.includes("?")?"&":"?";return""+n+u+t},y}()},"./src/controller/eme-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>_});var b=L("./src/events.ts"),D=L("./src/errors.ts"),P=L("./src/utils/logger.ts"),I=L("./src/utils/mediakeys-helper.ts");function M(y,p){for(var l=0;l<p.length;l++){var n=p[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(y,n.key,n)}}function A(y,p,l){return p&&M(y.prototype,p),l&&M(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}var x=3,S=function(p,l,n){var t={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(u){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+u+'"',robustness:n.audioRobustness||""})}),l.forEach(function(u){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+u+'"',robustness:n.videoRobustness||""})}),[t]},m=function(p,l,n,t){switch(p){case I.KeySystems.WIDEVINE:return S(l,n,t);default:throw new Error("Unknown key-system: "+p)}},E=function(){function y(l){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=l,this._config=l.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var p=y.prototype;return p.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},p._registerListeners=function(){this.hls.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p._unregisterListeners=function(){this.hls.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p.getLicenseServerUrl=function(n){switch(n){case I.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},p._attemptKeySystemAccess=function(n,t,u){var h=this,i=m(n,t,u,this._drmSystemOptions);P.logger.log("Requesting encrypted media key-system access");var e=this.requestMediaKeySystemAccess(n,i);this.mediaKeysPromise=e.then(function(r){return h._onMediaKeySystemAccessObtained(n,r)}),e.catch(function(r){P.logger.error('Failed to obtain key-system "'+n+'" access:',r)})},p._onMediaKeySystemAccessObtained=function(n,t){var u=this;P.logger.log('Access for key-system "'+n+'" obtained');var h={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:n};this._mediaKeysList.push(h);var i=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(e){return h.mediaKeys=e,P.logger.log('Media-keys created for key-system "'+n+'"'),u._onMediaKeysCreated(),e});return i.catch(function(e){P.logger.error("Failed to create media-keys:",e)}),i},p._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),n._onNewMediaKeySession(t.mediaKeysSession))})},p._onNewMediaKeySession=function(n){var t=this;P.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(u){t._onKeySessionMessage(n,u.message)},!1)},p._onKeySessionMessage=function(n,t){P.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(u){P.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),n.update(u).catch(function(h){P.logger.warn("Updating key-session failed: "+h)})})},p.onMediaEncrypted=function(n){var t=this;if(P.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){P.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var u=function(i){t._media&&(t._attemptSetMediaKeys(i),t._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(u).catch(u)},p._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){P.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}P.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},p._generateRequestWithPreferredKeySession=function(n,t){var u=this,h=this._mediaKeysList[0];if(!h){P.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(h.mediaKeysSessionInitialized){P.logger.warn("Key-Session already initialized but requested again");return}var i=h.mediaKeysSession;if(!i){P.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){P.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}P.logger.log('Generating key-session request for "'+n+'" init data type'),h.mediaKeysSessionInitialized=!0,i.generateRequest(n,t).then(function(){P.logger.debug("Key-session generation succeeded")}).catch(function(e){P.logger.error("Error generating key-session request:",e),u.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},p._createLicenseXhr=function(n,t,u){var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,h,n,t,u);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,h,n),i=void 0}catch(e){P.logger.error(e)}try{h.readyState||h.open("POST",n,!0),i&&i.call(this.hls,h,n)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return h},p._onLicenseRequestReadyStageChange=function(n,t,u,h){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,P.logger.log("License request succeeded");var i=n.response,e=this._licenseResponseCallback;if(e)try{i=e.call(this.hls,n,t)}catch(f){P.logger.error(f)}h(i)}else{if(P.logger.error("License Request XHR failed ("+t+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>x){this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var r=x-this._requestLicenseFailureCount+1;P.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(u,h)}break}},p._generateLicenseRequestChallenge=function(n,t){switch(n.mediaKeySystemDomain){case I.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},p._requestLicense=function(n,t){P.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u){P.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var h=this.getLicenseServerUrl(u.mediaKeySystemDomain),i=this._createLicenseXhr(h,n,t);P.logger.log("Sending license request to URL: "+h);var e=this._generateLicenseRequestChallenge(u,n);i.send(e)}catch(r){P.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.onMediaAttached=function(n,t){if(this._emeEnabled){var u=t.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},p.onMediaDetached=function(){var n=this._media,t=this._mediaKeysList;n&&(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},p.onManifestParsed=function(n,t){if(this._emeEnabled){var u=t.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),h=t.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(I.KeySystems.WIDEVINE,u,h)}},A(y,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),y}();const _=E},"./src/controller/fps-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>I});var b=L("./src/events.ts"),D=L("./src/utils/logger.ts"),P=function(){function M(x){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=x,this.registerListeners()}var A=M.prototype;return A.setStreamController=function(S){this.streamController=S},A.registerListeners=function(){this.hls.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},A.unregisterListeners=function(){this.hls.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching)},A.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},A.onMediaAttaching=function(S,m){var E=this.hls.config;if(E.capLevelOnFPSDrop){var _=m.media instanceof self.HTMLVideoElement?m.media:null;this.media=_,_&&typeof _.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),E.fpsDroppedMonitoringPeriod)}},A.checkFPS=function(S,m,E){var _=performance.now();if(m){if(this.lastTime){var y=_-this.lastTime,p=E-this.lastDroppedFrames,l=m-this.lastDecodedFrames,n=1e3*p/y,t=this.hls;if(t.trigger(b.Events.FPS_DROP,{currentDropped:p,currentDecoded:l,totalDroppedFrames:E}),n>0&&p>t.config.fpsDroppedMonitoringThreshold*l){var u=t.currentLevel;D.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=u)&&(u=u-1,t.trigger(b.Events.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:t.currentLevel}),t.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=_,this.lastDroppedFrames=E,this.lastDecodedFrames=m}},A.checkFPSInterval=function(){var S=this.media;if(S)if(this.isVideoPlaybackQualityAvailable){var m=S.getVideoPlaybackQuality();this.checkFPS(S,m.totalVideoFrames,m.droppedVideoFrames)}else this.checkFPS(S,S.webkitDecodedFrameCount,S.webkitDroppedFrameCount)},M}();const I=P},"./src/controller/fragment-finders.ts":(W,B,L)=>{L.r(B),L.d(B,{findFragWithCC:()=>x,findFragmentByPDT:()=>P,findFragmentByPTS:()=>I,fragmentWithinToleranceTest:()=>M,pdtWithinToleranceTest:()=>A});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/binary-search.ts");function P(S,m,E){if(m===null||!Array.isArray(S)||!S.length||!(0,b.isFiniteNumber)(m))return null;var _=S[0].programDateTime;if(m<(_||0))return null;var y=S[S.length-1].endProgramDateTime;if(m>=(y||0))return null;E=E||0;for(var p=0;p<S.length;++p){var l=S[p];if(A(m,E,l))return l}return null}function I(S,m,E,_){E===void 0&&(E=0),_===void 0&&(_=0);var y=null;if(S?y=m[S.sn-m[0].sn+1]||null:E===0&&m[0].start===0&&(y=m[0]),y&&M(E,_,y)===0)return y;var p=D.default.search(m,M.bind(null,E,_));return p||y}function M(S,m,E){S===void 0&&(S=0),m===void 0&&(m=0);var _=Math.min(m,E.duration+(E.deltaPTS?E.deltaPTS:0));return E.start+E.duration-_<=S?1:E.start-_>S&&E.start?-1:0}function A(S,m,E){var _=Math.min(m,E.duration+(E.deltaPTS?E.deltaPTS:0))*1e3,y=E.endProgramDateTime||0;return y-_>S}function x(S,m){return D.default.search(S,function(E){return E.cc<m?1:E.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":(W,B,L)=>{L.r(B),L.d(B,{FragmentState:()=>P,FragmentTracker:()=>I});var b=L("./src/events.ts"),D=L("./src/types/loader.ts"),P;(function(x){x.NOT_LOADED="NOT_LOADED",x.APPENDING="APPENDING",x.PARTIAL="PARTIAL",x.OK="OK"})(P||(P={}));var I=function(){function x(m){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=m,this._registerListeners()}var S=x.prototype;return S._registerListeners=function(){var E=this.hls;E.on(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.on(b.Events.FRAG_LOADED,this.onFragLoaded,this)},S._unregisterListeners=function(){var E=this.hls;E.off(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.off(b.Events.FRAG_LOADED,this.onFragLoaded,this)},S.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},S.getAppendedFrag=function(E,_){if(_===D.PlaylistLevelType.MAIN){var y=this.activeFragment,p=this.activeParts;if(!y)return null;if(p)for(var l=p.length;l--;){var n=p[l],t=n?n.end:y.appendedPTS;if(n.start<=E&&t!==void 0&&E<=t)return l>9&&(this.activeParts=p.slice(l-9)),n}else if(y.start<=E&&y.appendedPTS!==void 0&&E<=y.appendedPTS)return y}return this.getBufferedFrag(E,_)},S.getBufferedFrag=function(E,_){for(var y=this.fragments,p=Object.keys(y),l=p.length;l--;){var n=y[p[l]];if((n==null?void 0:n.body.type)===_&&n.buffered){var t=n.body;if(t.start<=E&&E<=t.end)return t}}return null},S.detectEvictedFragments=function(E,_,y){var p=this;Object.keys(this.fragments).forEach(function(l){var n=p.fragments[l];if(n){if(!n.buffered){n.body.type===y&&p.removeFragment(n.body);return}var t=n.range[E];t&&t.time.some(function(u){var h=!p.isTimeBuffered(u.startPTS,u.endPTS,_);return h&&p.removeFragment(n.body),h})}})},S.detectPartialFragments=function(E){var _=this,y=this.timeRanges,p=E.frag,l=E.part;if(!(!y||p.sn==="initSegment")){var n=A(p),t=this.fragments[n];t&&(Object.keys(y).forEach(function(u){var h=p.elementaryStreams[u];if(h){var i=y[u],e=l!==null||h.partial===!0;t.range[u]=_.getBufferedTimes(p,l,e,i)}}),t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},S.fragBuffered=function(E){var _=A(E),y=this.fragments[_];y&&(y.loaded=null,y.buffered=!0)},S.getBufferedTimes=function(E,_,y,p){for(var l={time:[],partial:y},n=_?_.start:E.start,t=_?_.end:E.end,u=E.minEndPTS||t,h=E.maxStartPTS||n,i=0;i<p.length;i++){var e=p.start(i)-this.bufferPadding,r=p.end(i)+this.bufferPadding;if(h>=e&&u<=r){l.time.push({startPTS:Math.max(n,p.start(i)),endPTS:Math.min(t,p.end(i))});break}else if(n<r&&t>e)l.partial=!0,l.time.push({startPTS:Math.max(n,p.start(i)),endPTS:Math.min(t,p.end(i))});else if(t<=e)break}return l},S.getPartialFragment=function(E){var _=null,y,p,l,n=0,t=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(h){var i=u[h];i&&M(i)&&(p=i.body.start-t,l=i.body.end+t,E>=p&&E<=l&&(y=Math.min(E-p,l-E),n<=y&&(_=i.body,n=y)))}),_},S.getState=function(E){var _=A(E),y=this.fragments[_];return y?y.buffered?M(y)?P.PARTIAL:P.OK:P.APPENDING:P.NOT_LOADED},S.isTimeBuffered=function(E,_,y){for(var p,l,n=0;n<y.length;n++){if(p=y.start(n)-this.bufferPadding,l=y.end(n)+this.bufferPadding,E>=p&&_<=l)return!0;if(_<=p)return!1}return!1},S.onFragLoaded=function(E,_){var y=_.frag,p=_.part;if(!(y.sn==="initSegment"||y.bitrateTest||p)){var l=A(y);this.fragments[l]={body:y,loaded:_,buffered:!1,range:Object.create(null)}}},S.onBufferAppended=function(E,_){var y=this,p=_.frag,l=_.part,n=_.timeRanges;if(p.type===D.PlaylistLevelType.MAIN)if(this.activeFragment=p,l){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(l)}else this.activeParts=null;this.timeRanges=n,Object.keys(n).forEach(function(u){var h=n[u];if(y.detectEvictedFragments(u,h),!l)for(var i=0;i<h.length;i++)p.appendedPTS=Math.max(h.end(i),p.appendedPTS||0)})},S.onFragBuffered=function(E,_){this.detectPartialFragments(_)},S.hasFragment=function(E){var _=A(E);return!!this.fragments[_]},S.removeFragmentsInRange=function(E,_,y){var p=this;Object.keys(this.fragments).forEach(function(l){var n=p.fragments[l];if(n&&n.buffered){var t=n.body;t.type===y&&t.start<_&&t.end>E&&p.removeFragment(t)}})},S.removeFragment=function(E){var _=A(E);E.stats.loaded=0,E.clearElementaryStreamInfo(),delete this.fragments[_]},S.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},x}();function M(x){var S,m;return x.buffered&&(((S=x.range.video)===null||S===void 0?void 0:S.partial)||((m=x.range.audio)===null||m===void 0?void 0:m.partial))}function A(x){return x.type+"_"+x.level+"_"+x.urlId+"_"+x.sn}},"./src/controller/gap-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{MAX_START_GAP_JUMP:()=>A,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>x,SKIP_BUFFER_RANGE_START:()=>S,STALL_MINIMUM_DURATION_MS:()=>M,default:()=>m});var b=L("./src/utils/buffer-helper.ts"),D=L("./src/errors.ts"),P=L("./src/events.ts"),I=L("./src/utils/logger.ts"),M=250,A=2,x=.1,S=.05,m=function(){function E(y,p,l,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=p,this.fragmentTracker=l,this.hls=n}var _=E.prototype;return _.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},_.poll=function(p,l){var n=this.config,t=this.media,u=this.stalled;if(t!==null){var h=t.currentTime,i=t.seeking,e=this.seeking&&!i,r=!this.seeking&&i;if(this.seeking=i,h!==p){if(this.moved=!0,u!==null){if(this.stallReported){var f=self.performance.now()-u;I.logger.warn("playback not stuck anymore @"+h+", after "+Math.round(f)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((r||e)&&(this.stalled=null),!(t.paused&&!i||t.ended||t.playbackRate===0||!b.BufferHelper.getBuffered(t).length)){var o=b.BufferHelper.bufferInfo(t,h,0),v=o.len>0,s=o.nextStart||0;if(!(!v&&!s)){if(i){var c=o.len>A,d=!s||l&&l.start<=h||s-h>A&&!this.fragmentTracker.getPartialFragment(h);if(c||d)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var a,g=Math.max(s,o.start||0)-h,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,R=T==null||(a=T.details)===null||a===void 0?void 0:a.live,C=R?T.details.targetduration*2:A;if(g>0&&g<=C){this._trySkipBufferHole(null);return}}var O=self.performance.now();if(u===null){this.stalled=O;return}var F=O-u;if(!(!i&&F>=M&&(this._reportStall(o),!this.media))){var U=b.BufferHelper.bufferInfo(t,h,n.maxBufferHole);this._tryFixBufferStall(U,F)}}}}},_._tryFixBufferStall=function(p,l){var n=this.config,t=this.fragmentTracker,u=this.media;if(u!==null){var h=u.currentTime,i=t.getPartialFragment(h);if(i){var e=this._trySkipBufferHole(i);if(e||!this.media)return}p.len>n.maxBufferHole&&l>n.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},_._reportStall=function(p){var l=this.hls,n=this.media,t=this.stallReported;!t&&n&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(p)+")"),l.trigger(P.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:p.len}))},_._trySkipBufferHole=function(p){var l=this.config,n=this.hls,t=this.media;if(t===null)return 0;for(var u=t.currentTime,h=0,i=b.BufferHelper.getBuffered(t),e=0;e<i.length;e++){var r=i.start(e);if(u+l.maxBufferHole>=h&&u<r){var f=Math.max(r+S,t.currentTime+x);return I.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+f),this.moved=!0,this.stalled=null,t.currentTime=f,p&&n.trigger(P.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+f,frag:p}),f}h=i.end(e)}return 0},_._tryNudgeBuffer=function(){var p=this.config,l=this.hls,n=this.media,t=this.nudgeRetry;if(n!==null){var u=n.currentTime;if(this.nudgeRetry++,t<p.nudgeMaxRetry){var h=u+(t+1)*p.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+u+" to "+h),n.currentTime=h,l.trigger(P.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+u+" after "+p.nudgeMaxRetry+" nudges"),l.trigger(P.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},E}()},"./src/controller/id3-track-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>p});var b=L("./src/polyfills/number.ts"),D=L("./src/events.ts"),P=L("./src/utils/texttrack-utils.ts"),I=L("./src/demux/id3.ts"),M=L("./src/loader/date-range.ts"),A=L("./src/types/demuxer.ts"),x=.25;function S(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var m=function(){var l=S();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function E(l,n){return l.getTime()/1e3-n}function _(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var y=function(){function l(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var n=l.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var u=this.hls;u.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),u.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var u=this.hls;u.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),u.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(u,h){this.media=h.media},n.onMediaDetaching=function(){this.id3Track&&((0,P.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(u){var h=this.getID3Track(u.textTracks);return h.mode="hidden",h},n.getID3Track=function(u){if(this.media){for(var h=0;h<u.length;h++){var i=u[h];if(i.kind==="metadata"&&i.label==="id3")return(0,P.sendAddTrackEvent)(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(u,h){if(this.media){var i=this.hls.config,e=i.enableEmsgMetadataCues,r=i.enableID3MetadataCues;if(!(!e&&!r)){h.frag;var f=h.samples;h.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=S(),v=0;v<f.length;v++){var s=f[v].type;if(!(s===A.MetadataSchema.emsg&&!e||!r)){var c=I.getID3Frames(f[v].data);if(c){var d=f[v].pts,a=d+f[v].duration;a>m&&(a=m);var g=a-d;g<=0&&(a=d+x);for(var T=0;T<c.length;T++){var R=c[T];if(!I.isTimeStampFrame(R)){this.updateId3CueEnds(d);var C=new o(d,a,"");C.value=R,s&&(C.type=s),this.id3Track.addCue(C)}}}}}}}},n.updateId3CueEnds=function(u){var h,i=(h=this.id3Track)===null||h===void 0?void 0:h.cues;if(i)for(var e=i.length;e--;){var r=i[e];r.startTime<u&&r.endTime===m&&(r.endTime=u)}},n.onBufferFlushing=function(u,h){var i=h.startOffset,e=h.endOffset,r=h.type,f=this.id3Track,o=this.hls;if(o){var v=o.config,s=v.enableEmsgMetadataCues,c=v.enableID3MetadataCues;if(f&&(s||c)){var d;r==="audio"?d=function(g){return g.type===A.MetadataSchema.audioId3&&c}:r==="video"?d=function(g){return g.type===A.MetadataSchema.emsg&&s}:d=function(g){return g.type===A.MetadataSchema.audioId3&&c||g.type===A.MetadataSchema.emsg&&s},(0,P.removeCuesInRange)(f,i,e,d)}}},n.onLevelUpdated=function(u,h){var i=this,e=h.details;if(!(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var r=this.dateRangeCuesAppended,f=this.id3Track,o=e.dateRanges,v=Object.keys(o);if(f)for(var s=Object.keys(r).filter(function(O){return!v.includes(O)}),c=function(F){var U=s[F];Object.keys(r[U].cues).forEach(function(k){f.removeCue(r[U].cues[k])}),delete r[U]},d=s.length;d--;)c(d);var a=e.fragments[e.fragments.length-1];if(!(v.length===0||!(0,b.isFiniteNumber)(a==null?void 0:a.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=a.programDateTime/1e3-a.start,T=S(),R=function(F){var U=v[F],k=o[U],N=r[U],w=(N==null?void 0:N.cues)||{},K=(N==null?void 0:N.durationKnown)||!1,G=E(k.startDate,g),H=m,V=k.endDate;if(V)H=E(V,g),K=!0;else if(k.endOnNext&&!K){var X=v.reduce(function(J,Z){var q=o[Z];return q.class===k.class&&q.id!==Z&&q.startDate>k.startDate&&J.push(q),J},[]).sort(function(J,Z){return J.startDate.getTime()-Z.startDate.getTime()})[0];X&&(H=E(X.startDate,g),K=!0)}for(var Y=Object.keys(k.attr),Q=0;Q<Y.length;Q++){var $=Y[Q];if(!($===M.DateRangeAttribute.ID||$===M.DateRangeAttribute.CLASS||$===M.DateRangeAttribute.START_DATE||$===M.DateRangeAttribute.DURATION||$===M.DateRangeAttribute.END_DATE||$===M.DateRangeAttribute.END_ON_NEXT)){var j=w[$];if(j)K&&!N.durationKnown&&(j.endTime=H);else{var z=k.attr[$];j=new T(G,H,""),($===M.DateRangeAttribute.SCTE35_OUT||$===M.DateRangeAttribute.SCTE35_IN)&&(z=_(z)),j.value={key:$,data:z},j.type=A.MetadataSchema.dateRange,i.id3Track.addCue(j),w[$]=j}}}r[U]={cues:w,dateRange:k,durationKnown:K}},C=0;C<v.length;C++)R(C)}}},l}();const p=y},"./src/controller/latency-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>A});var b=L("./src/errors.ts"),D=L("./src/events.ts"),P=L("./src/utils/logger.ts");function I(x,S){for(var m=0;m<S.length;m++){var E=S[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(x,E.key,E)}}function M(x,S,m){return S&&I(x.prototype,S),m&&I(x,m),Object.defineProperty(x,"prototype",{writable:!1}),x}var A=function(){function x(m){var E=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return E.timeupdate()},this.hls=m,this.config=m.config,this.registerListeners()}var S=x.prototype;return S.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},S.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(D.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(D.Events.ERROR,this.onError)},S.onMediaAttached=function(E,_){this.media=_.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},S.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},S.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},S.onLevelUpdated=function(E,_){var y=_.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},S.onError=function(E,_){_.details===b.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,P.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},S.timeupdate=function(){var E=this.media,_=this.levelDetails;if(!(!E||!_)){this.currentTime=E.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var p=this.config,l=p.lowLatencyMode,n=p.maxLiveSyncPlaybackRate;if(!(!l||n===1)){var t=this.targetLatency;if(t!==null){var u=y-t,h=Math.min(this.maxLatency,t+_.targetduration),i=u<h;if(_.live&&i&&u>.05&&this.forwardBufferLength>1){var e=Math.min(2,Math.max(1,n)),r=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;E.playbackRate=Math.min(e,Math.max(1,r))}else E.playbackRate!==1&&E.playbackRate!==0&&(E.playbackRate=1)}}}}},S.estimateLiveEdge=function(){var E=this.levelDetails;return E===null?null:E.edge+E.age},S.computeLatency=function(){var E=this.estimateLiveEdge();return E===null?null:E-this.currentTime},M(x,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var E=this.config,_=this.levelDetails;return E.liveMaxLatencyDuration!==void 0?E.liveMaxLatencyDuration:_?E.liveMaxLatencyDurationCount*_.targetduration:0}},{key:"targetLatency",get:function(){var E=this.levelDetails;if(E===null)return null;var _=E.holdBack,y=E.partHoldBack,p=E.targetduration,l=this.config,n=l.liveSyncDuration,t=l.liveSyncDurationCount,u=l.lowLatencyMode,h=this.hls.userConfig,i=u&&y||_;(h.liveSyncDuration||h.liveSyncDurationCount||i===0)&&(i=n!==void 0?n:t*p);var e=p,r=1;return i+Math.min(this.stallCount*r,e)}},{key:"liveSyncPosition",get:function(){var E=this.estimateLiveEdge(),_=this.targetLatency,y=this.levelDetails;if(E===null||_===null||y===null)return null;var p=y.edge,l=E-_-this.edgeStalled,n=p-y.totalduration,t=p-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(n,l),t)}},{key:"drift",get:function(){var E=this.levelDetails;return E===null?1:E.drift}},{key:"edgeStalled",get:function(){var E=this.levelDetails;if(E===null)return 0;var _=(this.config.lowLatencyMode&&E.partTarget||E.targetduration)*3;return Math.max(E.age-_,0)}},{key:"forwardBufferLength",get:function(){var E=this.media,_=this.levelDetails;if(!E||!_)return 0;var y=E.buffered.length;return(y?E.buffered.end(y-1):_.edge)-this.currentTime}}]),x}()},"./src/controller/level-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>l});var b=L("./src/types/level.ts"),D=L("./src/events.ts"),P=L("./src/errors.ts"),I=L("./src/utils/codecs.ts"),M=L("./src/controller/level-helper.ts"),A=L("./src/controller/base-playlist-controller.ts"),x=L("./src/types/loader.ts");function S(){return S=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var u=arguments[t];for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(n[h]=u[h])}return n},S.apply(this,arguments)}function m(n,t){for(var u=0;u<t.length;u++){var h=t[u];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(n,h.key,h)}}function E(n,t,u){return t&&m(n.prototype,t),u&&m(n,u),Object.defineProperty(n,"prototype",{writable:!1}),n}function _(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,y(n,t)}function y(n,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,i){return h.__proto__=i,h},y(n,t)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=function(n){_(t,n);function t(h){var i;return i=n.call(this,h,"[level-controller]")||this,i._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}var u=t.prototype;return u._registerListeners=function(){var i=this.hls;i.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(D.Events.ERROR,this.onError,this)},u._unregisterListeners=function(){var i=this.hls;i.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(D.Events.ERROR,this.onError,this)},u.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,n.prototype.destroy.call(this)},u.startLoad=function(){var i=this._levels;i.forEach(function(e){e.loadError=0}),n.prototype.startLoad.call(this)},u.onManifestLoaded=function(i,e){var r=[],f=[],o=[],v,s={},c,d=!1,a=!1,g=!1;if(e.levels.forEach(function(O){var F=O.attrs;d=d||!!(O.width&&O.height),a=a||!!O.videoCodec,g=g||!!O.audioCodec,p&&O.audioCodec&&O.audioCodec.indexOf("mp4a.40.34")!==-1&&(O.audioCodec=void 0);var U=O.bitrate+"-"+O.attrs.RESOLUTION+"-"+O.attrs.CODECS;c=s[U],c?c.url.push(O.url):(c=new b.Level(O),s[U]=c,r.push(c)),F&&(F.AUDIO&&(0,M.addGroupId)(c,"audio",F.AUDIO),F.SUBTITLES&&(0,M.addGroupId)(c,"text",F.SUBTITLES))}),(d||a)&&g&&(r=r.filter(function(O){var F=O.videoCodec,U=O.width,k=O.height;return!!F||!!(U&&k)})),r=r.filter(function(O){var F=O.audioCodec,U=O.videoCodec;return(!F||(0,I.isCodecSupportedInMp4)(F,"audio"))&&(!U||(0,I.isCodecSupportedInMp4)(U,"video"))}),e.audioTracks&&(f=e.audioTracks.filter(function(O){return!O.audioCodec||(0,I.isCodecSupportedInMp4)(O.audioCodec,"audio")}),(0,M.assignTrackIdsByGroup)(f)),e.subtitles&&(o=e.subtitles,(0,M.assignTrackIdsByGroup)(o)),r.length>0){v=r[0].bitrate,r.sort(function(O,F){return O.bitrate-F.bitrate}),this._levels=r;for(var T=0;T<r.length;T++)if(r[T].bitrate===v){this._firstLevel=T,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+v);break}var R=g&&!a,C={levels:r,audioTracks:f,subtitleTracks:o,firstLevel:this._firstLevel,stats:e.stats,audio:g,video:a,altAudio:!R&&f.some(function(O){return!!O.url})};this.hls.trigger(D.Events.MANIFEST_PARSED,C),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},u.onError=function(i,e){var r;if(n.prototype.onError.call(this,i,e),!e.fatal){var f=e.context,o=this._levels[this.currentLevelIndex];if(f&&(f.type===x.PlaylistContextType.AUDIO_TRACK&&o.audioGroupIds&&f.groupId===o.audioGroupIds[o.urlId]||f.type===x.PlaylistContextType.SUBTITLE_TRACK&&o.textGroupIds&&f.groupId===o.textGroupIds[o.urlId])){this.redundantFailover(this.currentLevelIndex);return}var v=!1,s=!0,c;switch(e.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:if(e.frag){var d=e.frag.type===x.PlaylistLevelType.MAIN?e.frag.level:this.currentLevelIndex,a=this._levels[d];a?(a.fragmentError++,a.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=d)):c=d}break;case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.LEVEL_LOAD_TIMEOUT:f&&(f.deliveryDirectives&&(s=!1),c=f.level),v=!0;break;case P.ErrorDetails.REMUX_ALLOC_ERROR:c=(r=e.level)!=null?r:this.currentLevelIndex,v=!0;break}c!==void 0&&this.recoverLevel(e,c,v,s)}},u.recoverLevel=function(i,e,r,f){var o=i.details,v=this._levels[e];if(v.loadError++,r){var s=this.retryLoadingOrFail(i);if(s)i.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(f){var c=v.url.length;if(c>1&&v.loadError<c)i.levelRetry=!0,this.redundantFailover(e);else if(this.manualLevelIndex===-1){for(var d=-1,a=this._levels,g=a.length;g--;){var T=(g+this.currentLevelIndex)%a.length;if(T!==this.currentLevelIndex&&a[T].loadError===0){d=T;break}}d>-1&&this.currentLevelIndex!==d&&(this.warn(o+": switch to "+d),i.levelRetry=!0,this.hls.nextAutoLevel=d)}}},u.redundantFailover=function(i){var e=this._levels[i],r=e.url.length;if(r>1){var f=(e.urlId+1)%r;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(o){o.urlId=f}),this.level=i}},u.onFragLoaded=function(i,e){var r=e.frag;if(r!==void 0&&r.type===x.PlaylistLevelType.MAIN){var f=this._levels[r.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},u.onLevelLoaded=function(i,e){var r,f=e.level,o=e.details,v=this._levels[f];if(!v){var s;this.warn("Invalid level index "+f),(s=e.deliveryDirectives)!==null&&s!==void 0&&s.skip&&(o.deltaUpdateFailed=!0);return}f===this.currentLevelIndex?(v.fragmentError===0&&(v.loadError=0,this.retryCount=0),this.playlistLoaded(f,e,v.details)):(r=e.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(o.deltaUpdateFailed=!0)},u.onAudioTrackSwitched=function(i,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var f=-1,o=this.hls.audioTracks[e.id].groupId,v=0;v<r.audioGroupIds.length;v++)if(r.audioGroupIds[v]===o){f=v;break}f!==r.urlId&&(r.urlId=f,this.startLoad())}},u.loadPlaylist=function(i){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&r.url.length>0){var f=r.urlId,o=r.url[f];if(i)try{o=i.addDirectives(o)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Attempt loading level index "+e+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+f+" "+o),this.clearTimer(),this.hls.trigger(D.Events.LEVEL_LOADING,{url:o,level:e,id:f,deliveryDirectives:i||null})}},u.removeLevel=function(i,e){var r=function(v,s){return s!==e},f=this._levels.filter(function(o,v){return v!==i?!0:o.url.length>1&&e!==void 0?(o.url=o.url.filter(r),o.audioGroupIds&&(o.audioGroupIds=o.audioGroupIds.filter(r)),o.textGroupIds&&(o.textGroupIds=o.textGroupIds.filter(r)),o.urlId=0,!0):!1}).map(function(o,v){var s=o.details;return s!=null&&s.fragments&&s.fragments.forEach(function(c){c.level=v}),o});this._levels=f,this.hls.trigger(D.Events.LEVELS_UPDATED,{levels:f})},E(t,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var e,r=this._levels;if(r.length!==0&&!(this.currentLevelIndex===i&&(e=r[i])!==null&&e!==void 0&&e.details)){if(i<0||i>=r.length){var f=i<0;if(this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:f,reason:"invalid level idx"}),f)return;i=Math.min(i,r.length-1)}this.clearTimer();var o=this.currentLevelIndex,v=r[o],s=r[i];this.log("switching to level "+i+" from "+o),this.currentLevelIndex=i;var c=S({},s,{level:i,maxBitrate:s.maxBitrate,uri:s.uri,urlId:s.urlId});delete c._urlId,this.hls.trigger(D.Events.LEVEL_SWITCHING,c);var d=s.details;if(!d||d.live){var a=this.switchParams(s.uri,v==null?void 0:v.details);this.loadPlaylist(a)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}else return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}}]),t}(A.default)},"./src/controller/level-helper.ts":(W,B,L)=>{L.r(B),L.d(B,{addGroupId:()=>M,addSliding:()=>n,adjustSliding:()=>l,assignTrackIdsByGroup:()=>A,computeReloadInterval:()=>t,getFragmentWithSN:()=>u,getPartWith:()=>h,mapFragmentIntersection:()=>p,mapPartIntersection:()=>y,mergeDetails:()=>E,updateFragPTSDTS:()=>m,updatePTS:()=>x});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/logger.ts"),P=L("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(i[f]=r[f])}return i},I.apply(this,arguments)}function M(i,e,r){switch(e){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(r);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(r);break}}function A(i){var e={};i.forEach(function(r){var f=r.groupId||"";r.id=e[f]=e[f]||0,e[f]++})}function x(i,e,r){var f=i[e],o=i[r];S(f,o)}function S(i,e){var r=e.startPTS;if((0,b.isFiniteNumber)(r)){var f=0,o;e.sn>i.sn?(f=r-i.start,o=i):(f=i.start-r,o=e),o.duration!==f&&(o.duration=f)}else if(e.sn>i.sn){var v=i.cc===e.cc;v&&i.minEndPTS?e.start=i.start+(i.minEndPTS-i.start):e.start=i.start+i.duration}else e.start=Math.max(i.start-e.duration,0)}function m(i,e,r,f,o,v){var s=f-r;s<=0&&(D.logger.warn("Fragment should have a positive duration",e),f=r+e.duration,v=o+e.duration);var c=r,d=f,a=e.startPTS,g=e.endPTS;if((0,b.isFiniteNumber)(a)){var T=Math.abs(a-r);(0,b.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,c=Math.max(r,a),r=Math.min(r,a),o=Math.min(o,e.startDTS),d=Math.min(f,g),f=Math.max(f,g),v=Math.max(v,e.endDTS)}e.duration=f-r;var R=r-e.start;e.appendedPTS=f,e.start=e.startPTS=r,e.maxStartPTS=c,e.startDTS=o,e.endPTS=f,e.minEndPTS=d,e.endDTS=v;var C=e.sn;if(!i||C<i.startSN||C>i.endSN)return 0;var O,F=C-i.startSN,U=i.fragments;for(U[F]=e,O=F;O>0;O--)S(U[O],U[O-1]);for(O=F;O<U.length-1;O++)S(U[O],U[O+1]);return i.fragmentHint&&S(U[U.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,R}function E(i,e){for(var r=null,f=i.fragments,o=f.length-1;o>=0;o--){var v=f[o].initSegment;if(v){r=v;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var s=0,c;if(p(i,e,function(O,F){O.relurl&&(s=O.cc-F.cc),(0,b.isFiniteNumber)(O.startPTS)&&(0,b.isFiniteNumber)(O.endPTS)&&(F.start=F.startPTS=O.startPTS,F.startDTS=O.startDTS,F.appendedPTS=O.appendedPTS,F.maxStartPTS=O.maxStartPTS,F.endPTS=O.endPTS,F.endDTS=O.endDTS,F.minEndPTS=O.minEndPTS,F.duration=O.endPTS-O.startPTS,F.duration&&(c=F),e.PTSKnown=e.alignedSliding=!0),F.elementaryStreams=O.elementaryStreams,F.loader=O.loader,F.stats=O.stats,F.urlId=O.urlId,O.initSegment&&(F.initSegment=O.initSegment,r=O.initSegment)}),r){var d=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;d.forEach(function(O){var F;(!O.initSegment||O.initSegment.relurl===((F=r)===null||F===void 0?void 0:F.relurl))&&(O.initSegment=r)})}if(e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(function(O){return!O}),e.deltaUpdateFailed){D.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var a=e.skippedSegments;a--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=_(i.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));var g=e.fragments;if(s){D.logger.warn("discontinuity sliding from playlist, take drift into account");for(var T=0;T<g.length;T++)g[T].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),y(i.partList,e.partList,function(O,F){F.elementaryStreams=O.elementaryStreams,F.stats=O.stats}),c?m(e,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS):l(i,e),g.length&&(e.totalduration=e.edge-g[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;var R=e.advancedDateTime;if(e.advanced&&R){var C=e.edge;e.driftStart||(e.driftStartTime=R,e.driftStart=C),e.driftEndTime=R,e.driftEnd=C}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime}function _(i,e,r){var f=I({},i);return r&&r.forEach(function(o){delete f[o]}),Object.keys(e).forEach(function(o){var v=new P.DateRange(e[o].attr,f[o]);v.isValid?f[o]=v:D.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(e[o].attr)+'"')}),f}function y(i,e,r){if(i&&e)for(var f=0,o=0,v=i.length;o<=v;o++){var s=i[o],c=e[o+f];s&&c&&s.index===c.index&&s.fragment.sn===c.fragment.sn?r(s,c):f--}}function p(i,e,r){for(var f=e.skippedSegments,o=Math.max(i.startSN,e.startSN)-e.startSN,v=(i.fragmentHint?1:0)+(f?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,s=e.startSN-i.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,a=o;a<=v;a++){var g=d[s+a],T=c[a];f&&!T&&a<f&&(T=e.fragments[a]=g),g&&T&&r(g,T)}}function l(i,e){var r=e.startSN+e.skippedSegments-i.startSN,f=i.fragments;r<0||r>=f.length||n(e,f[r].start)}function n(i,e){if(e){for(var r=i.fragments,f=i.skippedSegments;f<r.length;f++)r[f].start+=e;i.fragmentHint&&(i.fragmentHint.start+=e)}}function t(i,e){var r=1e3*i.levelTargetDuration,f=r/2,o=i.age,v=o>0&&o<r*3,s=e.loading.end-e.loading.start,c,d=i.availabilityDelay;if(i.updated===!1)if(v){var a=333*i.misses;c=Math.max(Math.min(f,s*2),a),i.availabilityDelay=(i.availabilityDelay||0)+c}else c=f;else v?(d=Math.min(d||r/2,o),i.availabilityDelay=d,c=d+r-o):c=r-s;return Math.round(c)}function u(i,e,r){if(!i||!i.details)return null;var f=i.details,o=f.fragments[e-f.startSN];return o||(o=f.fragmentHint,o&&o.sn===e)?o:e<f.startSN&&r&&r.sn===e?r:null}function h(i,e,r){if(!i||!i.details)return null;var f=i.details.partList;if(f)for(var o=f.length;o--;){var v=f[o];if(v.index===r&&v.fragment.sn===e)return v}return null}},"./src/controller/stream-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>h});var b=L("./src/polyfills/number.ts"),D=L("./src/controller/base-stream-controller.ts"),P=L("./src/is-supported.ts"),I=L("./src/events.ts"),M=L("./src/utils/buffer-helper.ts"),A=L("./src/controller/fragment-tracker.ts"),x=L("./src/types/loader.ts"),S=L("./src/loader/fragment.ts"),m=L("./src/demux/transmuxer-interface.ts"),E=L("./src/types/transmuxer.ts"),_=L("./src/controller/gap-controller.ts"),y=L("./src/errors.ts");function p(i,e){for(var r=0;r<e.length;r++){var f=e[r];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(i,f.key,f)}}function l(i,e,r){return e&&p(i.prototype,e),r&&p(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function n(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,t(i,e)}function t(i,e){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,o){return f.__proto__=o,f},t(i,e)}var u=100,h=function(i){n(e,i);function e(f,o){var v;return v=i.call(this,f,o,"[stream-controller]")||this,v.audioCodecSwap=!1,v.gapController=null,v.level=-1,v._forceStartLoad=!1,v.altAudio=!1,v.audioOnly=!1,v.fragPlaying=null,v.onvplaying=null,v.onvseeked=null,v.fragLastKbps=0,v.couldBacktrack=!1,v.backtrackFragment=null,v.audioCodecSwitch=!1,v.videoBuffer=null,v._registerListeners(),v}var r=e.prototype;return r._registerListeners=function(){var o=this.hls;o.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.on(I.Events.ERROR,this.onError,this),o.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),o.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var o=this.hls;o.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.off(I.Events.ERROR,this.onError,this),o.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),o.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(o){if(this.levels){var v=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(u),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var c=s.startLevel;c===-1&&(s.config.testBandwidth&&this.levels.length>1?(c=0,this.bitrateTest=!0):c=s.nextAutoLevel),this.level=s.nextLoadLevel=c,this.loadedmetadata=!1}v>0&&o===-1&&(this.log("Override startPosition with lastCurrentTime @"+v.toFixed(3)),o=v),this.state=D.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=o,this.tick()}else this._forceStartLoad=!0,this.state=D.State.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_LEVEL:{var o,v=this.levels,s=this.level,c=v==null||(o=v[s])===null||o===void 0?void 0:o.details;if(c&&(!c.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(c))break;this.state=D.State.IDLE;break}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var d,a=self.performance.now(),g=this.retryDate;(!g||a>=g||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=D.State.IDLE)}break}this.onTickEnd()},r.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var o,v,s=this.hls,c=this.levelLastLoaded,d=this.levels,a=this.media,g=s.config,T=s.nextLoadLevel;if(!(c===null||!a&&(this.startFragRequested||!g.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!d||!d[T])){var R=d[T];this.level=s.nextLoadLevel=T;var C=R.details;if(!C||this.state===D.State.WAITING_LEVEL||C.live&&this.levelLastLoaded!==T){this.state=D.State.WAITING_LEVEL;return}var O=this.getMainFwdBufferInfo();if(O!==null){var F=O.len,U=this.getMaxBufferLength(R.maxBitrate);if(!(F>=U)){if(this._streamEnded(O,C)){var k={};this.altAudio&&(k.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,k),this.state=D.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>O.end&&(this.backtrackFragment=null);var N=this.backtrackFragment?this.backtrackFragment.start:O.end,w=this.getNextFragment(N,C);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"&&this.fragmentTracker.getState(w)!==A.FragmentState.OK){var K,G=((K=this.backtrackFragment)!=null?K:w).sn,H=G-C.startSN,V=C.fragments[H-1];V&&w.cc===V.cc&&(w=V,this.fragmentTracker.removeFragment(V))}else this.backtrackFragment&&O.len&&(this.backtrackFragment=null);if(w&&this.fragmentTracker.getState(w)===A.FragmentState.OK&&this.nextLoadPosition>N){var X=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;a&&this.afterBufferFlushed(a,X,x.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,C)}w&&(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),((o=w.decryptdata)===null||o===void 0?void 0:o.keyFormat)==="identity"&&!((v=w.decryptdata)!==null&&v!==void 0&&v.key)?this.loadKey(w,C):this.loadFragment(w,C,N))}}}},r.loadFragment=function(o,v,s){var c,d=this.fragmentTracker.getState(o);this.fragCurrent=o,d===A.FragmentState.NOT_LOADED?o.sn==="initSegment"?this._loadInitSegment(o):this.bitrateTest?(this.log("Fragment "+o.sn+" of level "+o.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(o)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,o,v,s)):d===A.FragmentState.APPENDING?this.reduceMaxBufferLength(o.duration)&&this.fragmentTracker.removeFragment(o):((c=this.media)===null||c===void 0?void 0:c.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(o){var v=this.fragmentTracker.getAppendedFrag(o,x.PlaylistLevelType.MAIN);return v&&"fragment"in v?v.fragment:v},r.getBufferedFrag=function(o){return this.fragmentTracker.getBufferedFrag(o,x.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(o){return o?this.getBufferedFrag(o.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var o=this.levels,v=this.media;if(v!=null&&v.readyState){var s,c=this.getAppendedFrag(v.currentTime);if(c&&c.start>1&&this.flushMainBuffer(0,c.start-1),!v.paused&&o){var d=this.hls.nextLoadLevel,a=o[d],g=this.fragLastKbps;g&&this.fragCurrent?s=this.fragCurrent.duration*a.maxBitrate/(1e3*g)+1:s=0}else s=0;var T=this.getBufferedFrag(v.currentTime+s);if(T){var R=this.followingBufferedFrag(T);if(R){this.abortCurrentFrag();var C=R.maxStartPTS?R.maxStartPTS:R.start,O=R.duration,F=Math.max(T.end,C+Math.min(Math.max(O-this.config.maxFragLookUpTolerance,O*.5),O*.75));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var o=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,o!=null&&o.loader&&o.loader.abort(),this.state){case D.State.KEY_LOADING:case D.State.FRAG_LOADING:case D.State.FRAG_LOADING_WAITING_RETRY:case D.State.PARSING:case D.State.PARSED:this.state=D.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(o,v){i.prototype.flushMainBuffer.call(this,o,v,this.altAudio?"video":null)},r.onMediaAttached=function(o,v){i.prototype.onMediaAttached.call(this,o,v);var s=v.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),s.addEventListener("playing",this.onvplaying),s.addEventListener("seeked",this.onvseeked),this.gapController=new _.default(this.config,s,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var o=this.media;o&&this.onvplaying&&this.onvseeked&&(o.removeEventListener("playing",this.onvplaying),o.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var o=this.media,v=o?o.currentTime:null;(0,b.isFiniteNumber)(v)&&this.log("Media seeked to "+v.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},r.onManifestParsed=function(o,v){var s=!1,c=!1,d;v.levels.forEach(function(a){d=a.audioCodec,d&&(d.indexOf("mp4a.40.2")!==-1&&(s=!0),d.indexOf("mp4a.40.5")!==-1&&(c=!0))}),this.audioCodecSwitch=s&&c&&!(0,P.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=v.levels,this.startFragRequested=!1},r.onLevelLoading=function(o,v){var s=this.levels;if(!(!s||this.state!==D.State.IDLE)){var c=s[v.level];(!c.details||c.details.live&&this.levelLastLoaded!==v.level||this.waitForCdnTuneIn(c.details))&&(this.state=D.State.WAITING_LEVEL)}},r.onLevelLoaded=function(o,v){var s,c=this.levels,d=v.level,a=v.details,g=a.totalduration;if(!c){this.warn("Levels were reset while loading level "+d);return}this.log("Level "+d+" loaded ["+a.startSN+","+a.endSN+"], cc ["+a.startCC+", "+a.endCC+"] duration:"+g);var T=this.fragCurrent;T&&(this.state===D.State.FRAG_LOADING||this.state===D.State.FRAG_LOADING_WAITING_RETRY)&&T.level!==v.level&&T.loader&&(this.state=D.State.IDLE,this.backtrackFragment=null,T.loader.abort());var R=c[d],C=0;if(a.live||(s=R.details)!==null&&s!==void 0&&s.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;C=this.alignPlaylists(a,R.details)}if(R.details=a,this.levelLastLoaded=d,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:a,level:d}),this.state===D.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=D.State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,C),this.tick()},r._handleFragmentLoadProgress=function(o){var v,s=o.frag,c=o.part,d=o.payload,a=this.levels;if(!a){this.warn("Levels were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var g=a[s.level],T=g.details;if(!T){this.warn("Dropping fragment "+s.sn+" of level "+s.level+" after level details were reset");return}var R=g.videoCodec,C=T.PTSKnown||!T.live,O=(v=s.initSegment)===null||v===void 0?void 0:v.data,F=this._getAudioCodec(g),U=this.transmuxer=this.transmuxer||new m.default(this.hls,x.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=c?c.index:-1,N=k!==-1,w=new E.ChunkMetadata(s.level,s.sn,s.stats.chunkCount,d.byteLength,k,N),K=this.initPTS[s.cc];U.push(d,O,F,R,s,c,T.totalduration,C,w,K)},r.onAudioTrackSwitching=function(o,v){var s=this.altAudio,c=!!v.url,d=v.id;if(!c){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a!=null&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var g=this.hls;s&&g.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),g.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:d})}},r.onAudioTrackSwitched=function(o,v){var s=v.id,c=!!this.hls.audioTracks[s].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},r.onBufferCreated=function(o,v){var s=v.tracks,c,d,a=!1;for(var g in s){var T=s[g];if(T.id==="main"){if(d=g,c=T,g==="video"){var R=s[g];R&&(this.videoBuffer=R.buffer)}}else a=!0}a&&c?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(o,v){var s=v.frag,c=v.part;if(!(s&&s.type!==x.PlaylistLevelType.MAIN)){if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(c?" p: "+c.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state),this.state===D.State.PARSED&&(this.state=D.State.IDLE);return}var d=c?c.stats:s.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),s.sn!=="initSegment"&&(this.fragPrevious=s),this.fragBufferedComplete(s,c)}},r.onError=function(o,v){switch(v.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.MAIN,v);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==D.State.ERROR&&(v.fatal?(this.warn(""+v.details),this.state=D.State.ERROR):!v.levelRetry&&this.state===D.State.WAITING_LEVEL&&(this.state=D.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(v.parent==="main"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var s=!0,c=this.getFwdBufferInfo(this.media,x.PlaylistLevelType.MAIN);c&&c.len>.5&&(s=!this.reduceMaxBufferLength(c.len)),s&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},r.checkBuffer=function(){var o=this.media,v=this.gapController;if(!(!o||!v||!o.readyState)){if(this.loadedmetadata||!M.BufferHelper.getBuffered(o).length){var s=this.state!==D.State.IDLE?this.fragCurrent:null;v.poll(this.lastCurrentTime,s)}this.lastCurrentTime=o.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=D.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(o,v){var s=v.type;if(s!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var c=(s===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(c,s,x.PlaylistLevelType.MAIN)}},r.onLevelsUpdated=function(o,v){this.levels=v.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var o=this.media;if(o){var v=o.currentTime,s=this.startPosition;if(s>=0&&v<s){if(o.seeking){this.log("could not seek to "+s+", already seeking at "+v);return}var c=M.BufferHelper.getBuffered(o),d=c.length?c.start(0):0,a=d-s;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+a+" to match buffer start"),s+=a,this.startPosition=s),this.log("seek to target start position "+s+" from current time "+v),o.currentTime=s}}},r._getAudioCodec=function(o){var v=this.config.defaultAudioCodec||o.audioCodec;return this.audioCodecSwap&&v&&(this.log("Swapping audio codec"),v.indexOf("mp4a.40.5")!==-1?v="mp4a.40.2":v="mp4a.40.5"),v},r._loadBitrateTestFrag=function(o){var v=this;o.bitrateTest=!0,this._doFragLoad(o).then(function(s){var c=v.hls;if(!(!s||c.nextLoadLevel||v.fragContextChanged(o))){v.fragLoadError=0,v.state=D.State.IDLE,v.startFragRequested=!1,v.bitrateTest=!1;var d=o.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),c.trigger(I.Events.FRAG_LOADED,s),o.bitrateTest=!1}})},r._handleTransmuxComplete=function(o){var v,s="main",c=this.hls,d=o.remuxResult,a=o.chunkMeta,g=this.getCurrentContext(a);if(!g){this.warn("The loading context changed while buffering fragment "+a.sn+" of level "+a.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(a.level);return}var T=g.frag,R=g.part,C=g.level,O=d.video,F=d.text,U=d.id3,k=d.initSegment,N=C.details,w=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(T)){if(this.state=D.State.PARSING,k){k.tracks&&(this._bufferInitSegment(C,k.tracks,T,a),c.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:k.tracks}));var K=k.initPTS,G=k.timescale;(0,b.isFiniteNumber)(K)&&(this.initPTS[T.cc]=K,c.trigger(I.Events.INIT_PTS_FOUND,{frag:T,id:s,initPTS:K,timescale:G}))}if(O&&d.independent!==!1){if(N){var H=O.startPTS,V=O.endPTS,X=O.startDTS,Y=O.endDTS;if(R)R.elementaryStreams[O.type]={startPTS:H,endPTS:V,startDTS:X,endDTS:Y};else if(O.firstKeyFrame&&O.independent&&(this.couldBacktrack=!0),O.dropped&&O.independent){var Q=this.getMainFwdBufferInfo(),$=(Q?Q.end:this.getLoadPosition())+this.config.maxBufferHole,j=O.firstKeyFramePTS?O.firstKeyFramePTS:H;if($<j-this.config.maxBufferHole){this.backtrack(T);return}T.setElementaryStreamInfo(O.type,T.start,V,T.start,Y,!0)}T.setElementaryStreamInfo(O.type,H,V,X,Y),this.backtrackFragment&&(this.backtrackFragment=T),this.bufferFragmentData(O,T,R,a)}}else if(d.independent===!1){this.backtrack(T);return}if(w){var z=w.startPTS,J=w.endPTS,Z=w.startDTS,q=w.endDTS;R&&(R.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:z,endPTS:J,startDTS:Z,endDTS:q}),T.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,z,J,Z,q),this.bufferFragmentData(w,T,R,a)}if(N&&U!==null&&U!==void 0&&(v=U.samples)!==null&&v!==void 0&&v.length){var ae={id:s,frag:T,details:N,samples:U.samples};c.trigger(I.Events.FRAG_PARSING_METADATA,ae)}if(N&&F){var ee={id:s,frag:T,details:N,samples:F.samples};c.trigger(I.Events.FRAG_PARSING_USERDATA,ee)}}},r._bufferInitSegment=function(o,v,s,c){var d=this;if(this.state===D.State.PARSING){this.audioOnly=!!v.audio&&!v.video,this.altAudio&&!this.audioOnly&&delete v.audio;var a=v.audio,g=v.video,T=v.audiovideo;if(a){var R=o.audioCodec,C=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(R&&(R.indexOf("mp4a.40.5")!==-1?R="mp4a.40.2":R="mp4a.40.5"),a.metadata.channelCount!==1&&C.indexOf("firefox")===-1&&(R="mp4a.40.5")),C.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(R="mp4a.40.2",this.log("Android: force audio codec to "+R)),o.audioCodec&&o.audioCodec!==R&&this.log('Swapping manifest audio codec "'+o.audioCodec+'" for "'+R+'"'),a.levelCodec=R,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(R||"")+"/"+(o.audioCodec||"")+"/"+a.codec+"]")}g&&(g.levelCodec=o.videoCodec,g.id="main",this.log("Init video buffer, container:"+g.container+", codecs[level/parsed]=["+(o.videoCodec||"")+"/"+g.codec+"]")),T&&this.log("Init audiovideo buffer, container:"+T.container+", codecs[level/parsed]=["+(o.attrs.CODECS||"")+"/"+T.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,v),Object.keys(v).forEach(function(O){var F=v[O],U=F.initSegment;U!=null&&U.byteLength&&d.hls.trigger(I.Events.BUFFER_APPENDING,{type:O,data:U,frag:s,part:null,chunkMeta:c,parent:s.type})}),this.tick()}},r.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,x.PlaylistLevelType.MAIN)},r.backtrack=function(o){this.couldBacktrack=!0,this.backtrackFragment=o,this.resetTransmuxer(),this.flushBufferGap(o),this.fragmentTracker.removeFragment(o),this.fragPrevious=null,this.nextLoadPosition=o.start,this.state=D.State.IDLE},r.checkFragmentChanged=function(){var o=this.media,v=null;if(o&&o.readyState>1&&o.seeking===!1){var s=o.currentTime;if(M.BufferHelper.isBuffered(o,s)?v=this.getAppendedFrag(s):M.BufferHelper.isBuffered(o,s+.1)&&(v=this.getAppendedFrag(s+.1)),v){this.backtrackFragment=null;var c=this.fragPlaying,d=v.level;(!c||v.sn!==c.sn||c.level!==d||v.urlId!==c.urlId)&&(this.hls.trigger(I.Events.FRAG_CHANGED,{frag:v}),(!c||c.level!==d)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:d}),this.fragPlaying=v)}}},l(e,[{key:"nextLevel",get:function(){var o=this.nextBufferedFrag;return o?o.level:-1}},{key:"currentFrag",get:function(){var o=this.media;return o?this.fragPlaying||this.getAppendedFrag(o.currentTime):null}},{key:"currentProgramDateTime",get:function(){var o=this.media;if(o){var v=o.currentTime,s=this.currentFrag;if(s&&(0,b.isFiniteNumber)(v)&&(0,b.isFiniteNumber)(s.programDateTime)){var c=s.programDateTime+(v-s.start)*1e3;return new Date(c)}}return null}},{key:"currentLevel",get:function(){var o=this.currentFrag;return o?o.level:-1}},{key:"nextBufferedFrag",get:function(){var o=this.currentFrag;return o?this.followingBufferedFrag(o):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),e}(D.default)},"./src/controller/subtitle-stream-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{SubtitleStreamController:()=>n});var b=L("./src/events.ts"),D=L("./src/utils/buffer-helper.ts"),P=L("./src/controller/fragment-finders.ts"),I=L("./src/utils/discontinuities.ts"),M=L("./src/controller/level-helper.ts"),A=L("./src/controller/fragment-tracker.ts"),x=L("./src/controller/base-stream-controller.ts"),S=L("./src/types/loader.ts"),m=L("./src/types/level.ts");function E(u,h){for(var i=0;i<h.length;i++){var e=h[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(u,e.key,e)}}function _(u,h,i){return h&&E(u.prototype,h),i&&E(u,i),Object.defineProperty(u,"prototype",{writable:!1}),u}function y(u,h){u.prototype=Object.create(h.prototype),u.prototype.constructor=u,p(u,h)}function p(u,h){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},p(u,h)}var l=500,n=function(u){y(h,u);function h(e,r){var f;return f=u.call(this,e,r,"[subtitle-stream-controller]")||this,f.levels=[],f.currentTrackId=-1,f.tracksBuffered=[],f.mainDetails=null,f._registerListeners(),f}var i=h.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var r=this.hls;r.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(b.Events.ERROR,this.onError,this),r.on(b.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(b.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(b.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var r=this.hls;r.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(b.Events.ERROR,this.onError,this),r.off(b.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(b.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(b.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.startLoad=function(){this.stopLoad(),this.state=x.State.IDLE,this.setInterval(l),this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(r,f){this.mainDetails=f.details},i.onSubtitleFragProcessed=function(r,f){var o=f.frag,v=f.success;if(this.fragPrevious=o,this.state=x.State.IDLE,!!v){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var c,d=o.start,a=0;a<s.length;a++)if(d>=s[a].start&&d<=s[a].end){c=s[a];break}var g=o.start+o.duration;c?c.end=g:(c={start:d,end:g},s.push(c)),this.fragmentTracker.fragBuffered(o)}}},i.onBufferFlushing=function(r,f){var o=f.startOffset,v=f.endOffset;if(o===0&&v!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,c=this.levels;if(!c.length||!c[s]||!c[s].details)return;var d=c[s].details,a=d.targetduration,g=v-a;if(g<=0)return;f.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(T){for(var R=0;R<T.length;){if(T[R].end<=g){T.shift();continue}else if(T[R].start<g)T[R].start=g;else break;R++}}),this.fragmentTracker.removeFragmentsInRange(o,g,S.PlaylistLevelType.SUBTITLE)}},i.onError=function(r,f){var o,v=f.frag;!v||v.type!==S.PlaylistLevelType.SUBTITLE||((o=this.fragCurrent)!==null&&o!==void 0&&o.loader&&this.fragCurrent.loader.abort(),this.state=x.State.IDLE)},i.onSubtitleTracksUpdated=function(r,f){var o=this,v=f.subtitleTracks;this.tracksBuffered=[],this.levels=v.map(function(s){return new m.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){o.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(r,f){if(this.currentTrackId=f.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var o=this.levels[this.currentTrackId];o!=null&&o.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,o&&this.setInterval(l)},i.onSubtitleTrackLoaded=function(r,f){var o,v=f.details,s=f.id,c=this.currentTrackId,d=this.levels;if(d.length){var a=d[c];if(!(s>=d.length||s!==c||!a)){if(this.mediaBuffer=this.mediaBufferTimeRanges,v.live||(o=a.details)!==null&&o!==void 0&&o.live){var g=this.mainDetails;if(v.deltaUpdateFailed||!g)return;var T=g.fragments[0];if(!a.details)v.hasProgramDateTime&&g.hasProgramDateTime?(0,I.alignMediaPlaylistByPDT)(v,g):T&&(0,M.addSliding)(v,T.start);else{var R=this.alignPlaylists(v,a.details);R===0&&T&&(0,M.addSliding)(v,T.start)}}if(a.details=v,this.levelLastLoaded=s,this.tick(),v.live&&!this.fragCurrent&&this.media&&this.state===x.State.IDLE){var C=(0,P.findFragmentByPTS)(null,v.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)}}}},i._handleFragmentLoadComplete=function(r){var f=r.frag,o=r.payload,v=f.decryptdata,s=this.hls;if(!this.fragContextChanged(f)&&o&&o.byteLength>0&&v&&v.key&&v.iv&&v.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(o),v.key.buffer,v.iv.buffer).then(function(d){var a=performance.now();s.trigger(b.Events.FRAG_DECRYPTED,{frag:f,payload:d,stats:{tstart:c,tdecrypt:a}})})}},i.doTick=function(){if(!this.media){this.state=x.State.IDLE;return}if(this.state===x.State.IDLE){var r=this.currentTrackId,f=this.levels;if(!f.length||!f[r]||!f[r].details)return;var o=f[r].details,v=o.targetduration,s=this.config,c=this.media,d=D.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],c.currentTime-v,s.maxBufferHole),a=d.end,g=d.len,T=this.getMaxBufferLength()+v;if(g>T)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var R=o.fragments,C=R.length,O=o.edge,F,U=this.fragPrevious;if(a<O){var k=s.maxFragLookUpTolerance;F=(0,P.findFragmentByPTS)(U,R,Math.max(R[0].start,a),k),!F&&U&&U.start<R[0].start&&(F=R[0])}else F=R[C-1];if(F=this.mapToInitFragWhenRequired(F),!F||this.fragmentTracker.getState(F)!==A.FragmentState.NOT_LOADED)return;F.encrypted?this.loadKey(F,o):this.loadFragment(F,o,a)}},i.loadFragment=function(r,f,o){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):u.prototype.loadFragment.call(this,r,f,o)},_(h,[{key:"mediaBufferTimeRanges",get:function(){return new t(this.tracksBuffered[this.currentTrackId]||[])}}]),h}(x.default),t=function(h){this.buffered=void 0;var i=function(r,f,o){if(f=f>>>0,f>o-1)throw new DOMException("Failed to execute '"+r+"' on 'TimeRanges': The index provided ("+f+") is greater than the maximum bound ("+o+")");return h[f][r]};this.buffered={get length(){return h.length},end:function(r){return i("end",r,h.length)},start:function(r){return i("start",r,h.length)}}}},"./src/controller/subtitle-track-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>_});var b=L("./src/events.ts"),D=L("./src/utils/texttrack-utils.ts"),P=L("./src/controller/base-playlist-controller.ts"),I=L("./src/types/loader.ts");function M(y,p){for(var l=0;l<p.length;l++){var n=p[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(y,n.key,n)}}function A(y,p,l){return p&&M(y.prototype,p),l&&M(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}function x(y,p){y.prototype=Object.create(p.prototype),y.prototype.constructor=y,S(y,p)}function S(y,p){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},S(y,p)}var m=function(y){x(p,y);function p(n){var t;return t=y.call(this,n,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t._subtitleDisplay=!0,t.registerListeners(),t}var l=p.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},l.registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this)},l.onMediaAttached=function(t,u){this.media=u.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},l.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=E(this.media.textTracks);t.forEach(function(u){(0,D.clearCurrentCues)(u)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(t,u){this.tracks=u.subtitleTracks},l.onSubtitleTrackLoaded=function(t,u){var h=u.id,i=u.details,e=this.trackId,r=this.tracksInGroup[e];if(!r){this.warn("Invalid subtitle track id "+h);return}var f=r.details;r.details=u.details,this.log("subtitle track "+h+" loaded ["+i.startSN+"-"+i.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,u,f))},l.onLevelLoading=function(t,u){this.switchLevel(u.level)},l.onLevelSwitching=function(t,u){this.switchLevel(u.level)},l.switchLevel=function(t){var u=this.hls.levels[t];if(u!=null&&u.textGroupIds){var h=u.textGroupIds[u.urlId];if(this.groupId!==h){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,e=this.tracks.filter(function(o){return!h||o.groupId===h});this.tracksInGroup=e;var r=this.findTrackId(i==null?void 0:i.name)||this.findTrackId();this.groupId=h;var f={subtitleTracks:e};this.log("Updating subtitle tracks, "+e.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(b.Events.SUBTITLE_TRACKS_UPDATED,f),r!==-1&&this.setSubtitleTrack(r,i)}}},l.findTrackId=function(t){for(var u=this.tracksInGroup,h=0;h<u.length;h++){var i=u[h];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},l.onError=function(t,u){y.prototype.onError.call(this,t,u),!(u.fatal||!u.context)&&u.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&u.context.id===this.trackId&&u.context.groupId===this.groupId&&this.retryLoadingOrFail(u)},l.loadPlaylist=function(t){var u=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(u)){var h=u.id,i=u.groupId,e=u.url;if(t)try{e=t.addDirectives(e)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+h),this.hls.trigger(b.Events.SUBTITLE_TRACK_LOADING,{url:e,id:h,groupId:i,deliveryDirectives:t||null})}},l.toggleTrackModes=function(t){var u=this,h=this.media,i=this.trackId;if(h){var e=E(h.textTracks),r=e.filter(function(v){return v.groupId===u.groupId});if(t===-1)[].slice.call(e).forEach(function(v){v.mode="disabled"});else{var f=r[i];f&&(f.mode="disabled")}var o=r[t];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}},l.setSubtitleTrack=function(t,u){var h,i=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(h=i[t])!==null&&h!==void 0&&h.details)||t<-1||t>=i.length)){this.clearTimer();var e=i[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,e){var r=e.id,f=e.groupId,o=f===void 0?"":f,v=e.name,s=e.type,c=e.url;this.hls.trigger(b.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:o,name:v,type:s,url:c});var d=this.switchParams(e.url,u==null?void 0:u.details);this.loadPlaylist(d)}else this.hls.trigger(b.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,u=E(this.media.textTracks),h=0;h<u.length;h++)if(u[h].mode==="hidden")t=h;else if(u[h].mode==="showing"){t=h;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},A(p,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,u)}}]),p}(P.default);function E(y){for(var p=[],l=0;l<y.length;l++){var n=y[l];n.kind==="subtitles"&&n.label&&p.push(y[l])}return p}const _=m},"./src/controller/timeline-controller.ts":(W,B,L)=>{L.r(B),L.d(B,{TimelineController:()=>_});var b=L("./src/polyfills/number.ts"),D=L("./src/events.ts"),P=L("./src/utils/cea-608-parser.ts"),I=L("./src/utils/output-filter.ts"),M=L("./src/utils/webvtt-parser.ts"),A=L("./src/utils/texttrack-utils.ts"),x=L("./src/utils/imsc1-ttml-parser.ts"),S=L("./src/utils/mp4-tools.ts"),m=L("./src/types/loader.ts"),E=L("./src/utils/logger.ts"),_=function(){function n(u){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=u,this.config=u.config,this.Cues=u.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var h=new I.default(this,"textTrack1"),i=new I.default(this,"textTrack2"),e=new I.default(this,"textTrack3"),r=new I.default(this,"textTrack4");this.cea608Parser1=new P.default(1,h,i),this.cea608Parser2=new P.default(3,e,r)}u.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(D.Events.FRAG_LOADING,this.onFragLoading,this),u.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),u.on(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),u.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),u.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=n.prototype;return t.destroy=function(){var h=this.hls;h.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(D.Events.FRAG_LOADING,this.onFragLoading,this),h.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),h.off(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.off(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.off(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(h,i,e,r,f){for(var o=!1,v=f.length;v--;){var s=f[v],c=p(s[0],s[1],i,e);if(c>=0&&(s[0]=Math.min(s[0],i),s[1]=Math.max(s[1],e),o=!0,c/(e-i)>.5))return}if(o||f.push([i,e]),this.config.renderTextTracksNatively){var d=this.captionsTracks[h];this.Cues.newCue(d,i,e,r)}else{var a=this.Cues.newCue(null,i,e,r);this.hls.trigger(D.Events.CUES_PARSED,{type:"captions",cues:a,track:h})}},t.onInitPtsFound=function(h,i){var e=this,r=i.frag,f=i.id,o=i.initPTS,v=i.timescale,s=this.unparsedVttFrags;f==="main"&&(this.initPTS[r.cc]=o,this.timescale[r.cc]=v),s.length&&(this.unparsedVttFrags=[],s.forEach(function(c){e.onFragLoaded(D.Events.FRAG_LOADED,c)}))},t.getExistingTrack=function(h){var i=this.media;if(i)for(var e=0;e<i.textTracks.length;e++){var r=i.textTracks[e];if(r[h])return r}return null},t.createCaptionsTrack=function(h){this.config.renderTextTracksNatively?this.createNativeTrack(h):this.createNonNativeTrack(h)},t.createNativeTrack=function(h){if(!this.captionsTracks[h]){var i=this.captionsProperties,e=this.captionsTracks,r=this.media,f=i[h],o=f.label,v=f.languageCode,s=this.getExistingTrack(h);if(s)e[h]=s,(0,A.clearCurrentCues)(e[h]),(0,A.sendAddTrackEvent)(e[h],r);else{var c=this.createTextTrack("captions",o,v);c&&(c[h]=!0,e[h]=c)}}},t.createNonNativeTrack=function(h){if(!this.nonNativeCaptionsTracks[h]){var i=this.captionsProperties[h];if(i){var e=i.label,r={_id:h,label:e,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[h]=r,this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},t.createTextTrack=function(h,i,e){var r=this.media;if(r)return r.addTextTrack(h,i,e)},t.onMediaAttaching=function(h,i){this.media=i.media,this._cleanTracks()},t.onMediaDetaching=function(){var h=this.captionsTracks;Object.keys(h).forEach(function(i){(0,A.clearCurrentCues)(h[i]),delete h[i]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var h=this.media;if(h){var i=h.textTracks;if(i)for(var e=0;e<i.length;e++)(0,A.clearCurrentCues)(i[e])}},t.onSubtitleTracksUpdated=function(h,i){var e=this;this.textTracks=[];var r=i.subtitleTracks||[],f=r.some(function(c){return c.textCodec===x.IMSC1_CODEC});if(this.config.enableWebVTT||f&&this.config.enableIMSC1){var o=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var v=this.media?this.media.textTracks:[];this.tracks.forEach(function(c,d){var a;if(d<v.length){for(var g=null,T=0;T<v.length;T++)if(y(v[T],c)){g=v[T];break}g&&(a=g)}if(a)(0,A.clearCurrentCues)(a);else{var R=e._captionsOrSubtitlesFromCharacteristics(c);a=e.createTextTrack(R,c.name,c.lang),a&&(a.mode="disabled")}a&&(a.groupId=c.groupId,e.textTracks.push(a))})}else if(!o&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},t._captionsOrSubtitlesFromCharacteristics=function(h){var i;if((i=h.attrs)!==null&&i!==void 0&&i.CHARACTERISTICS){var e=/transcribes-spoken-dialog/gi.test(h.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(h.attrs.CHARACTERISTICS);if(e&&r)return"captions"}return"subtitles"},t.onManifestLoaded=function(h,i){var e=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(r){var f=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(f){var o="textTrack"+f[1],v=e.captionsProperties[o];v&&(v.label=r.name,r.lang&&(v.languageCode=r.lang),v.media=r)}})},t.closedCaptionsForLevel=function(h){var i=this.hls.levels[h.level];return i==null?void 0:i.attrs["CLOSED-CAPTIONS"]},t.onFragLoading=function(h,i){var e=this.cea608Parser1,r=this.cea608Parser2,f=this.lastSn,o=this.lastPartIndex;if(!(!this.enabled||!(e&&r))&&i.frag.type===m.PlaylistLevelType.MAIN){var v,s,c=i.frag.sn,d=(v=i==null||(s=i.part)===null||s===void 0?void 0:s.index)!=null?v:-1;c===f+1||c===f&&d===o+1||(e.reset(),r.reset()),this.lastSn=c,this.lastPartIndex=d}},t.onFragLoaded=function(h,i){var e=i.frag,r=i.payload,f=this.initPTS,o=this.unparsedVttFrags;if(e.type===m.PlaylistLevelType.SUBTITLE)if(r.byteLength){if(!(0,b.isFiniteNumber)(f[e.cc])){o.push(i),f.length&&this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")});return}var v=e.decryptdata,s="stats"in i;if(v==null||v.key==null||v.method!=="AES-128"||s){var c=this.tracks[e.level],d=this.vttCCs;d[e.cc]||(d[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),c&&c.textCodec===x.IMSC1_CODEC?this._parseIMSC1(e,r):this._parseVTTs(e,r,d)}}else this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(h,i){var e=this,r=this.hls;(0,x.parseIMSC1)(i,this.initPTS[h.cc],this.timescale[h.cc],function(f){e._appendCues(f,h.level),r.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(f){E.logger.log("Failed to parse IMSC1: "+f),r.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:f})})},t._parseVTTs=function(h,i,e){var r,f=this,o=this.hls,v=(r=h.initSegment)!==null&&r!==void 0&&r.data?(0,S.appendUint8Array)(h.initSegment.data,new Uint8Array(i)):i;(0,M.parseWebVTT)(v,this.initPTS[h.cc],this.timescale[h.cc],e,h.cc,h.start,function(s){f._appendCues(s,h.level),o.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(s){f._fallbackToIMSC1(h,i),E.logger.log("Failed to parse VTT cue: "+s),o.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:s})})},t._fallbackToIMSC1=function(h,i){var e=this,r=this.tracks[h.level];r.textCodec||(0,x.parseIMSC1)(i,this.initPTS[h.cc],this.timescale[h.cc],function(){r.textCodec=x.IMSC1_CODEC,e._parseIMSC1(h,i)},function(){r.textCodec="wvtt"})},t._appendCues=function(h,i){var e=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[i];if(!r||r.mode==="disabled")return;h.forEach(function(v){return(0,A.addCueToTrack)(r,v)})}else{var f=this.tracks[i];if(!f)return;var o=f.default?"default":"subtitles"+i;e.trigger(D.Events.CUES_PARSED,{type:"subtitles",cues:h,track:o})}},t.onFragDecrypted=function(h,i){var e=i.frag;if(e.type===m.PlaylistLevelType.SUBTITLE){if(!(0,b.isFiniteNumber)(this.initPTS[e.cc])){this.unparsedVttFrags.push(i);return}this.onFragLoaded(D.Events.FRAG_LOADED,i)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(h,i){var e=this.cea608Parser1,r=this.cea608Parser2;if(!(!this.enabled||!(e&&r))){var f=i.frag,o=i.samples;if(!(f.type===m.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(f)==="NONE"))for(var v=0;v<o.length;v++){var s=o[v].bytes;if(s){var c=this.extractCea608Data(s);e.addData(o[v].pts,c[0]),r.addData(o[v].pts,c[1])}}}},t.onBufferFlushing=function(h,i){var e=i.startOffset,r=i.endOffset,f=i.endOffsetSubtitles,o=i.type,v=this.media;if(!(!v||v.currentTime<r)){if(!o||o==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(d){return(0,A.removeCuesInRange)(s[d],e,r)})}if(this.config.renderTextTracksNatively&&e===0&&f!==void 0){var c=this.textTracks;Object.keys(c).forEach(function(d){return(0,A.removeCuesInRange)(c[d],e,f)})}}},t.extractCea608Data=function(h){for(var i=[[],[]],e=h[0]&31,r=2,f=0;f<e;f++){var o=h[r++],v=127&h[r++],s=127&h[r++];if(!(v===0&&s===0)){var c=(4&o)!==0;if(c){var d=3&o;(d===0||d===1)&&(i[d].push(v),i[d].push(s))}}}return i},n}();function y(n,t){return n&&n.label===t.name&&!(n.textTrack1||n.textTrack2)}function p(n,t,u,h){return Math.min(t,h)-Math.max(n,u)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});var b=function(){function D(I,M){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=M}var P=D.prototype;return P.decrypt=function(M,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,M)},D}()},"./src/crypt/aes-decryptor.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>P,removePadding:()=>D});var b=L("./src/utils/typed-array.ts");function D(I){var M=I.byteLength,A=M&&new DataView(I.buffer).getUint8(M-1);return A?(0,b.sliceUint8)(I,0,M-A):I}var P=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var M=I.prototype;return M.uint8ArrayToUint32Array_=function(x){for(var S=new DataView(x),m=new Uint32Array(4),E=0;E<4;E++)m[E]=S.getUint32(E*4);return m},M.initTable=function(){var x=this.sBox,S=this.invSBox,m=this.subMix,E=m[0],_=m[1],y=m[2],p=m[3],l=this.invSubMix,n=l[0],t=l[1],u=l[2],h=l[3],i=new Uint32Array(256),e=0,r=0,f=0;for(f=0;f<256;f++)f<128?i[f]=f<<1:i[f]=f<<1^283;for(f=0;f<256;f++){var o=r^r<<1^r<<2^r<<3^r<<4;o=o>>>8^o&255^99,x[e]=o,S[o]=e;var v=i[e],s=i[v],c=i[s],d=i[o]*257^o*16843008;E[e]=d<<24|d>>>8,_[e]=d<<16|d>>>16,y[e]=d<<8|d>>>24,p[e]=d,d=c*16843009^s*65537^v*257^e*16843008,n[o]=d<<24|d>>>8,t[o]=d<<16|d>>>16,u[o]=d<<8|d>>>24,h[o]=d,e?(e=v^i[i[i[c^v]]],r^=i[i[r]]):e=r=1}},M.expandKey=function(x){for(var S=this.uint8ArrayToUint32Array_(x),m=!0,E=0;E<S.length&&m;)m=S[E]===this.key[E],E++;if(!m){this.key=S;var _=this.keySize=S.length;if(_!==4&&_!==6&&_!==8)throw new Error("Invalid aes key size="+_);var y=this.ksRows=(_+6+1)*4,p,l,n=this.keySchedule=new Uint32Array(y),t=this.invKeySchedule=new Uint32Array(y),u=this.sBox,h=this.rcon,i=this.invSubMix,e=i[0],r=i[1],f=i[2],o=i[3],v,s;for(p=0;p<y;p++){if(p<_){v=n[p]=S[p];continue}s=v,p%_===0?(s=s<<8|s>>>24,s=u[s>>>24]<<24|u[s>>>16&255]<<16|u[s>>>8&255]<<8|u[s&255],s^=h[p/_|0]<<24):_>6&&p%_===4&&(s=u[s>>>24]<<24|u[s>>>16&255]<<16|u[s>>>8&255]<<8|u[s&255]),n[p]=v=(n[p-_]^s)>>>0}for(l=0;l<y;l++)p=y-l,l&3?s=n[p]:s=n[p-4],l<4||p<=4?t[l]=s:t[l]=e[u[s>>>24]]^r[u[s>>>16&255]]^f[u[s>>>8&255]]^o[u[s&255]],t[l]=t[l]>>>0}},M.networkToHostOrderSwap=function(x){return x<<24|(x&65280)<<8|(x&16711680)>>8|x>>>24},M.decrypt=function(x,S,m){for(var E=this.keySize+6,_=this.invKeySchedule,y=this.invSBox,p=this.invSubMix,l=p[0],n=p[1],t=p[2],u=p[3],h=this.uint8ArrayToUint32Array_(m),i=h[0],e=h[1],r=h[2],f=h[3],o=new Int32Array(x),v=new Int32Array(o.length),s,c,d,a,g,T,R,C,O,F,U,k,N,w,K=this.networkToHostOrderSwap;S<o.length;){for(O=K(o[S]),F=K(o[S+1]),U=K(o[S+2]),k=K(o[S+3]),g=O^_[0],T=k^_[1],R=U^_[2],C=F^_[3],N=4,w=1;w<E;w++)s=l[g>>>24]^n[T>>16&255]^t[R>>8&255]^u[C&255]^_[N],c=l[T>>>24]^n[R>>16&255]^t[C>>8&255]^u[g&255]^_[N+1],d=l[R>>>24]^n[C>>16&255]^t[g>>8&255]^u[T&255]^_[N+2],a=l[C>>>24]^n[g>>16&255]^t[T>>8&255]^u[R&255]^_[N+3],g=s,T=c,R=d,C=a,N=N+4;s=y[g>>>24]<<24^y[T>>16&255]<<16^y[R>>8&255]<<8^y[C&255]^_[N],c=y[T>>>24]<<24^y[R>>16&255]<<16^y[C>>8&255]<<8^y[g&255]^_[N+1],d=y[R>>>24]<<24^y[C>>16&255]<<16^y[g>>8&255]<<8^y[T&255]^_[N+2],a=y[C>>>24]<<24^y[g>>16&255]<<16^y[T>>8&255]<<8^y[R&255]^_[N+3],v[S]=K(s^i),v[S+1]=K(a^e),v[S+2]=K(d^r),v[S+3]=K(c^f),i=O,e=F,r=U,f=k,S=S+4}return v.buffer},I}()},"./src/crypt/decrypter.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>S});var b=L("./src/crypt/aes-crypto.ts"),D=L("./src/crypt/fast-aes-key.ts"),P=L("./src/crypt/aes-decryptor.ts"),I=L("./src/utils/logger.ts"),M=L("./src/utils/mp4-tools.ts"),A=L("./src/utils/typed-array.ts"),x=16,S=function(){function m(_,y,p){var l=p===void 0?{}:p,n=l.removePKCS7Padding,t=n===void 0?!0:n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=_,this.config=y,this.removePKCS7Padding=t,t)try{var u=self.crypto;u&&(this.subtle=u.subtle||u.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var E=m.prototype;return E.destroy=function(){this.observer=null},E.isSync=function(){return this.config.enableSoftwareAES},E.flush=function(){var y=this.currentResult;if(!y){this.reset();return}var p=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?(0,P.removePadding)(p):p},E.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},E.decrypt=function(y,p,l,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(y),p,l);var t=this.flush();t&&n(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(y),p,l).then(n)},E.softwareDecrypt=function(y,p,l){var n=this.currentIV,t=this.currentResult,u=this.remainderData;this.logOnce("JS AES decrypt"),u&&(y=(0,M.appendUint8Array)(u,y),this.remainderData=null);var h=this.getValidChunk(y);if(!h.length)return null;n&&(l=n);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new P.default),i.expandKey(p);var e=t;return this.currentResult=i.decrypt(h.buffer,0,l),this.currentIV=(0,A.sliceUint8)(h,-16).buffer,e||null},E.webCryptoDecrypt=function(y,p,l){var n=this,t=this.subtle;return(this.key!==p||!this.fastAesKey)&&(this.key=p,this.fastAesKey=new D.default(t,p)),this.fastAesKey.expandKey().then(function(u){if(!t)return Promise.reject(new Error("web crypto not initialized"));var h=new b.default(t,l);return h.decrypt(y.buffer,u)}).catch(function(u){return n.onWebCryptoError(u,y,p,l)})},E.onWebCryptoError=function(y,p,l,n){return I.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",y),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,l,n)},E.getValidChunk=function(y){var p=y,l=y.length-y.length%x;return l!==y.length&&(p=(0,A.sliceUint8)(y,0,l),this.remainderData=(0,A.sliceUint8)(y,l)),p},E.logOnce=function(y){this.logEnabled&&(I.logger.log("[decrypter.ts]: "+y),this.logEnabled=!1)},m}()},"./src/crypt/fast-aes-key.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});var b=function(){function D(I,M){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=M}var P=D.prototype;return P.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},D}()},"./src/demux/aacdemuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>S});var b=L("./src/demux/base-audio-demuxer.ts"),D=L("./src/demux/adts.ts"),P=L("./src/utils/logger.ts"),I=L("./src/demux/id3.ts");function M(m,E){m.prototype=Object.create(E.prototype),m.prototype.constructor=m,A(m,E)}function A(m,E){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,p){return y.__proto__=p,y},A(m,E)}var x=function(m){M(E,m);function E(y,p){var l;return l=m.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=y,l.config=p,l}var _=E.prototype;return _.resetInitSegment=function(p,l,n,t){m.prototype.resetInitSegment.call(this,p,l,n,t),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:t,inputTimeScale:9e4,dropped:0}},E.probe=function(p){if(!p)return!1;for(var l=I.getID3Data(p,0)||[],n=l.length,t=p.length;n<t;n++)if(D.probe(p,n))return P.logger.log("ADTS sync word found !"),!0;return!1},_.canParse=function(p,l){return D.canParse(p,l)},_.appendFrame=function(p,l,n){D.initTrackConfig(p,this.observer,l,n,p.manifestCodec);var t=D.appendFrame(p,l,n,this.basePTS,this.frameIndex);if(t&&t.missing===0)return t},E}(b.default);const S=x},"./src/demux/adts.ts":(W,B,L)=>{L.r(B),L.d(B,{appendFrame:()=>n,canGetFrameLength:()=>S,canParse:()=>E,getAudioConfig:()=>I,getFrameDuration:()=>p,getFullFrameLength:()=>x,getHeaderLength:()=>A,initTrackConfig:()=>y,isHeader:()=>m,isHeaderPattern:()=>M,parseFrameHeader:()=>l,probe:()=>_});var b=L("./src/utils/logger.ts"),D=L("./src/errors.ts"),P=L("./src/events.ts");function I(t,u,h,i){var e,r,f,o,v=navigator.userAgent.toLowerCase(),s=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];e=((u[h+2]&192)>>>6)+1;var d=(u[h+2]&60)>>>2;if(d>c.length-1){t.trigger(P.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d});return}return f=(u[h+2]&1)<<2,f|=(u[h+3]&192)>>>6,b.logger.log("manifest codec:"+i+", ADTS type:"+e+", samplingIndex:"+d),/firefox/i.test(v)?d>=6?(e=5,o=new Array(4),r=d-3):(e=2,o=new Array(2),r=d):v.indexOf("android")!==-1?(e=2,o=new Array(2),r=d):(e=5,o=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&d>=6?r=d-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(d>=6&&f===1||/vivaldi/i.test(v))||!i&&f===1)&&(e=2,o=new Array(2)),r=d)),o[0]=e<<3,o[0]|=(d&14)>>1,o[1]|=(d&1)<<7,o[1]|=f<<3,e===5&&(o[1]|=(r&14)>>1,o[2]=(r&1)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:f,codec:"mp4a.40."+e,manifestCodec:s}}function M(t,u){return t[u]===255&&(t[u+1]&246)===240}function A(t,u){return t[u+1]&1?7:9}function x(t,u){return(t[u+3]&3)<<11|t[u+4]<<3|(t[u+5]&224)>>>5}function S(t,u){return u+5<t.length}function m(t,u){return u+1<t.length&&M(t,u)}function E(t,u){return S(t,u)&&M(t,u)&&x(t,u)<=t.length-u}function _(t,u){if(m(t,u)){var h=A(t,u);if(u+h>=t.length)return!1;var i=x(t,u);if(i<=h)return!1;var e=u+i;return e===t.length||m(t,e)}return!1}function y(t,u,h,i,e){if(!t.samplerate){var r=I(u,h,i,e);if(!r)return;t.config=r.config,t.samplerate=r.samplerate,t.channelCount=r.channelCount,t.codec=r.codec,t.manifestCodec=r.manifestCodec,b.logger.log("parsed codec:"+t.codec+", rate:"+r.samplerate+", channels:"+r.channelCount)}}function p(t){return 9216e4/t}function l(t,u){var h=A(t,u);if(u+h<=t.length){var i=x(t,u)-h;if(i>0)return{headerLength:h,frameLength:i}}}function n(t,u,h,i,e){var r=p(t.samplerate),f=i+e*r,o=l(u,h),v;if(o){var s=o.frameLength,c=o.headerLength,d=c+s,a=Math.max(0,h+d-u.length);a?(v=new Uint8Array(d-c),v.set(u.subarray(h+c,u.length),0)):v=u.subarray(h+c,h+d);var g={unit:v,pts:f};return a||t.samples.push(g),{sample:g,length:d,missing:a}}var T=u.length-h;v=new Uint8Array(T),v.set(u.subarray(h,u.length),0);var R={unit:v,pts:f};return{sample:R,length:T,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>m,initPTSFn:()=>S});var b=L("./src/polyfills/number.ts"),D=L("./src/demux/id3.ts"),P=L("./src/types/demuxer.ts"),I=L("./src/demux/dummy-demuxed-track.ts"),M=L("./src/utils/mp4-tools.ts"),A=L("./src/utils/typed-array.ts"),x=function(){function E(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var _=E.prototype;return _.resetInitSegment=function(p,l,n,t){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},_.resetTimeStamp=function(p){this.initPTS=p,this.resetContiguity()},_.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},_.canParse=function(p,l){return!1},_.appendFrame=function(p,l,n){},_.demux=function(p,l){this.cachedData&&(p=(0,M.appendUint8Array)(this.cachedData,p),this.cachedData=null);var n=D.getID3Data(p,0),t=n?n.length:0,u,h=this._audioTrack,i=this._id3Track,e=n?D.getTimeStamp(n):void 0,r=p.length;for((this.basePTS===null||this.frameIndex===0&&(0,b.isFiniteNumber)(e))&&(this.basePTS=S(e,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:P.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});t<r;){if(this.canParse(p,t)){var f=this.appendFrame(h,p,t);f?(this.frameIndex++,this.lastPTS=f.sample.pts,t+=f.length,u=t):t=r}else D.canParse(p,t)?(n=D.getID3Data(p,t),i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:P.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),t+=n.length,u=t):t++;if(t===r&&u!==r){var o=(0,A.sliceUint8)(p,u);this.cachedData?this.cachedData=(0,M.appendUint8Array)(this.cachedData,o):this.cachedData=o}}return{audioTrack:h,videoTrack:(0,I.dummyTrack)(),id3Track:i,textTrack:(0,I.dummyTrack)()}},_.demuxSampleAes=function(p,l,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},_.flush=function(p){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,I.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,I.dummyTrack)()}},_.destroy=function(){},E}(),S=function(_,y,p){return(0,b.isFiniteNumber)(_)?_*90:y*9e4+(p||0)};const m=x},"./src/demux/chunk-cache.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});var b=function(){function P(){this.chunks=[],this.dataLength=0}var I=P.prototype;return I.push=function(A){this.chunks.push(A),this.dataLength+=A.length},I.flush=function(){var A=this.chunks,x=this.dataLength,S;if(A.length)A.length===1?S=A[0]:S=D(A,x);else return new Uint8Array(0);return this.reset(),S},I.reset=function(){this.chunks.length=0,this.dataLength=0},P}();function D(P,I){for(var M=new Uint8Array(I),A=0,x=0;x<P.length;x++){var S=P[x];M.set(S,A),A+=S.length}return M}},"./src/demux/dummy-demuxed-track.ts":(W,B,L)=>{L.r(B),L.d(B,{dummyTrack:()=>b});function b(D,P){return D===void 0&&(D=""),P===void 0&&(P=9e4),{type:D,id:-1,pid:-1,inputTimeScale:P,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>P});var b=L("./src/utils/logger.ts"),D=function(){function I(A){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=A,this.bytesAvailable=A.byteLength,this.word=0,this.bitsAvailable=0}var M=I.prototype;return M.loadWord=function(){var x=this.data,S=this.bytesAvailable,m=x.byteLength-S,E=new Uint8Array(4),_=Math.min(4,S);if(_===0)throw new Error("no bytes available");E.set(x.subarray(m,m+_)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=_*8,this.bytesAvailable-=_},M.skipBits=function(x){var S;this.bitsAvailable>x?(this.word<<=x,this.bitsAvailable-=x):(x-=this.bitsAvailable,S=x>>3,x-=S>>3,this.bytesAvailable-=S,this.loadWord(),this.word<<=x,this.bitsAvailable-=x)},M.readBits=function(x){var S=Math.min(this.bitsAvailable,x),m=this.word>>>32-S;return x>32&&b.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=S,this.bitsAvailable>0?this.word<<=S:this.bytesAvailable>0&&this.loadWord(),S=x-S,S>0&&this.bitsAvailable?m<<S|this.readBits(S):m},M.skipLZ=function(){var x;for(x=0;x<this.bitsAvailable;++x)if(this.word&2147483648>>>x)return this.word<<=x,this.bitsAvailable-=x,x;return this.loadWord(),x+this.skipLZ()},M.skipUEG=function(){this.skipBits(1+this.skipLZ())},M.skipEG=function(){this.skipBits(1+this.skipLZ())},M.readUEG=function(){var x=this.skipLZ();return this.readBits(x+1)-1},M.readEG=function(){var x=this.readUEG();return 1&x?1+x>>>1:-1*(x>>>1)},M.readBoolean=function(){return this.readBits(1)===1},M.readUByte=function(){return this.readBits(8)},M.readUShort=function(){return this.readBits(16)},M.readUInt=function(){return this.readBits(32)},M.skipScalingList=function(x){for(var S=8,m=8,E,_=0;_<x;_++)m!==0&&(E=this.readEG(),m=(S+E+256)%256),S=m===0?S:m},M.readSPS=function(){var x=0,S=0,m=0,E=0,_,y,p,l=this.readUByte.bind(this),n=this.readBits.bind(this),t=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),i=this.skipEG.bind(this),e=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);l();var f=l();if(n(5),h(3),l(),e(),f===100||f===110||f===122||f===244||f===44||f===83||f===86||f===118||f===128){var o=t();if(o===3&&h(1),e(),e(),h(1),u())for(y=o!==3?8:12,p=0;p<y;p++)u()&&(p<6?r(16):r(64))}e();var v=t();if(v===0)t();else if(v===1)for(h(1),i(),i(),_=t(),p=0;p<_;p++)i();e(),h(1);var s=t(),c=t(),d=n(1);d===0&&h(1),h(1),u()&&(x=t(),S=t(),m=t(),E=t());var a=[1,1];if(u()&&u()){var g=l();switch(g){case 1:a=[1,1];break;case 2:a=[12,11];break;case 3:a=[10,11];break;case 4:a=[16,11];break;case 5:a=[40,33];break;case 6:a=[24,11];break;case 7:a=[20,11];break;case 8:a=[32,11];break;case 9:a=[80,33];break;case 10:a=[18,11];break;case 11:a=[15,11];break;case 12:a=[64,33];break;case 13:a=[160,99];break;case 14:a=[4,3];break;case 15:a=[3,2];break;case 16:a=[2,1];break;case 255:{a=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((s+1)*16-x*2-S*2),height:(2-d)*(c+1)*16-(d?2:4)*(m+E),pixelRatio:a}},M.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},I}();const P=D},"./src/demux/id3.ts":(W,B,L)=>{L.r(B),L.d(B,{canParse:()=>M,decodeFrame:()=>E,getID3Data:()=>P,getID3Frames:()=>m,getTimeStamp:()=>A,isFooter:()=>D,isHeader:()=>b,isTimeStampFrame:()=>x,testables:()=>t,utf8ArrayToStr:()=>n});var b=function(e,r){return r+10<=e.length&&e[r]===73&&e[r+1]===68&&e[r+2]===51&&e[r+3]<255&&e[r+4]<255&&e[r+6]<128&&e[r+7]<128&&e[r+8]<128&&e[r+9]<128},D=function(e,r){return r+10<=e.length&&e[r]===51&&e[r+1]===68&&e[r+2]===73&&e[r+3]<255&&e[r+4]<255&&e[r+6]<128&&e[r+7]<128&&e[r+8]<128&&e[r+9]<128},P=function(e,r){for(var f=r,o=0;b(e,r);){o+=10;var v=I(e,r+6);o+=v,D(e,r+10)&&(o+=10),r+=o}if(o>0)return e.subarray(f,f+o)},I=function(e,r){var f=0;return f=(e[r]&127)<<21,f|=(e[r+1]&127)<<14,f|=(e[r+2]&127)<<7,f|=e[r+3]&127,f},M=function(e,r){return b(e,r)&&I(e,r+6)+10<=e.length-r},A=function(e){for(var r=m(e),f=0;f<r.length;f++){var o=r[f];if(x(o))return l(o)}},x=function(e){return e&&e.key==="PRIV"&&e.info==="com.apple.streaming.transportStreamTimestamp"},S=function(e){var r=String.fromCharCode(e[0],e[1],e[2],e[3]),f=I(e,4),o=10;return{type:r,size:f,data:e.subarray(o,o+f)}},m=function(e){for(var r=0,f=[];b(e,r);){var o=I(e,r+6);r+=10;for(var v=r+o;r+8<v;){var s=S(e.subarray(r)),c=E(s);c&&f.push(c),r+=s.size+10}D(e,r)&&(r+=10)}return f},E=function(e){return e.type==="PRIV"?_(e):e.type[0]==="W"?p(e):y(e)},_=function(e){if(!(e.size<2)){var r=n(e.data,!0),f=new Uint8Array(e.data.subarray(r.length+1));return{key:e.type,info:r,data:f.buffer}}},y=function(e){if(!(e.size<2)){if(e.type==="TXXX"){var r=1,f=n(e.data.subarray(r),!0);r+=f.length+1;var o=n(e.data.subarray(r));return{key:e.type,info:f,data:o}}var v=n(e.data.subarray(1));return{key:e.type,data:v}}},p=function(e){if(e.type==="WXXX"){if(e.size<2)return;var r=1,f=n(e.data.subarray(r),!0);r+=f.length+1;var o=n(e.data.subarray(r));return{key:e.type,info:f,data:o}}var v=n(e.data);return{key:e.type,data:v}},l=function(e){if(e.data.byteLength===8){var r=new Uint8Array(e.data),f=r[3]&1,o=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return o/=45,f&&(o+=4772185884e-2),Math.round(o)}},n=function(e,r){r===void 0&&(r=!1);var f=h();if(f){var o=f.decode(e);if(r){var v=o.indexOf("\0");return v!==-1?o.substring(0,v):o}return o.replace(/\0/g,"")}for(var s=e.length,c,d,a,g="",T=0;T<s;){if(c=e[T++],c===0&&r)return g;if(c===0||c===3)continue;switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(c);break;case 12:case 13:d=e[T++],g+=String.fromCharCode((c&31)<<6|d&63);break;case 14:d=e[T++],a=e[T++],g+=String.fromCharCode((c&15)<<12|(d&63)<<6|(a&63)<<0);break}}return g},t={decodeTextFrame:y},u;function h(){return!u&&typeof self.TextDecoder<"u"&&(u=new self.TextDecoder("utf-8")),u}},"./src/demux/mp3demuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>S});var b=L("./src/demux/base-audio-demuxer.ts"),D=L("./src/demux/id3.ts"),P=L("./src/utils/logger.ts"),I=L("./src/demux/mpegaudio.ts");function M(m,E){m.prototype=Object.create(E.prototype),m.prototype.constructor=m,A(m,E)}function A(m,E){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,p){return y.__proto__=p,y},A(m,E)}var x=function(m){M(E,m);function E(){return m.apply(this,arguments)||this}var _=E.prototype;return _.resetInitSegment=function(p,l,n,t){m.prototype.resetInitSegment.call(this,p,l,n,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:t,inputTimeScale:9e4,dropped:0}},E.probe=function(p){if(!p)return!1;for(var l=D.getID3Data(p,0)||[],n=l.length,t=p.length;n<t;n++)if(I.probe(p,n))return P.logger.log("MPEG Audio sync word found !"),!0;return!1},_.canParse=function(p,l){return I.canParse(p,l)},_.appendFrame=function(p,l,n){if(this.basePTS!==null)return I.appendFrame(p,l,n,this.basePTS,this.frameIndex)},E}(b.default);const S=x},"./src/demux/mp4demuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>x});var b=L("./src/polyfills/number.ts"),D=L("./src/types/demuxer.ts"),P=L("./src/utils/mp4-tools.ts"),I=L("./src/demux/dummy-demuxed-track.ts"),M=/\/emsg[-/]ID3/i,A=function(){function S(E,_){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=_}var m=S.prototype;return m.resetTimeStamp=function(){},m.resetInitSegment=function(_,y,p,l){var n=(0,P.parseInitSegment)(_),t=this.videoTrack=(0,I.dummyTrack)("video",1),u=this.audioTrack=(0,I.dummyTrack)("audio",1),h=this.txtTrack=(0,I.dummyTrack)("text",1);if(this.id3Track=(0,I.dummyTrack)("id3",1),this.timeOffset=0,n.video){var i=n.video,e=i.id,r=i.timescale,f=i.codec;t.id=e,t.timescale=h.timescale=r,t.codec=f}if(n.audio){var o=n.audio,v=o.id,s=o.timescale,c=o.codec;u.id=v,u.timescale=s,u.codec=c}h.id=P.RemuxerTrackIdConfig.text,t.sampleDuration=0,t.duration=u.duration=l},m.resetContiguity=function(){},S.probe=function(_){return _=_.length>16384?_.subarray(0,16384):_,(0,P.findBox)(_,["moof"]).length>0},m.demux=function(_,y){this.timeOffset=y;var p=_,l=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(p=(0,P.appendUint8Array)(this.remainderData,_));var t=(0,P.segmentValidRange)(p);this.remainderData=t.remainder,l.samples=t.valid||new Uint8Array}else l.samples=p;var u=this.extractID3Track(l,y);return n.samples=(0,P.parseSamples)(y,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},m.flush=function(){var _=this.timeOffset,y=this.videoTrack,p=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(y,this.timeOffset);return p.samples=(0,P.parseSamples)(_,y),{videoTrack:y,audioTrack:(0,I.dummyTrack)(),id3Track:l,textTrack:(0,I.dummyTrack)()}},m.extractID3Track=function(_,y){var p=this.id3Track;if(_.samples.length){var l=(0,P.findBox)(_.samples,["emsg"]);l&&l.forEach(function(n){var t=(0,P.parseEmsg)(n);if(M.test(t.schemeIdUri)){var u=(0,b.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:y+t.presentationTimeDelta/t.timeScale,h=t.eventDuration===4294967295?Number.POSITIVE_INFINITY:t.eventDuration/t.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);var i=t.payload;p.samples.push({data:i,len:i.byteLength,dts:u,pts:u,type:D.MetadataSchema.emsg,duration:h})}})}return p},m.demuxSampleAes=function(_,y,p){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},m.destroy=function(){},S}();const x=A},"./src/demux/mpegaudio.ts":(W,B,L)=>{L.r(B),L.d(B,{appendFrame:()=>A,canParse:()=>E,isHeader:()=>m,isHeaderPattern:()=>S,parseHeader:()=>x,probe:()=>_});var b=null,D=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],P=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],M=[0,1,1,4];function A(y,p,l,n,t){if(!(l+24>p.length)){var u=x(p,l);if(u&&l+u.frameLength<=p.length){var h=u.samplesPerFrame*9e4/u.sampleRate,i=n+t*h,e={unit:p.subarray(l,l+u.frameLength),pts:i,dts:i};return y.config=[],y.channelCount=u.channelCount,y.samplerate=u.sampleRate,y.samples.push(e),{sample:e,length:u.frameLength,missing:0}}}}function x(y,p){var l=y[p+1]>>3&3,n=y[p+1]>>1&3,t=y[p+2]>>4&15,u=y[p+2]>>2&3;if(l!==1&&t!==0&&t!==15&&u!==3){var h=y[p+2]>>1&1,i=y[p+3]>>6,e=l===3?3-n:n===3?3:4,r=D[e*14+t-1]*1e3,f=l===3?0:l===2?1:2,o=P[f*3+u],v=i===3?1:2,s=I[l][n],c=M[n],d=s*8*c,a=Math.floor(s*r/o+h)*c;if(b===null){var g=navigator.userAgent||"",T=g.match(/Chrome\/(\d+)/i);b=T?parseInt(T[1]):0}var R=!!b&&b<=87;return R&&n===2&&r>=224e3&&i===0&&(y[p+3]=y[p+3]|128),{sampleRate:o,channelCount:v,frameLength:a,samplesPerFrame:d}}}function S(y,p){return y[p]===255&&(y[p+1]&224)===224&&(y[p+1]&6)!==0}function m(y,p){return p+1<y.length&&S(y,p)}function E(y,p){var l=4;return S(y,p)&&l<=y.length-p}function _(y,p){if(p+1<y.length&&S(y,p)){var l=4,n=x(y,p),t=l;n!=null&&n.frameLength&&(t=n.frameLength);var u=p+t;return u===y.length||m(y,u)}return!1}},"./src/demux/sample-aes.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>I});var b=L("./src/crypt/decrypter.ts"),D=L("./src/utils/mp4-tools.ts"),P=function(){function M(x,S,m){this.keyData=void 0,this.decrypter=void 0,this.keyData=m,this.decrypter=new b.default(x,S,{removePKCS7Padding:!1})}var A=M.prototype;return A.decryptBuffer=function(S,m){this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer,m)},A.decryptAacSample=function(S,m,E,_){var y=S[m].unit;if(!(y.length<=16)){var p=y.subarray(16,y.length-y.length%16),l=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),n=this;this.decryptBuffer(l,function(t){var u=new Uint8Array(t);y.set(u,16),_||n.decryptAacSamples(S,m+1,E)})}},A.decryptAacSamples=function(S,m,E){for(;;m++){if(m>=S.length){E();return}if(!(S[m].unit.length<32)){var _=this.decrypter.isSync();if(this.decryptAacSample(S,m,E,_),!_)return}}},A.getAvcEncryptedData=function(S){for(var m=Math.floor((S.length-48)/160)*16+16,E=new Int8Array(m),_=0,y=32;y<S.length-16;y+=160,_+=16)E.set(S.subarray(y,y+16),_);return E},A.getAvcDecryptedUnit=function(S,m){for(var E=new Uint8Array(m),_=0,y=32;y<S.length-16;y+=160,_+=16)S.set(E.subarray(_,_+16),y);return S},A.decryptAvcSample=function(S,m,E,_,y,p){var l=(0,D.discardEPB)(y.data),n=this.getAvcEncryptedData(l),t=this;this.decryptBuffer(n.buffer,function(u){y.data=t.getAvcDecryptedUnit(l,u),p||t.decryptAvcSamples(S,m,E+1,_)})},A.decryptAvcSamples=function(S,m,E,_){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;m++,E=0){if(m>=S.length){_();return}for(var y=S[m].units;!(E>=y.length);E++){var p=y[E];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var l=this.decrypter.isSync();if(this.decryptAvcSample(S,m,E,_,p,l),!l)return}}}},M}();const I=P},"./src/demux/transmuxer-interface.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>m});var b=L("./src/demux/webworkify-webpack.js"),D=L("./src/events.ts"),P=L("./src/demux/transmuxer.ts"),I=L("./src/utils/logger.ts"),M=L("./src/errors.ts"),A=L("./src/utils/mediasource-helper.ts"),x=L("./node_modules/eventemitter3/index.js"),S=(0,A.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function E(y,p,l,n){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var u=y.config;this.hls=y,this.id=p,this.useWorker=!!u.enableWorker,this.onTransmuxComplete=l,this.onFlush=n;var h=function(o,v){v=v||{},v.frag=t.frag,v.id=t.id,t.hls.trigger(o,v)};this.observer=new x.EventEmitter,this.observer.on(D.Events.FRAG_DECRYPTED,h),this.observer.on(D.Events.ERROR,h);var i={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){I.logger.log("demuxing in webworker");var r;try{r=this.worker=(0,b.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=function(f){t.useWorker=!1,I.logger.warn("Exception in webworker, fallback to inline"),t.hls.trigger(D.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},r.postMessage({cmd:"init",typeSupported:i,vendor:e,id:p,config:JSON.stringify(u)})}catch(f){I.logger.warn("Error in worker:",f),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),r&&self.URL.revokeObjectURL(r.objectURL),this.transmuxer=new P.default(this.observer,i,u,e,p),this.worker=null}}else this.transmuxer=new P.default(this.observer,i,u,e,p)}var _=E.prototype;return _.destroy=function(){var p=this.worker;if(p)p.removeEventListener("message",this.onwmsg),p.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},_.push=function(p,l,n,t,u,h,i,e,r,f){var o,v,s=this;r.transmuxing.start=self.performance.now();var c=this.transmuxer,d=this.worker,a=h?h.start:u.start,g=u.decryptdata,T=this.frag,R=!(T&&u.cc===T.cc),C=!(T&&r.level===T.level),O=T?r.sn-T.sn:-1,F=this.part?r.part-this.part.index:-1,U=O===0&&r.id>1&&r.id===(T==null?void 0:T.stats.chunkCount),k=!C&&(O===1||O===0&&(F===1||U&&F<=0)),N=self.performance.now();(C||O||u.stats.parsing.start===0)&&(u.stats.parsing.start=N),h&&(F||!k)&&(h.stats.parsing.start=N);var w=!(T&&((o=u.initSegment)===null||o===void 0?void 0:o.url)===((v=T.initSegment)===null||v===void 0?void 0:v.url)),K=new P.TransmuxState(R,k,e,C,a,w);if(!k||R||w){I.logger.log("[transmuxer-interface, "+u.type+"]: Starting new transmux session for sn: "+r.sn+" p: "+r.part+" level: "+r.level+" id: "+r.id+`
        discontinuity: `+R+`
        trackSwitch: `+C+`
        contiguous: `+k+`
        accurateTimeOffset: `+e+`
        timeOffset: `+a+`
        initSegmentChange: `+w);var G=new P.TransmuxConfig(n,t,l,i,f);this.configureTransmuxer(G)}if(this.frag=u,this.part=h,d)d.postMessage({cmd:"demux",data:p,decryptdata:g,chunkMeta:r,state:K},p instanceof ArrayBuffer?[p]:[]);else if(c){var H=c.push(p,g,r,K);(0,P.isPromise)(H)?H.then(function(V){s.handleTransmuxComplete(V)}):this.handleTransmuxComplete(H)}},_.flush=function(p){var l=this;p.transmuxing.start=self.performance.now();var n=this.transmuxer,t=this.worker;if(t)t.postMessage({cmd:"flush",chunkMeta:p});else if(n){var u=n.flush(p);(0,P.isPromise)(u)?u.then(function(h){l.handleFlushResult(h,p)}):this.handleFlushResult(u,p)}},_.handleFlushResult=function(p,l){var n=this;p.forEach(function(t){n.handleTransmuxComplete(t)}),this.onFlush(l)},_.onWorkerMessage=function(p){var l=p.data,n=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":I.logger[l.data.logType]&&I.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,n.trigger(l.event,l.data);break}}},_.configureTransmuxer=function(p){var l=this.worker,n=this.transmuxer;l?l.postMessage({cmd:"configure",config:p}):n&&n.configure(p)},_.handleTransmuxComplete=function(p){p.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(p)},E}()},"./src/demux/transmuxer-worker.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>M});var b=L("./src/demux/transmuxer.ts"),D=L("./src/events.ts"),P=L("./src/utils/logger.ts"),I=L("./node_modules/eventemitter3/index.js");function M(E){var _=new I.EventEmitter,y=function(n,t){E.postMessage({event:n,data:t})};_.on(D.Events.FRAG_DECRYPTED,y),_.on(D.Events.ERROR,y);var p=function(){var n=function(h){var i=function(r){y("workerLog",{logType:h,message:r})};P.logger[h]=i};for(var t in P.logger)n(t)};E.addEventListener("message",function(l){var n=l.data;switch(n.cmd){case"init":{var t=JSON.parse(n.config);E.transmuxer=new b.default(_,n.typeSupported,t,n.vendor,n.id),(0,P.enableLogs)(t.debug,n.id),p(),y("init",null);break}case"configure":{E.transmuxer.configure(n.config);break}case"demux":{var u=E.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);(0,b.isPromise)(u)?u.then(function(e){A(E,e)}):A(E,u);break}case"flush":{var h=n.chunkMeta,i=E.transmuxer.flush(h);(0,b.isPromise)(i)?i.then(function(e){S(E,e,h)}):S(E,i,h);break}}})}function A(E,_){if(m(_.remuxResult))return!1;var y=[],p=_.remuxResult,l=p.audio,n=p.video;return l&&x(y,l),n&&x(y,n),E.postMessage({event:"transmuxComplete",data:_},y),!0}function x(E,_){_.data1&&E.push(_.data1.buffer),_.data2&&E.push(_.data2.buffer)}function S(E,_,y){var p=_.reduce(function(l,n){return A(E,n)||l},!1);p||E.postMessage({event:"transmuxComplete",data:_[0]}),E.postMessage({event:"flush",data:y})}function m(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{TransmuxConfig:()=>u,TransmuxState:()=>h,default:()=>p,isPromise:()=>t});var b=L("./src/events.ts"),D=L("./src/errors.ts"),P=L("./src/crypt/decrypter.ts"),I=L("./src/demux/aacdemuxer.ts"),M=L("./src/demux/mp4demuxer.ts"),A=L("./src/demux/tsdemuxer.ts"),x=L("./src/demux/mp3demuxer.ts"),S=L("./src/remux/mp4-remuxer.ts"),m=L("./src/remux/passthrough-remuxer.ts"),E=L("./src/utils/logger.ts"),_;try{_=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var y=[{demux:A.default,remux:S.default},{demux:M.default,remux:m.default},{demux:I.default,remux:S.default},{demux:x.default,remux:S.default}],p=function(){function i(r,f,o,v,s){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=r,this.typeSupported=f,this.config=o,this.vendor=v,this.id=s}var e=i.prototype;return e.configure=function(f){this.transmuxConfig=f,this.decrypter&&this.decrypter.reset()},e.push=function(f,o,v,s){var c=this,d=v.transmuxing;d.executeStart=_();var a=new Uint8Array(f),g=this.config,T=this.currentTransmuxState,R=this.transmuxConfig;s&&(this.currentTransmuxState=s);var C=s||T,O=C.contiguous,F=C.discontinuity,U=C.trackSwitch,k=C.accurateTimeOffset,N=C.timeOffset,w=C.initSegmentChange,K=R.audioCodec,G=R.videoCodec,H=R.defaultInitPts,V=R.duration,X=R.initSegmentData;(F||U||w)&&this.resetInitSegment(X,K,G,V),(F||w)&&this.resetInitialTimestamp(H),O||this.resetContiguity();var Y=l(a,o);if(Y&&Y.method==="AES-128"){var Q=this.getDecrypter();if(g.enableSoftwareAES){var $=Q.softwareDecrypt(a,Y.key.buffer,Y.iv.buffer);if(!$)return d.executeEnd=_(),n(v);a=new Uint8Array($)}else return this.decryptionPromise=Q.webCryptoDecrypt(a,Y.key.buffer,Y.iv.buffer).then(function(J){var Z=c.push(J,null,v);return c.decryptionPromise=null,Z}),this.decryptionPromise}this.needsProbing(a,F,U)&&this.configureTransmuxer(a,R);var j=this.transmux(a,Y,N,k,v),z=this.currentTransmuxState;return z.contiguous=!0,z.discontinuity=!1,z.trackSwitch=!1,d.executeEnd=_(),j},e.flush=function(f){var o=this,v=f.transmuxing;v.executeStart=_();var s=this.decrypter,c=this.currentTransmuxState,d=this.decryptionPromise;if(d)return d.then(function(){return o.flush(f)});var a=[],g=c.timeOffset;if(s){var T=s.flush();T&&a.push(this.push(T,null,f))}var R=this.demuxer,C=this.remuxer;if(!R||!C)return this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=_(),[n(f)];var O=R.flush(g);return t(O)?O.then(function(F){return o.flushRemux(a,F,f),a}):(this.flushRemux(a,O,f),a)},e.flushRemux=function(f,o,v){var s=o.audioTrack,c=o.videoTrack,d=o.id3Track,a=o.textTrack,g=this.currentTransmuxState,T=g.accurateTimeOffset,R=g.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var C=this.remuxer.remux(s,c,d,a,R,T,!0,this.id);f.push({remuxResult:C,chunkMeta:v}),v.transmuxing.executeEnd=_()},e.resetInitialTimestamp=function(f){var o=this.demuxer,v=this.remuxer;!o||!v||(o.resetTimeStamp(f),v.resetTimeStamp(f))},e.resetContiguity=function(){var f=this.demuxer,o=this.remuxer;!f||!o||(f.resetContiguity(),o.resetNextTimestamp())},e.resetInitSegment=function(f,o,v,s){var c=this.demuxer,d=this.remuxer;!c||!d||(c.resetInitSegment(f,o,v,s),d.resetInitSegment(f,o,v))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(f,o,v,s,c){var d;return o&&o.method==="SAMPLE-AES"?d=this.transmuxSampleAes(f,o,v,s,c):d=this.transmuxUnencrypted(f,v,s,c),d},e.transmuxUnencrypted=function(f,o,v,s){var c=this.demuxer.demux(f,o,!1,!this.config.progressive),d=c.audioTrack,a=c.videoTrack,g=c.id3Track,T=c.textTrack,R=this.remuxer.remux(d,a,g,T,o,v,!1,this.id);return{remuxResult:R,chunkMeta:s}},e.transmuxSampleAes=function(f,o,v,s,c){var d=this;return this.demuxer.demuxSampleAes(f,o,v).then(function(a){var g=d.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,v,s,!1,d.id);return{remuxResult:g,chunkMeta:c}})},e.configureTransmuxer=function(f,o){for(var v=this.config,s=this.observer,c=this.typeSupported,d=this.vendor,a=o.audioCodec,g=o.defaultInitPts,T=o.duration,R=o.initSegmentData,C=o.videoCodec,O,F=0,U=y.length;F<U;F++)if(y[F].demux.probe(f)){O=y[F];break}O||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),O={demux:M.default,remux:m.default});var k=this.demuxer,N=this.remuxer,w=O.remux,K=O.demux;(!N||!(N instanceof w))&&(this.remuxer=new w(s,v,c,d)),(!k||!(k instanceof K))&&(this.demuxer=new K(s,v,c),this.probe=K.probe),this.resetInitSegment(R,a,C,T),this.resetInitialTimestamp(g)},e.needsProbing=function(f,o,v){return!this.demuxer||!this.remuxer||o||v},e.getDecrypter=function(){var f=this.decrypter;return f||(f=this.decrypter=new P.default(this.observer,this.config)),f},i}();function l(i,e){var r=null;return i.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(r=e),r}var n=function(e){return{remuxResult:{},chunkMeta:e}};function t(i){return"then"in i&&i.then instanceof Function}var u=function(e,r,f,o,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=r,this.initSegmentData=f,this.duration=o,this.defaultInitPts=v},h=function(e,r,f,o,v,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=r,this.accurateTimeOffset=f,this.trackSwitch=o,this.timeOffset=v,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>h});var b=L("./src/demux/adts.ts"),D=L("./src/demux/mpegaudio.ts"),P=L("./src/demux/exp-golomb.ts"),I=L("./src/demux/sample-aes.ts"),M=L("./src/events.ts"),A=L("./src/utils/mp4-tools.ts"),x=L("./src/utils/logger.ts"),S=L("./src/errors.ts"),m=L("./src/types/demuxer.ts");function E(){return E=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(i[f]=r[f])}return i},E.apply(this,arguments)}var _=188,y=function(){function i(r,f,o){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=f,this.typeSupported=o}i.probe=function(f){var o=i.syncOffset(f);return o>0&&x.logger.warn("MPEG2-TS detected but first sync word found @ offset "+o),o!==-1},i.syncOffset=function(f){for(var o=Math.min(_*5,f.length-_*2)+1,v=0;v<o;){if(f[v]===71&&f[v+_]===71)return v;v++}return-1},i.createTrack=function(f,o){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:A.RemuxerTrackIdConfig[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:f==="audio"?o:void 0}};var e=i.prototype;return e.resetInitSegment=function(f,o,v,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video"),this._audioTrack=i.createTrack("audio",s),this._id3Track=i.createTrack("id3"),this._txtTrack=i.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=o,this.videoCodec=v,this._duration=s},e.resetTimeStamp=function(){},e.resetContiguity=function(){var f=this._audioTrack,o=this._avcTrack,v=this._id3Track;f&&(f.pesData=null),o&&(o.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},e.demux=function(f,o,v,s){v===void 0&&(v=!1),s===void 0&&(s=!1),v||(this.sampleAes=null);var c,d=this._avcTrack,a=this._audioTrack,g=this._id3Track,T=this._txtTrack,R=d.pid,C=d.pesData,O=a.pid,F=g.pid,U=a.pesData,k=g.pesData,N=null,w=this.pmtParsed,K=this._pmtId,G=f.length;if(this.remainderData&&(f=(0,A.appendUint8Array)(this.remainderData,f),G=f.length,this.remainderData=null),G<_&&!s)return this.remainderData=f,{audioTrack:a,videoTrack:d,id3Track:g,textTrack:T};var H=Math.max(0,i.syncOffset(f));G-=(G-H)%_,G<f.byteLength&&!s&&(this.remainderData=new Uint8Array(f.buffer,G,f.buffer.byteLength-G));for(var V=0,X=H;X<G;X+=_)if(f[X]===71){var Y=!!(f[X+1]&64),Q=((f[X+1]&31)<<8)+f[X+2],$=(f[X+3]&48)>>4,j=void 0;if($>1){if(j=X+5+f[X+4],j===X+_)continue}else j=X+4;switch(Q){case R:Y&&(C&&(c=t(C))&&this.parseAVCPES(d,T,c,!1),C={data:[],size:0}),C&&(C.data.push(f.subarray(j,X+_)),C.size+=X+_-j);break;case O:if(Y){if(U&&(c=t(U)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,c);break;case"mp3":this.parseMPEGPES(a,c);break}U={data:[],size:0}}U&&(U.data.push(f.subarray(j,X+_)),U.size+=X+_-j);break;case F:Y&&(k&&(c=t(k))&&this.parseID3PES(g,c),k={data:[],size:0}),k&&(k.data.push(f.subarray(j,X+_)),k.size+=X+_-j);break;case 0:Y&&(j+=f[j]+1),K=this._pmtId=l(f,j);break;case K:{Y&&(j+=f[j]+1);var z=n(f,j,this.typeSupported,v);R=z.avc,R>0&&(d.pid=R),O=z.audio,O>0&&(a.pid=O,a.segmentCodec=z.segmentCodec),F=z.id3,F>0&&(g.pid=F),N!==null&&!w&&(x.logger.log("unknown PID '"+N+"' in TS found"),N=null,X=H-188),w=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=Q;break}}else V++;V>0&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),d.pesData=C,a.pesData=U,g.pesData=k;var J={audioTrack:a,videoTrack:d,id3Track:g,textTrack:T};return s&&this.extractRemainingSamples(J),J},e.flush=function(){var f=this.remainderData;this.remainderData=null;var o;return f?o=this.demux(f,-1,!1,!0):o={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(o),this.sampleAes?this.decrypt(o,this.sampleAes):o},e.extractRemainingSamples=function(f){var o=f.audioTrack,v=f.videoTrack,s=f.id3Track,c=f.textTrack,d=v.pesData,a=o.pesData,g=s.pesData,T;if(d&&(T=t(d))?(this.parseAVCPES(v,c,T,!0),v.pesData=null):v.pesData=d,a&&(T=t(a))){switch(o.segmentCodec){case"aac":this.parseAACPES(o,T);break;case"mp3":this.parseMPEGPES(o,T);break}o.pesData=null}else a!=null&&a.size&&x.logger.log("last AAC PES packet truncated,might overlap between fragments"),o.pesData=a;g&&(T=t(g))?(this.parseID3PES(s,T),s.pesData=null):s.pesData=g},e.demuxSampleAes=function(f,o,v){var s=this.demux(f,v,!0,!this.config.progressive),c=this.sampleAes=new I.default(this.observer,this.config,o);return this.decrypt(s,c)},e.decrypt=function(f,o){return new Promise(function(v){var s=f.audioTrack,c=f.videoTrack;s.samples&&s.segmentCodec==="aac"?o.decryptAacSamples(s.samples,0,function(){c.samples?o.decryptAvcSamples(c.samples,0,0,function(){v(f)}):v(f)}):c.samples&&o.decryptAvcSamples(c.samples,0,0,function(){v(f)})})},e.destroy=function(){this._duration=0},e.parseAVCPES=function(f,o,v,s){var c=this,d=this.parseAVCNALu(f,v.data),a=this.avcSample,g,T=!1;v.data=null,a&&d.length&&!f.audFound&&(u(a,f),a=this.avcSample=p(!1,v.pts,v.dts,"")),d.forEach(function(R){switch(R.type){case 1:{g=!0,a||(a=c.avcSample=p(!0,v.pts,v.dts,"")),a.frame=!0;var C=R.data;if(T&&C.length>4){var O=new P.default(C).readSliceType();(O===2||O===4||O===7||O===9)&&(a.key=!0)}break}case 5:g=!0,a||(a=c.avcSample=p(!0,v.pts,v.dts,"")),a.key=!0,a.frame=!0;break;case 6:{g=!0,(0,A.parseSEIMessageFromNALu)(R.data,1,v.pts,o.samples);break}case 7:if(g=!0,T=!0,!f.sps){var F=new P.default(R.data),U=F.readSPS();f.width=U.width,f.height=U.height,f.pixelRatio=U.pixelRatio,f.sps=[R.data],f.duration=c._duration;for(var k=R.data.subarray(1,4),N="avc1.",w=0;w<3;w++){var K=k[w].toString(16);K.length<2&&(K="0"+K),N+=K}f.codec=N}break;case 8:g=!0,f.pps||(f.pps=[R.data]);break;case 9:g=!1,f.audFound=!0,a&&u(a,f),a=c.avcSample=p(!1,v.pts,v.dts,"");break;case 12:g=!0;break;default:g=!1,a&&(a.debug+="unknown NAL "+R.type+" ");break}if(a&&g){var G=a.units;G.push(R)}}),s&&a&&(u(a,f),this.avcSample=null)},e.getLastNalUnit=function(f){var o,v=this.avcSample,s;if((!v||v.units.length===0)&&(v=f[f.length-1]),(o=v)!==null&&o!==void 0&&o.units){var c=v.units;s=c[c.length-1]}return s},e.parseAVCNALu=function(f,o){var v=o.byteLength,s=f.naluState||0,c=s,d=[],a=0,g,T,R,C=-1,O=0;for(s===-1&&(C=0,O=o[0]&31,s=0,a=1);a<v;){if(g=o[a++],!s){s=g?0:1;continue}if(s===1){s=g?0:2;continue}if(!g)s=3;else if(g===1){if(C>=0){var F={data:o.subarray(C,a-s-1),type:O};d.push(F)}else{var U=this.getLastNalUnit(f.samples);if(U&&(c&&a<=4-c&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-c)),T=a-s-1,T>0)){var k=new Uint8Array(U.data.byteLength+T);k.set(U.data,0),k.set(o.subarray(0,T),U.data.byteLength),U.data=k,U.state=0}}a<v?(R=o[a]&31,C=a,O=R,s=0):s=-1}else s=0}if(C>=0&&s>=0){var N={data:o.subarray(C,v),type:O,state:s};d.push(N)}if(d.length===0){var w=this.getLastNalUnit(f.samples);if(w){var K=new Uint8Array(w.data.byteLength+o.byteLength);K.set(w.data,0),K.set(o,w.data.byteLength),w.data=K}}return f.naluState=s,d},e.parseAACPES=function(f,o){var v=0,s=this.aacOverFlow,c=o.data;if(s){this.aacOverFlow=null;var d=s.missing,a=s.sample.unit.byteLength;if(d===-1){var g=new Uint8Array(a+c.byteLength);g.set(s.sample.unit,0),g.set(c,a),c=g}else{var T=a-d;s.sample.unit.set(c.subarray(0,d),T),f.samples.push(s.sample),v=s.missing}}var R,C;for(R=v,C=c.length;R<C-1&&!b.isHeader(c,R);R++);if(R!==v){var O,F;if(R<C-1?(O="AAC PES did not start with ADTS header,offset:"+R,F=!1):(O="no ADTS header found in AAC PES",F=!0),x.logger.warn("parsing error:"+O),this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:O}),F)return}b.initTrackConfig(f,this.observer,c,R,this.audioCodec);var U;if(o.pts!==void 0)U=o.pts;else if(s){var k=b.getFrameDuration(f.samplerate);U=s.sample.pts+k}else{x.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,w;R<C;)if(w=b.appendFrame(f,c,R,U,N),R+=w.length,w.missing){this.aacOverFlow=w;break}else for(N++;R<C-1&&!b.isHeader(c,R);R++);},e.parseMPEGPES=function(f,o){var v=o.data,s=v.length,c=0,d=0,a=o.pts;if(a===void 0){x.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;d<s;)if(D.isHeader(v,d)){var g=D.appendFrame(f,v,d,a,c);if(g)d+=g.length,c++;else break}else d++},e.parseID3PES=function(f,o){if(o.pts===void 0){x.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var v=E({},o,{type:this._avcTrack?m.MetadataSchema.emsg:m.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});f.samples.push(v)},i}();function p(i,e,r,f){return{key:i,frame:!1,pts:e,dts:r,units:[],debug:f,length:0}}function l(i,e){return(i[e+10]&31)<<8|i[e+11]}function n(i,e,r,f){var o={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},v=(i[e+1]&15)<<8|i[e+2],s=e+3+v-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<s;){var d=(i[e+1]&31)<<8|i[e+2];switch(i[e]){case 207:if(!f){x.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:o.audio===-1&&(o.audio=d);break;case 21:o.id3===-1&&(o.id3=d);break;case 219:if(!f){x.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:o.avc===-1&&(o.avc=d);break;case 3:case 4:r.mpeg!==!0&&r.mp3!==!0?x.logger.log("MPEG audio found, not supported in this browser"):o.audio===-1&&(o.audio=d,o.segmentCodec="mp3");break;case 36:x.logger.warn("Unsupported HEVC stream type found");break}e+=((i[e+3]&15)<<8|i[e+4])+5}return o}function t(i){var e=0,r,f,o,v,s,c=i.data;if(!i||i.size===0)return null;for(;c[0].length<19&&c.length>1;){var d=new Uint8Array(c[0].length+c[1].length);d.set(c[0]),d.set(c[1],c[0].length),c[0]=d,c.splice(1,1)}r=c[0];var a=(r[0]<<16)+(r[1]<<8)+r[2];if(a===1){if(f=(r[4]<<8)+r[5],f&&f>i.size-6)return null;var g=r[7];g&192&&(v=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,g&64?(s=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,v-s>54e5&&(x.logger.warn(Math.round((v-s)/9e4)+"s delta between PTS and DTS, align them"),v=s)):s=v),o=r[8];var T=o+9;if(i.size<=T)return null;i.size-=T;for(var R=new Uint8Array(i.size),C=0,O=c.length;C<O;C++){r=c[C];var F=r.byteLength;if(T)if(T>F){T-=F;continue}else r=r.subarray(T),F-=T,T=0;R.set(r,e),e+=F}return f&&(f-=o+3),{data:R,pts:v,dts:s,len:f}}return null}function u(i,e){if(i.units.length&&i.frame){if(i.pts===void 0){var r=e.samples,f=r.length;if(f){var o=r[f-1];i.pts=o.pts,i.dts=o.dts}else{e.dropped++;return}}e.samples.push(i)}i.debug.length&&x.logger.log(i.pts+"/"+i.dts+":"+i.debug)}const h=y},"./src/demux/webworkify-webpack.js":(W,B,L)=>{L.r(B),L.d(B,{default:()=>_});var b=function(){var p=ENTRY_MODULE,l={},n=function u(h){var i=l[h];if(i!==void 0)return i.exports;var e=l[h]={exports:{}};return p[h].call(e.exports,e,e.exports,u),e.exports};n.m=p,function(){n.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return n.d(h,{a:h}),h}}(),function(){n.d=function(u,h){for(var i in h)n.o(h,i)&&!n.o(u,i)&&Object.defineProperty(u,i,{enumerable:!0,get:h[i]})}}(),function(){n.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)}}(),function(){n.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})}}();var t=n(ENTRY_MODULE);return t.default||t},D=b.toString().split("ENTRY_MODULE"),P="[\\.|\\-|\\+|\\w|/|@]+",I="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+P+").*?\\)";function M(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function A(y){return!isNaN(1*y)}function x(y,p,l){var n={};n[l]=[];var t=p.toString().replace(/^"[^"]+"/,"function"),u=t.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||t.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!u)return n;for(var h=u[1],i=new RegExp("(\\\\n|\\W)"+M(h)+I,"g"),e;e=i.exec(t);)e[3]!=="dll-reference"&&n[l].push(e[3]);for(i=new RegExp("\\("+M(h)+'\\("(dll-reference\\s('+P+'))"\\)\\)'+I,"g");e=i.exec(t);)y[e[2]]||(n[l].push(e[1]),y[e[2]]=L(e[1]).m),n[e[2]]=n[e[2]]||[],n[e[2]].push(e[4]);for(var r=Object.keys(n),f=0;f<r.length;f++)for(var o=0;o<n[r[f]].length;o++)A(n[r[f]][o])&&(n[r[f]][o]=1*n[r[f]][o]);return n}function S(y){var p=Object.keys(y);return p.reduce(function(l,n){return l||y[n].length>0},!1)}function m(y,p){for(var l={main:[p]},n={main:[]},t={main:{}};S(l);)for(var u=Object.keys(l),h=0;h<u.length;h++){var i=u[h],e=l[i],r=e.pop();if(t[i]=t[i]||{},!(t[i][r]||!y[i][r])){t[i][r]=!0,n[i]=n[i]||[],n[i].push(r);for(var f=x(y,y[i][r],i),o=Object.keys(f),v=0;v<o.length;v++)l[o[v]]=l[o[v]]||[],l[o[v]]=l[o[v]].concat(f[o[v]])}}return n}function E(y,p,l,n){var t=y[n].map(function(u){return'"'+u+'": '+p[n][u].toString().replace(/^"[^"]+"/,"function")}).join(",");return D[0]+"{"+t+"}"+D[1]+'"'+l+'"'+D[2]}function _(y,p){p=p||{};var l={main:L.m},n=p.all?{main:Object.keys(l.main)}:m(l,y),t="";Object.keys(n).filter(function(r){return r!=="main"}).forEach(function(r){for(var f=0;n[r][f];)f++;n[r].push(f),l[r][f]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",t=t+("var "+r+" = ("+E(n,l,f,modules)+`)();
`)}),t=t+("new (("+E(n,l,y,"main")+")())(self);");var u=new window.Blob([t],{type:"text/javascript"}),h=window.URL||window.webkitURL||window.mozURL||window.msURL,i=h.createObjectURL(u),e=new window.Worker(i);return e.objectURL=i,e}},"./src/errors.ts":(W,B,L)=>{L.r(B),L.d(B,{ErrorDetails:()=>D,ErrorTypes:()=>b});var b;(function(P){P.NETWORK_ERROR="networkError",P.MEDIA_ERROR="mediaError",P.KEY_SYSTEM_ERROR="keySystemError",P.MUX_ERROR="muxError",P.OTHER_ERROR="otherError"})(b||(b={}));var D;(function(P){P.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",P.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",P.KEY_SYSTEM_NO_SESSION="keySystemNoSession",P.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",P.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",P.MANIFEST_LOAD_ERROR="manifestLoadError",P.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",P.MANIFEST_PARSING_ERROR="manifestParsingError",P.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",P.LEVEL_EMPTY_ERROR="levelEmptyError",P.LEVEL_LOAD_ERROR="levelLoadError",P.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",P.LEVEL_SWITCH_ERROR="levelSwitchError",P.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",P.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",P.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",P.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",P.FRAG_LOAD_ERROR="fragLoadError",P.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",P.FRAG_DECRYPT_ERROR="fragDecryptError",P.FRAG_PARSING_ERROR="fragParsingError",P.REMUX_ALLOC_ERROR="remuxAllocError",P.KEY_LOAD_ERROR="keyLoadError",P.KEY_LOAD_TIMEOUT="keyLoadTimeOut",P.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",P.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",P.BUFFER_APPEND_ERROR="bufferAppendError",P.BUFFER_APPENDING_ERROR="bufferAppendingError",P.BUFFER_STALLED_ERROR="bufferStalledError",P.BUFFER_FULL_ERROR="bufferFullError",P.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",P.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",P.INTERNAL_EXCEPTION="internalException",P.INTERNAL_ABORTED="aborted",P.UNKNOWN="unknown"})(D||(D={}))},"./src/events.ts":(W,B,L)=>{L.r(B),L.d(B,{Events:()=>b});var b;(function(D){D.MEDIA_ATTACHING="hlsMediaAttaching",D.MEDIA_ATTACHED="hlsMediaAttached",D.MEDIA_DETACHING="hlsMediaDetaching",D.MEDIA_DETACHED="hlsMediaDetached",D.BUFFER_RESET="hlsBufferReset",D.BUFFER_CODECS="hlsBufferCodecs",D.BUFFER_CREATED="hlsBufferCreated",D.BUFFER_APPENDING="hlsBufferAppending",D.BUFFER_APPENDED="hlsBufferAppended",D.BUFFER_EOS="hlsBufferEos",D.BUFFER_FLUSHING="hlsBufferFlushing",D.BUFFER_FLUSHED="hlsBufferFlushed",D.MANIFEST_LOADING="hlsManifestLoading",D.MANIFEST_LOADED="hlsManifestLoaded",D.MANIFEST_PARSED="hlsManifestParsed",D.LEVEL_SWITCHING="hlsLevelSwitching",D.LEVEL_SWITCHED="hlsLevelSwitched",D.LEVEL_LOADING="hlsLevelLoading",D.LEVEL_LOADED="hlsLevelLoaded",D.LEVEL_UPDATED="hlsLevelUpdated",D.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",D.LEVELS_UPDATED="hlsLevelsUpdated",D.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",D.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",D.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",D.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",D.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",D.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",D.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",D.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",D.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",D.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",D.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",D.CUES_PARSED="hlsCuesParsed",D.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",D.INIT_PTS_FOUND="hlsInitPtsFound",D.FRAG_LOADING="hlsFragLoading",D.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",D.FRAG_LOADED="hlsFragLoaded",D.FRAG_DECRYPTED="hlsFragDecrypted",D.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",D.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",D.FRAG_PARSING_METADATA="hlsFragParsingMetadata",D.FRAG_PARSED="hlsFragParsed",D.FRAG_BUFFERED="hlsFragBuffered",D.FRAG_CHANGED="hlsFragChanged",D.FPS_DROP="hlsFpsDrop",D.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",D.ERROR="hlsError",D.DESTROYING="hlsDestroying",D.KEY_LOADING="hlsKeyLoading",D.KEY_LOADED="hlsKeyLoaded",D.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",D.BACK_BUFFER_REACHED="hlsBackBufferReached"})(b||(b={}))},"./src/hls.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>u});var b=L("./node_modules/url-toolkit/src/url-toolkit.js"),D=L("./src/loader/playlist-loader.ts"),P=L("./src/loader/key-loader.ts"),I=L("./src/controller/id3-track-controller.ts"),M=L("./src/controller/latency-controller.ts"),A=L("./src/controller/level-controller.ts"),x=L("./src/controller/fragment-tracker.ts"),S=L("./src/controller/stream-controller.ts"),m=L("./src/is-supported.ts"),E=L("./src/utils/logger.ts"),_=L("./src/config.ts"),y=L("./node_modules/eventemitter3/index.js"),p=L("./src/events.ts"),l=L("./src/errors.ts");function n(h,i){for(var e=0;e<i.length;e++){var r=i[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(h,r.key,r)}}function t(h,i,e){return i&&n(h.prototype,i),e&&n(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}var u=function(){h.isSupported=function(){return(0,m.isSupported)()};function h(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=(0,_.mergeConfig)(h.DefaultConfig,e);this.userConfig=e,(0,E.enableLogs)(r.debug,"Hls instance"),this._autoLevelCapping=-1,r.progressive&&(0,_.enableStreamingMode)(r);var f=r.abrController,o=r.bufferController,v=r.capLevelController,s=r.fpsController,c=this.abrController=new f(this),d=this.bufferController=new o(this),a=this.capLevelController=new v(this),g=new s(this),T=new D.default(this),R=new P.default(this),C=new I.default(this),O=this.levelController=new A.default(this),F=new x.FragmentTracker(this),U=this.streamController=new S.default(this,F);a.setStreamController(U),g.setStreamController(U);var k=[T,R,O,U];this.networkControllers=k;var N=[c,d,a,g,C,F];this.audioTrackController=this.createController(r.audioTrackController,null,k),this.createController(r.audioStreamController,F,k),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,k),this.createController(r.subtitleStreamController,F,k),this.createController(r.timelineController,null,N),this.emeController=this.createController(r.emeController,null,N),this.cmcdController=this.createController(r.cmcdController,null,N),this.latencyController=this.createController(M.default,null,N),this.coreComponents=N}var i=h.prototype;return i.createController=function(r,f,o){if(r){var v=f?new r(this,f):new r(this);return o&&o.push(v),v}return null},i.on=function(r,f,o){o===void 0&&(o=this),this._emitter.on(r,f,o)},i.once=function(r,f,o){o===void 0&&(o=this),this._emitter.once(r,f,o)},i.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},i.off=function(r,f,o,v){o===void 0&&(o=this),this._emitter.off(r,f,o,v)},i.listeners=function(r){return this._emitter.listeners(r)},i.emit=function(r,f,o){return this._emitter.emit(r,f,o)},i.trigger=function(r,f){if(this.config.debug)return this.emit(r,r,f);try{return this.emit(r,r,f)}catch(o){E.logger.error("An internal error happened while handling event "+r+'. Error message: "'+o.message+'". Here is a stacktrace:',o),this.trigger(p.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,error:o})}return!1},i.listenerCount=function(r){return this._emitter.listenerCount(r)},i.destroy=function(){E.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0},i.attachMedia=function(r){E.logger.log("attachMedia"),this._media=r,this.trigger(p.Events.MEDIA_ATTACHING,{media:r})},i.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(r){this.stopLoad();var f=this.media,o=this.url,v=this.url=b.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});E.logger.log("loadSource:"+v),f&&o&&o!==v&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(f)),this.trigger(p.Events.MANIFEST_LOADING,{url:r})},i.startLoad=function(r){r===void 0&&(r=-1),E.logger.log("startLoad("+r+")"),this.networkControllers.forEach(function(f){f.startLoad(r)})},i.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},i.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){E.logger.log("recoverMediaError");var r=this._media;this.detachMedia(),r&&this.attachMedia(r)},i.removeLevel=function(r,f){f===void 0&&(f=0),this.levelController.removeLevel(r,f)},t(h,[{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){E.logger.log("set currentLevel:"+r),this.loadLevel=r,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){E.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){E.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){E.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){E.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var f=!!r;f!==this.config.capLevelToPlayerSize&&(f?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=f)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(E.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r)}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,f=this.config.minAutoBitrate;if(!r)return 0;for(var o=r.length,v=0;v<o;v++)if(r[v].maxBitrate>=f)return v;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,f=this.autoLevelCapping,o;return f===-1&&r&&r.length?o=r.length-1:o=f,o}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var f=this.audioTrackController;f&&(f.audioTrack=r)}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var f=this.subtitleTrackController;f&&(f.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var f=this.subtitleTrackController;f&&(f.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.8"}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:_.hlsDefaultConfig},set:function(r){h.defaultConfig=r}}]),h}();u.defaultConfig=void 0},"./src/is-supported.ts":(W,B,L)=>{L.r(B),L.d(B,{changeTypeSupported:()=>I,isSupported:()=>P});var b=L("./src/utils/mediasource-helper.ts");function D(){return self.SourceBuffer||self.WebKitSourceBuffer}function P(){var M=(0,b.getMediaSource)();if(!M)return!1;var A=D(),x=M&&typeof M.isTypeSupported=="function"&&M.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!A||A.prototype&&typeof A.prototype.appendBuffer=="function"&&typeof A.prototype.remove=="function";return!!x&&!!S}function I(){var M,A=D();return typeof(A==null||(M=A.prototype)===null||M===void 0?void 0:M.changeType)=="function"}},"./src/loader/date-range.ts":(W,B,L)=>{L.r(B),L.d(B,{DateRange:()=>S,DateRangeAttribute:()=>x});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/attr-list.ts"),P=L("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(m){for(var E=1;E<arguments.length;E++){var _=arguments[E];for(var y in _)Object.prototype.hasOwnProperty.call(_,y)&&(m[y]=_[y])}return m},I.apply(this,arguments)}function M(m,E){for(var _=0;_<E.length;_++){var y=E[_];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}function A(m,E,_){return E&&M(m.prototype,E),_&&M(m,_),Object.defineProperty(m,"prototype",{writable:!1}),m}var x;(function(m){m.ID="ID",m.CLASS="CLASS",m.START_DATE="START-DATE",m.DURATION="DURATION",m.END_DATE="END-DATE",m.END_ON_NEXT="END-ON-NEXT",m.PLANNED_DURATION="PLANNED-DURATION",m.SCTE35_OUT="SCTE35-OUT",m.SCTE35_IN="SCTE35-IN"})(x||(x={}));var S=function(){function m(E,_){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,_){var y=_.attr;for(var p in y)if(Object.prototype.hasOwnProperty.call(E,p)&&E[p]!==y[p]){P.logger.warn('DATERANGE tag attribute: "'+p+'" does not match for tags with ID: "'+E.ID+'"'),this._badValueForSameId=p;break}E=I(new D.AttrList({}),y,E)}if(this.attr=E,this._startDate=new Date(E[x.START_DATE]),x.END_DATE in this.attr){var l=new Date(this.attr[x.END_DATE]);(0,b.isFiniteNumber)(l.getTime())&&(this._endDate=l)}}return A(m,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var _=this.duration;return _!==null?new Date(this._startDate.getTime()+_*1e3):null}},{key:"duration",get:function(){if(x.DURATION in this.attr){var _=this.attr.decimalFloatingPoint(x.DURATION);if((0,b.isFiniteNumber)(_))return _}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return x.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(x.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(x.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,b.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),m}()},"./src/loader/fragment-loader.ts":(W,B,L)=>{L.r(B),L.d(B,{LoadError:()=>p,default:()=>_});var b=L("./src/polyfills/number.ts"),D=L("./src/errors.ts");function P(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,S(l,n)}function I(l){var n=typeof Map=="function"?new Map:void 0;return I=function(u){if(u===null||!x(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(u))return n.get(u);n.set(u,h)}function h(){return M(u,arguments,m(this).constructor)}return h.prototype=Object.create(u.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),S(h,u)},I(l)}function M(l,n,t){return A()?M=Reflect.construct.bind():M=function(h,i,e){var r=[null];r.push.apply(r,i);var f=Function.bind.apply(h,r),o=new f;return e&&S(o,e.prototype),o},M.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function S(l,n){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},S(l,n)}function m(l){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(l)}var E=Math.pow(2,17),_=function(){function l(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var n=l.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(u,h){var i=this,e=u.url;if(!e)return Promise.reject(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,networkDetails:null},"Fragment does not have a "+(e?"part list":"url")));this.abort();var r=this.config,f=r.fLoader,o=r.loader;return new Promise(function(v,s){i.loader&&i.loader.destroy();var c=i.loader=u.loader=f?new f(r):new o(r),d=y(u),a={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:u.sn==="initSegment"?1/0:E};u.stats=c.stats,c.load(d,a,{onSuccess:function(T,R,C,O){i.resetLoader(u,c),v({frag:u,part:null,payload:T.data,networkDetails:O})},onError:function(T,R,C){i.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,response:T,networkDetails:C}))},onAbort:function(T,R,C){i.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,networkDetails:C}))},onTimeout:function(T,R,C){i.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,networkDetails:C}))},onProgress:function(T,R,C,O){h&&h({frag:u,part:null,payload:C,networkDetails:O})}})})},n.loadPart=function(u,h,i){var e=this;this.abort();var r=this.config,f=r.fLoader,o=r.loader;return new Promise(function(v,s){e.loader&&e.loader.destroy();var c=e.loader=u.loader=f?new f(r):new o(r),d=y(u,h),a={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:E};h.stats=c.stats,c.load(d,a,{onSuccess:function(T,R,C,O){e.resetLoader(u,c),e.updateStatsFromPart(u,h);var F={frag:u,part:h,payload:T.data,networkDetails:O};i(F),v(F)},onError:function(T,R,C){e.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,part:h,response:T,networkDetails:C}))},onAbort:function(T,R,C){u.stats.aborted=h.stats.aborted,e.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,part:h,networkDetails:C}))},onTimeout:function(T,R,C){e.resetLoader(u,c),s(new p({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,part:h,networkDetails:C}))}})})},n.updateStatsFromPart=function(u,h){var i=u.stats,e=h.stats,r=e.total;if(i.loaded+=e.loaded,r){var f=Math.round(u.duration/h.duration),o=Math.min(Math.round(i.loaded/r),f),v=f-o,s=v*Math.round(i.loaded/o);i.total=i.loaded+s}else i.total=Math.max(i.loaded,i.total);var c=i.loading,d=e.loading;c.start?c.first+=d.first-d.start:(c.start=d.start,c.first=d.first),c.end=d.end},n.resetLoader=function(u,h){u.loader=null,this.loader===h&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),h.destroy()},l}();function y(l,n){n===void 0&&(n=null);var t=n||l,u={frag:l,part:n,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},h=t.byteRangeStartOffset,i=t.byteRangeEndOffset;return(0,b.isFiniteNumber)(h)&&(0,b.isFiniteNumber)(i)&&(u.rangeStart=h,u.rangeEnd=i),u}var p=function(l){P(n,l);function n(t){for(var u,h=arguments.length,i=new Array(h>1?h-1:0),e=1;e<h;e++)i[e-1]=arguments[e];return u=l.call.apply(l,[this].concat(i))||this,u.data=void 0,u.data=t,u}return n}(I(Error))},"./src/loader/fragment.ts":(W,B,L)=>{L.r(B),L.d(B,{BaseSegment:()=>_,ElementaryStreamTypes:()=>E,Fragment:()=>y,Part:()=>p});var b=L("./src/polyfills/number.ts"),D=L("./node_modules/url-toolkit/src/url-toolkit.js"),P=L("./src/utils/logger.ts"),I=L("./src/loader/level-key.ts"),M=L("./src/loader/load-stats.ts");function A(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,x(l,n)}function x(l,n){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(l,n)}function S(l,n){for(var t=0;t<n.length;t++){var u=n[t];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}function m(l,n,t){return n&&S(l.prototype,n),t&&S(l,t),Object.defineProperty(l,"prototype",{writable:!1}),l}var E;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(E||(E={}));var _=function(){function l(t){var u;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(u={},u[E.AUDIO]=null,u[E.VIDEO]=null,u[E.AUDIOVIDEO]=null,u),this.baseurl=t}var n=l.prototype;return n.setByteRange=function(u,h){var i=u.split("@",2),e=[];i.length===1?e[0]=h?h.byteRangeEndOffset:0:e[0]=parseInt(i[1]),e[1]=parseInt(i[0])+e[0],this._byteRange=e},m(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,D.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(u){this._url=u}}]),l}(),y=function(l){A(n,l);function n(u,h){var i;return i=l.call(this,h)||this,i._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new M.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=u,i}var t=n.prototype;return t.createInitializationVector=function(h){for(var i=new Uint8Array(16),e=12;e<16;e++)i[e]=h>>8*(15-e)&255;return i},t.setDecryptDataFromLevelKey=function(h,i){var e=h;return(h==null?void 0:h.method)==="AES-128"&&h.uri&&!h.iv&&(e=I.LevelKey.fromURI(h.uri),e.method=h.method,e.iv=this.createInitializationVector(i),e.keyFormat="identity"),e},t.setElementaryStreamInfo=function(h,i,e,r,f,o){o===void 0&&(o=!1);var v=this.elementaryStreams,s=v[h];if(!s){v[h]={startPTS:i,endPTS:e,startDTS:r,endDTS:f,partial:o};return}s.startPTS=Math.min(s.startPTS,i),s.endPTS=Math.max(s.endPTS,e),s.startDTS=Math.min(s.startDTS,r),s.endDTS=Math.max(s.endDTS,f)},t.clearElementaryStreamInfo=function(){var h=this.elementaryStreams;h[E.AUDIO]=null,h[E.VIDEO]=null,h[E.AUDIOVIDEO]=null},m(n,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var h=this.sn;typeof h!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&P.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),h=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,h)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,b.isFiniteNumber)(this.programDateTime))return null;var h=(0,b.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+h*1e3}},{key:"encrypted",get:function(){var h;return!!((h=this.decryptdata)!==null&&h!==void 0&&h.keyFormat&&this.decryptdata.uri)}}]),n}(_),p=function(l){A(n,l);function n(t,u,h,i,e){var r;r=l.call(this,h)||this,r.fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new M.LoadStats,r.duration=t.decimalFloatingPoint("DURATION"),r.gap=t.bool("GAP"),r.independent=t.bool("INDEPENDENT"),r.relurl=t.enumeratedString("URI"),r.fragment=u,r.index=i;var f=t.enumeratedString("BYTERANGE");return f&&r.setByteRange(f,e),e&&(r.fragOffset=e.fragOffset+e.duration),r}return m(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var u=this.elementaryStreams;return!!(u.audio||u.video||u.audiovideo)}}]),n}(_)},"./src/loader/key-loader.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>I});var b=L("./src/events.ts"),D=L("./src/errors.ts"),P=L("./src/utils/logger.ts"),I=function(){function M(x){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=x,this.registerListeners()}var A=M.prototype;return A.startLoad=function(S){},A.stopLoad=function(){this.destroyInternalLoaders()},A.registerListeners=function(){this.hls.on(b.Events.KEY_LOADING,this.onKeyLoading,this)},A.unregisterListeners=function(){this.hls.off(b.Events.KEY_LOADING,this.onKeyLoading)},A.destroyInternalLoaders=function(){for(var S in this.loaders){var m=this.loaders[S];m&&m.destroy()}this.loaders={}},A.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},A.onKeyLoading=function(S,m){var E=m.frag,_=E.type,y=this.loaders[_];if(!E.decryptdata){P.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var p=E.decryptdata.uri;if(p!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(y&&(P.logger.warn("abort previous key loader for type:"+_),y.abort()),!p){P.logger.warn("key uri is falsy");return}var n=l.loader,t=E.loader=this.loaders[_]=new n(l);this.decrypturl=p,this.decryptkey=null;var u={url:p,frag:E,responseType:"arraybuffer"},h={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.load(u,h,i)}else this.decryptkey&&(E.decryptdata.key=this.decryptkey,this.hls.trigger(b.Events.KEY_LOADED,{frag:E}))},A.loadsuccess=function(S,m,E){var _=E.frag;if(!_.decryptdata){P.logger.error("after key load, decryptdata unset");return}this.decryptkey=_.decryptdata.key=new Uint8Array(S.data),_.loader=null,delete this.loaders[_.type],this.hls.trigger(b.Events.KEY_LOADED,{frag:_})},A.loaderror=function(S,m){var E=m.frag,_=E.loader;_&&_.abort(),delete this.loaders[E.type],this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:E,response:S})},A.loadtimeout=function(S,m){var E=m.frag,_=E.loader;_&&_.abort(),delete this.loaders[E.type],this.hls.trigger(b.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:E})},M}()},"./src/loader/level-details.ts":(W,B,L)=>{L.r(B),L.d(B,{LevelDetails:()=>M});var b=L("./src/polyfills/number.ts");function D(A,x){for(var S=0;S<x.length;S++){var m=x[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(A,m.key,m)}}function P(A,x,S){return x&&D(A.prototype,x),S&&D(A,S),Object.defineProperty(A,"prototype",{writable:!1}),A}var I=10,M=function(){function A(S){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=S}var x=A.prototype;return x.reloaded=function(m){if(!m){this.advanced=!0,this.updated=!0;return}var E=this.lastPartSn-m.lastPartSn,_=this.lastPartIndex-m.lastPartIndex;this.updated=this.endSN!==m.endSN||!!_||!!E,this.advanced=this.endSN>m.endSN||E>0||E===0&&_>0,this.updated||this.advanced?this.misses=Math.floor(m.misses*.6):this.misses=m.misses+1,this.availabilityDelay=m.availabilityDelay},P(A,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,b.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var m=this.driftEndTime-this.driftStartTime;if(m>0){var E=this.driftEnd-this.driftStart;return E*1e3/m}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var m;return(m=this.fragments)!==null&&m!==void 0&&m.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),A}()},"./src/loader/level-key.ts":(W,B,L)=>{L.r(B),L.d(B,{LevelKey:()=>I});var b=L("./node_modules/url-toolkit/src/url-toolkit.js");function D(M,A){for(var x=0;x<A.length;x++){var S=A[x];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(M,S.key,S)}}function P(M,A,x){return A&&D(M.prototype,A),x&&D(M,x),Object.defineProperty(M,"prototype",{writable:!1}),M}var I=function(){M.fromURL=function(x,S){return new M(x,S)},M.fromURI=function(x){return new M(x)};function M(A,x){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,x?this._uri=(0,b.buildAbsoluteURL)(A,x,{alwaysNormalize:!0}):this._uri=A}return P(M,[{key:"uri",get:function(){return this._uri}}]),M}()},"./src/loader/load-stats.ts":(W,B,L)=>{L.r(B),L.d(B,{LoadStats:()=>b});var b=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>t});var b=L("./src/polyfills/number.ts"),D=L("./node_modules/url-toolkit/src/url-toolkit.js"),P=L("./src/loader/date-range.ts"),I=L("./src/loader/fragment.ts"),M=L("./src/loader/level-details.ts"),A=L("./src/loader/level-key.ts"),x=L("./src/utils/attr-list.ts"),S=L("./src/utils/logger.ts"),m=L("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,_=/#EXT-X-MEDIA:(.*)/g,y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i;function n(f){var o,v;return l.test((o=(v=D.parseURL(f))===null||v===void 0?void 0:v.path)!=null?o:"")}var t=function(){function f(){}return f.findGroup=function(v,s){for(var c=0;c<v.length;c++){var d=v[c];if(d.id===s)return d}},f.convertAVC1ToAVCOTI=function(v){var s=v.split(".");if(s.length>2){var c=s.shift()+".";return c+=parseInt(s.shift()).toString(16),c+=("000"+parseInt(s.shift()).toString(16)).slice(-4),c}return v},f.resolve=function(v,s){return D.buildAbsoluteURL(s,v,{alwaysNormalize:!0})},f.parseMasterPlaylist=function(v,s){var c=[],d=[],a={},g=!1;E.lastIndex=0;for(var T;(T=E.exec(v))!=null;)if(T[1]){var R,C=new x.AttrList(T[1]),O={attrs:C,bitrate:C.decimalInteger("AVERAGE-BANDWIDTH")||C.decimalInteger("BANDWIDTH"),name:C.NAME,url:f.resolve(T[2],s)},F=C.decimalResolution("RESOLUTION");F&&(O.width=F.width,O.height=F.height),u((C.CODECS||"").split(/[ ,]+/).filter(function(N){return N}),O),O.videoCodec&&O.videoCodec.indexOf("avc1")!==-1&&(O.videoCodec=f.convertAVC1ToAVCOTI(O.videoCodec)),(R=O.unknownCodecs)!==null&&R!==void 0&&R.length||d.push(O),c.push(O)}else if(T[3]){var U=new x.AttrList(T[3]);U["DATA-ID"]&&(g=!0,a[U["DATA-ID"]]=U)}var k=d.length>0&&d.length<c.length;return{levels:k?d:c,sessionData:g?a:null}},f.parseMasterPlaylistMedia=function(v,s,c,d){d===void 0&&(d=[]);var a,g=[],T=0;for(_.lastIndex=0;(a=_.exec(v))!==null;){var R=new x.AttrList(a[1]);if(R.TYPE===c){var C={attrs:R,bitrate:0,id:T++,groupId:R["GROUP-ID"],instreamId:R["INSTREAM-ID"],name:R.NAME||R.LANGUAGE||"",type:c,default:R.bool("DEFAULT"),autoselect:R.bool("AUTOSELECT"),forced:R.bool("FORCED"),lang:R.LANGUAGE,url:R.URI?f.resolve(R.URI,s):""};if(d.length){var O=f.findGroup(d,C.groupId)||d[0];h(C,O,"audioCodec"),h(C,O,"textCodec")}g.push(C)}}return g},f.parseLevelPlaylist=function(v,s,c,d,a){var g=new M.LevelDetails(s),T=g.fragments,R=null,C=0,O=0,F=0,U=0,k=null,N=new I.Fragment(d,s),w,K,G,H=-1,V=!1;for(y.lastIndex=0,g.m3u8=v;(w=y.exec(v))!==null;){V&&(V=!1,N=new I.Fragment(d,s),N.start=F,N.sn=C,N.cc=U,N.level=c,R&&(N.initSegment=R,N.rawProgramDateTime=R.rawProgramDateTime,R.rawProgramDateTime=null));var X=w[1];if(X){N.duration=parseFloat(X);var Y=(" "+w[2]).slice(1);N.title=Y||null,N.tagList.push(Y?["INF",X,Y]:["INF",X])}else if(w[3])(0,b.isFiniteNumber)(N.duration)&&(N.start=F,G&&(N.levelkey=G),N.sn=C,N.level=c,N.cc=U,N.urlId=a,T.push(N),N.relurl=(" "+w[3]).slice(1),e(N,k),k=N,F+=N.duration,C++,O=0,V=!0);else if(w[4]){var Q=(" "+w[4]).slice(1);k?N.setByteRange(Q,k):N.setByteRange(Q)}else if(w[5])N.rawProgramDateTime=(" "+w[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),H===-1&&(H=T.length);else{if(w=w[0].match(p),!w){S.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<w.length&&!(typeof w[K]<"u");K++);var $=(" "+w[K]).slice(1),j=(" "+w[K+1]).slice(1),z=w[K+2]?(" "+w[K+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":g.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":C=g.startSN=parseInt(j);break;case"SKIP":{var J=new x.AttrList(j),Z=J.decimalInteger("SKIPPED-SEGMENTS");if((0,b.isFiniteNumber)(Z)){g.skippedSegments=Z;for(var q=Z;q--;)T.unshift(null);C+=Z}var ae=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");ae&&(g.recentlyRemovedDateranges=ae.split("	"));break}case"TARGETDURATION":g.targetduration=parseFloat(j);break;case"VERSION":g.version=parseInt(j);break;case"EXTM3U":break;case"ENDLIST":g.live=!1;break;case"#":(j||z)&&N.tagList.push(z?[j,z]:[j]);break;case"DISCONTINUITY":U++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([$]);break;case"BITRATE":N.tagList.push([$,j]);break;case"DATERANGE":{var ee=new x.AttrList(j),fe=new P.DateRange(ee,g.dateRanges[ee.ID]);fe.isValid||g.skippedSegments?g.dateRanges[fe.id]=fe:S.logger.warn('Ignoring invalid DATERANGE tag: "'+j+'"'),N.tagList.push(["EXT-X-DATERANGE",j]);break}case"DISCONTINUITY-SEQUENCE":U=parseInt(j);break;case"KEY":{var se,ne=new x.AttrList(j),ue=ne.enumeratedString("METHOD"),he=ne.URI,me=ne.hexadecimalInteger("IV"),ce=ne.enumeratedString("KEYFORMATVERSIONS"),de=ne.enumeratedString("KEYID"),pe=(se=ne.enumeratedString("KEYFORMAT"))!=null?se:"identity",ve=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(ve.indexOf(pe)>-1){S.logger.warn("Keyformat "+pe+" is not supported from the manifest");continue}else if(pe!=="identity")continue;ue&&(G=A.LevelKey.fromURL(s,he),he&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ue)>=0&&(G.method=ue,G.keyFormat=pe,de&&(G.keyID=de),ce&&(G.keyFormatVersions=ce),G.iv=me));break}case"START":{var Se=new x.AttrList(j),re=Se.decimalFloatingPoint("TIME-OFFSET");(0,b.isFiniteNumber)(re)&&(g.startTimeOffset=re);break}case"MAP":{var oe=new x.AttrList(j);if(N.duration){var Ee=new I.Fragment(d,s);r(Ee,oe,c,G),R=Ee,N.initSegment=R,R.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=R.rawProgramDateTime)}else r(N,oe,c,G),R=N,V=!0;break}case"SERVER-CONTROL":{var te=new x.AttrList(j);g.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),g.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),g.canSkipDateRanges=g.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),g.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),g.holdBack=te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var le=new x.AttrList(j);g.partTarget=le.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ge=g.partList;ge||(ge=g.partList=[]);var Ie=O>0?ge[ge.length-1]:void 0,Re=O++,Ce=new I.Part(new x.AttrList(j),N,s,Re,Ie);ge.push(Ce),N.duration+=Ce.duration;break}case"PRELOAD-HINT":{var _e=new x.AttrList(j);g.preloadHint=_e;break}case"RENDITION-REPORT":{var Be=new x.AttrList(j);g.renditionReports=g.renditionReports||[],g.renditionReports.push(Be);break}default:S.logger.warn("line parsed but not handled: "+w);break}}}k&&!k.relurl?(T.pop(),F-=k.duration,g.partList&&(g.fragmentHint=k)):g.partList&&(e(N,k),N.cc=U,g.fragmentHint=N);var Pe=T.length,Le=T[0],Me=T[Pe-1];if(F+=g.skippedSegments*g.targetduration,F>0&&Pe&&Me){g.averagetargetduration=F/Pe;var Oe=Me.sn;g.endSN=Oe!=="initSegment"?Oe:0,Le&&(g.startCC=Le.cc,Le.initSegment||g.fragments.every(function(be){return be.relurl&&n(be.relurl)})&&(S.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new I.Fragment(d,s),N.relurl=Me.relurl,N.level=c,N.sn="initSegment",Le.initSegment=N,g.needSidxRanges=!0))}else g.endSN=0,g.startCC=0;return g.fragmentHint&&(F+=g.fragmentHint.duration),g.totalduration=F,g.endCC=U,H>0&&i(T,H),g},f}();function u(f,o){["video","audio","text"].forEach(function(v){var s=f.filter(function(d){return(0,m.isCodecType)(d,v)});if(s.length){var c=s.filter(function(d){return d.lastIndexOf("avc1",0)===0||d.lastIndexOf("mp4a",0)===0});o[v+"Codec"]=c.length>0?c[0]:s[0],f=f.filter(function(d){return s.indexOf(d)===-1})}}),o.unknownCodecs=f}function h(f,o,v){var s=o[v];s&&(f[v]=s)}function i(f,o){for(var v=f[o],s=o;s--;){var c=f[s];if(!c)return;c.programDateTime=v.programDateTime-c.duration*1e3,v=c}}function e(f,o){f.rawProgramDateTime?f.programDateTime=Date.parse(f.rawProgramDateTime):o!=null&&o.programDateTime&&(f.programDateTime=o.endProgramDateTime),(0,b.isFiniteNumber)(f.programDateTime)||(f.programDateTime=null,f.rawProgramDateTime=null)}function r(f,o,v,s){f.relurl=o.URI,o.BYTERANGE&&f.setByteRange(o.BYTERANGE),f.level=v,f.sn="initSegment",s&&(f.levelkey=s),f.initSegment=null}},"./src/loader/playlist-loader.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>y});var b=L("./src/polyfills/number.ts"),D=L("./src/events.ts"),P=L("./src/errors.ts"),I=L("./src/utils/logger.ts"),M=L("./src/utils/mp4-tools.ts"),A=L("./src/loader/m3u8-parser.ts"),x=L("./src/types/loader.ts"),S=L("./src/utils/attr-list.ts");function m(p){var l=p.type;switch(l){case x.PlaylistContextType.AUDIO_TRACK:return x.PlaylistLevelType.AUDIO;case x.PlaylistContextType.SUBTITLE_TRACK:return x.PlaylistLevelType.SUBTITLE;default:return x.PlaylistLevelType.MAIN}}function E(p,l){var n=p.url;return(n===void 0||n.indexOf("data:")===0)&&(n=l.url),n}var _=function(){function p(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var l=p.prototype;return l.startLoad=function(t){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var t=this.hls;t.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var t=this.hls;t.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(t){var u=this.hls.config,h=u.pLoader,i=u.loader,e=h||i,r=new e(u);return t.loader=r,this.loaders[t.type]=r,r},l.getInternalLoader=function(t){return this.loaders[t.type]},l.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},l.destroyInternalLoaders=function(){for(var t in this.loaders){var u=this.loaders[t];u&&u.destroy(),this.resetInternalLoader(t)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(t,u){var h=u.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:x.PlaylistContextType.MANIFEST,url:h,deliveryDirectives:null})},l.onLevelLoading=function(t,u){var h=u.id,i=u.level,e=u.url,r=u.deliveryDirectives;this.load({id:h,groupId:null,level:i,responseType:"text",type:x.PlaylistContextType.LEVEL,url:e,deliveryDirectives:r})},l.onAudioTrackLoading=function(t,u){var h=u.id,i=u.groupId,e=u.url,r=u.deliveryDirectives;this.load({id:h,groupId:i,level:null,responseType:"text",type:x.PlaylistContextType.AUDIO_TRACK,url:e,deliveryDirectives:r})},l.onSubtitleTrackLoading=function(t,u){var h=u.id,i=u.groupId,e=u.url,r=u.deliveryDirectives;this.load({id:h,groupId:i,level:null,responseType:"text",type:x.PlaylistContextType.SUBTITLE_TRACK,url:e,deliveryDirectives:r})},l.load=function(t){var u,h=this.hls.config,i=this.getInternalLoader(t);if(i){var e=i.context;if(e&&e.url===t.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),i.abort()}var r,f,o,v;switch(t.type){case x.PlaylistContextType.MANIFEST:r=h.manifestLoadingMaxRetry,f=h.manifestLoadingTimeOut,o=h.manifestLoadingRetryDelay,v=h.manifestLoadingMaxRetryTimeout;break;case x.PlaylistContextType.LEVEL:case x.PlaylistContextType.AUDIO_TRACK:case x.PlaylistContextType.SUBTITLE_TRACK:r=0,f=h.levelLoadingTimeOut;break;default:r=h.levelLoadingMaxRetry,f=h.levelLoadingTimeOut,o=h.levelLoadingRetryDelay,v=h.levelLoadingMaxRetryTimeout;break}if(i=this.createInternalLoader(t),(u=t.deliveryDirectives)!==null&&u!==void 0&&u.part){var s;if(t.type===x.PlaylistContextType.LEVEL&&t.level!==null?s=this.hls.levels[t.level].details:t.type===x.PlaylistContextType.AUDIO_TRACK&&t.id!==null?s=this.hls.audioTracks[t.id].details:t.type===x.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(s=this.hls.subtitleTracks[t.id].details),s){var c=s.partTarget,d=s.targetduration;c&&d&&(f=Math.min(Math.max(c*3,d*.8)*1e3,f))}}var a={timeout:f,maxRetry:r,retryDelay:o,maxRetryDelay:v,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(t,a,g)},l.loadsuccess=function(t,u,h,i){if(i===void 0&&(i=null),h.isSidxRequest){this.handleSidxRequest(t,h),this.handlePlaylistLoaded(t,u,h,i);return}this.resetInternalLoader(h.type);var e=t.data;if(e.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,h,"no EXTM3U delimiter",i);return}u.parsing.start=performance.now(),e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,u,h,i):this.handleMasterPlaylist(t,u,h,i)},l.loaderror=function(t,u,h){h===void 0&&(h=null),this.handleNetworkError(u,h,!1,t)},l.loadtimeout=function(t,u,h){h===void 0&&(h=null),this.handleNetworkError(u,h,!0)},l.handleMasterPlaylist=function(t,u,h,i){var e=this.hls,r=t.data,f=E(t,h),o=A.default.parseMasterPlaylist(r,f),v=o.levels,s=o.sessionData;if(!v.length){this.handleManifestParsingError(t,h,"no level found in manifest",i);return}var c=v.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),d=v.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),a=A.default.parseMasterPlaylistMedia(r,f,"AUDIO",c),g=A.default.parseMasterPlaylistMedia(r,f,"SUBTITLES",d),T=A.default.parseMasterPlaylistMedia(r,f,"CLOSED-CAPTIONS");if(a.length){var R=a.some(function(C){return!C.url});!R&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))}e.trigger(D.Events.MANIFEST_LOADED,{levels:v,audioTracks:a,subtitles:g,captions:T,url:f,stats:u,networkDetails:i,sessionData:s})},l.handleTrackOrLevelPlaylist=function(t,u,h,i){var e=this.hls,r=h.id,f=h.level,o=h.type,v=E(t,h),s=(0,b.isFiniteNumber)(r)?r:0,c=(0,b.isFiniteNumber)(f)?f:s,d=m(h),a=A.default.parseLevelPlaylist(t.data,v,c,d,s);if(!a.fragments.length){e.trigger(D.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof h.level=="number"?h.level:void 0});return}if(o===x.PlaylistContextType.MANIFEST){var g={attrs:new S.AttrList({}),bitrate:0,details:a,name:"",url:v};e.trigger(D.Events.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:v,stats:u,networkDetails:i,sessionData:null})}if(u.parsing.end=performance.now(),a.needSidxRanges){var T,R=(T=a.fragments[0].initSegment)===null||T===void 0?void 0:T.url;this.load({url:R,isSidxRequest:!0,type:o,level:f,levelDetails:a,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}h.levelDetails=a,this.handlePlaylistLoaded(t,u,h,i)},l.handleSidxRequest=function(t,u){var h=new Uint8Array(t.data),i=(0,M.findBox)(h,["sidx"])[0];if(i){var e=(0,M.parseSegmentIndex)(i);if(e){var r=e.references,f=u.levelDetails;r.forEach(function(o,v){var s=o.info,c=f.fragments[v];if(c.byteRange.length===0&&c.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),c.initSegment){var d=(0,M.findBox)(h,["moov"])[0],a=d?d.length:null;c.initSegment.setByteRange(String(a)+"@0")}})}}},l.handleManifestParsingError=function(t,u,h,i){this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:u.type===x.PlaylistContextType.MANIFEST,url:t.url,reason:h,response:t,context:u,networkDetails:i})},l.handleNetworkError=function(t,u,h,i){h===void 0&&(h=!1),I.logger.warn("[playlist-loader]: A network "+(h?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var e=P.ErrorDetails.UNKNOWN,r=!1,f=this.getInternalLoader(t);switch(t.type){case x.PlaylistContextType.MANIFEST:e=h?P.ErrorDetails.MANIFEST_LOAD_TIMEOUT:P.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case x.PlaylistContextType.LEVEL:e=h?P.ErrorDetails.LEVEL_LOAD_TIMEOUT:P.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case x.PlaylistContextType.AUDIO_TRACK:e=h?P.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case x.PlaylistContextType.SUBTITLE_TRACK:e=h?P.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:P.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}f&&this.resetInternalLoader(t.type);var o={type:P.ErrorTypes.NETWORK_ERROR,details:e,fatal:r,url:t.url,loader:f,context:t,networkDetails:u};i&&(o.response=i),this.hls.trigger(D.Events.ERROR,o)},l.handlePlaylistLoaded=function(t,u,h,i){var e=h.type,r=h.level,f=h.id,o=h.groupId,v=h.loader,s=h.levelDetails,c=h.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(t,h,"invalid target duration",i);return}if(v)switch(s.live&&(v.getCacheAge&&(s.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),e){case x.PlaylistContextType.MANIFEST:case x.PlaylistContextType.LEVEL:this.hls.trigger(D.Events.LEVEL_LOADED,{details:s,level:r||0,id:f||0,stats:u,networkDetails:i,deliveryDirectives:c});break;case x.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(D.Events.AUDIO_TRACK_LOADED,{details:s,id:f||0,groupId:o||"",stats:u,networkDetails:i,deliveryDirectives:c});break;case x.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADED,{details:s,id:f||0,groupId:o||"",stats:u,networkDetails:i,deliveryDirectives:c});break}},p}();const y=_},"./src/polyfills/number.ts":(W,B,L)=>{L.r(B),L.d(B,{MAX_SAFE_INTEGER:()=>D,isFiniteNumber:()=>b});var b=Number.isFinite||function(P){return typeof P=="number"&&isFinite(P)},D=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>D});var b=function(){function P(){}return P.getSilentFrame=function(M,A){switch(M){case"mp4a.40.2":if(A===1)return new Uint8Array([0,200,0,128,35,128]);if(A===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(A===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(A===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(A===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(A===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(A===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(A===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(A===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},P}();const D=b},"./src/remux/mp4-generator.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>P});var b=Math.pow(2,32)-1,D=function(){function I(){}return I.init=function(){I.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var A;for(A in I.types)I.types.hasOwnProperty(A)&&(I.types[A]=[A.charCodeAt(0),A.charCodeAt(1),A.charCodeAt(2),A.charCodeAt(3)]);var x=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);I.HDLR_TYPES={video:x,audio:S};var m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);I.STTS=I.STSC=I.STCO=E,I.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),I.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),I.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),I.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var _=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);I.FTYP=I.box(I.types.ftyp,_,p,_,y),I.DINF=I.box(I.types.dinf,I.box(I.types.dref,m))},I.box=function(A){for(var x=8,S=arguments.length,m=new Array(S>1?S-1:0),E=1;E<S;E++)m[E-1]=arguments[E];for(var _=m.length,y=_;_--;)x+=m[_].byteLength;var p=new Uint8Array(x);for(p[0]=x>>24&255,p[1]=x>>16&255,p[2]=x>>8&255,p[3]=x&255,p.set(A,4),_=0,x=8;_<y;_++)p.set(m[_],x),x+=m[_].byteLength;return p},I.hdlr=function(A){return I.box(I.types.hdlr,I.HDLR_TYPES[A])},I.mdat=function(A){return I.box(I.types.mdat,A)},I.mdhd=function(A,x){x*=A;var S=Math.floor(x/(b+1)),m=Math.floor(x%(b+1));return I.box(I.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,S>>24,S>>16&255,S>>8&255,S&255,m>>24,m>>16&255,m>>8&255,m&255,85,196,0,0]))},I.mdia=function(A){return I.box(I.types.mdia,I.mdhd(A.timescale,A.duration),I.hdlr(A.type),I.minf(A))},I.mfhd=function(A){return I.box(I.types.mfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255]))},I.minf=function(A){return A.type==="audio"?I.box(I.types.minf,I.box(I.types.smhd,I.SMHD),I.DINF,I.stbl(A)):I.box(I.types.minf,I.box(I.types.vmhd,I.VMHD),I.DINF,I.stbl(A))},I.moof=function(A,x,S){return I.box(I.types.moof,I.mfhd(A),I.traf(S,x))},I.moov=function(A){for(var x=A.length,S=[];x--;)S[x]=I.trak(A[x]);return I.box.apply(null,[I.types.moov,I.mvhd(A[0].timescale,A[0].duration)].concat(S).concat(I.mvex(A)))},I.mvex=function(A){for(var x=A.length,S=[];x--;)S[x]=I.trex(A[x]);return I.box.apply(null,[I.types.mvex].concat(S))},I.mvhd=function(A,x){x*=A;var S=Math.floor(x/(b+1)),m=Math.floor(x%(b+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,S>>24,S>>16&255,S>>8&255,S&255,m>>24,m>>16&255,m>>8&255,m&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return I.box(I.types.mvhd,E)},I.sdtp=function(A){var x=A.samples||[],S=new Uint8Array(4+x.length),m,E;for(m=0;m<x.length;m++)E=x[m].flags,S[m+4]=E.dependsOn<<4|E.isDependedOn<<2|E.hasRedundancy;return I.box(I.types.sdtp,S)},I.stbl=function(A){return I.box(I.types.stbl,I.stsd(A),I.box(I.types.stts,I.STTS),I.box(I.types.stsc,I.STSC),I.box(I.types.stsz,I.STSZ),I.box(I.types.stco,I.STCO))},I.avc1=function(A){var x=[],S=[],m,E,_;for(m=0;m<A.sps.length;m++)E=A.sps[m],_=E.byteLength,x.push(_>>>8&255),x.push(_&255),x=x.concat(Array.prototype.slice.call(E));for(m=0;m<A.pps.length;m++)E=A.pps[m],_=E.byteLength,S.push(_>>>8&255),S.push(_&255),S=S.concat(Array.prototype.slice.call(E));var y=I.box(I.types.avcC,new Uint8Array([1,x[3],x[4],x[5],255,224|A.sps.length].concat(x).concat([A.pps.length]).concat(S))),p=A.width,l=A.height,n=A.pixelRatio[0],t=A.pixelRatio[1];return I.box(I.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,p&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,I.box(I.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),I.box(I.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,t>>24,t>>16&255,t>>8&255,t&255])))},I.esds=function(A){var x=A.config.length;return new Uint8Array([0,0,0,0,3,23+x,0,1,0,4,15+x,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([x]).concat(A.config).concat([6,1,2]))},I.mp4a=function(A){var x=A.samplerate;return I.box(I.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,x>>8&255,x&255,0,0]),I.box(I.types.esds,I.esds(A)))},I.mp3=function(A){var x=A.samplerate;return I.box(I.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,x>>8&255,x&255,0,0]))},I.stsd=function(A){return A.type==="audio"?A.segmentCodec==="mp3"&&A.codec==="mp3"?I.box(I.types.stsd,I.STSD,I.mp3(A)):I.box(I.types.stsd,I.STSD,I.mp4a(A)):I.box(I.types.stsd,I.STSD,I.avc1(A))},I.tkhd=function(A){var x=A.id,S=A.duration*A.timescale,m=A.width,E=A.height,_=Math.floor(S/(b+1)),y=Math.floor(S%(b+1));return I.box(I.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>8&255,m&255,0,0,E>>8&255,E&255,0,0]))},I.traf=function(A,x){var S=I.sdtp(A),m=A.id,E=Math.floor(x/(b+1)),_=Math.floor(x%(b+1));return I.box(I.types.traf,I.box(I.types.tfhd,new Uint8Array([0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255])),I.box(I.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,_>>24,_>>16&255,_>>8&255,_&255])),I.trun(A,S.length+16+20+8+16+8+8),S)},I.trak=function(A){return A.duration=A.duration||4294967295,I.box(I.types.trak,I.tkhd(A),I.mdia(A))},I.trex=function(A){var x=A.id;return I.box(I.types.trex,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},I.trun=function(A,x){var S=A.samples||[],m=S.length,E=12+16*m,_=new Uint8Array(E),y,p,l,n,t,u;for(x+=8+E,_.set([A.type==="video"?1:0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255],0),y=0;y<m;y++)p=S[y],l=p.duration,n=p.size,t=p.flags,u=p.cts,_.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,u>>>24&255,u>>>16&255,u>>>8&255,u&255],12+16*y);return I.box(I.types.trun,_)},I.initSegment=function(A){I.types||I.init();var x=I.moov(A),S=new Uint8Array(I.FTYP.byteLength+x.byteLength);return S.set(I.FTYP),S.set(x,I.FTYP.byteLength),S},I}();D.types=void 0,D.HDLR_TYPES=void 0,D.STTS=void 0,D.STSC=void 0,D.STCO=void 0,D.STSZ=void 0,D.VMHD=void 0,D.SMHD=void 0,D.STSD=void 0,D.FTYP=void 0,D.DINF=void 0;const P=D},"./src/remux/mp4-remuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>n,flushTextTrackMetadataCueSamples:()=>h,flushTextTrackUserdataCueSamples:()=>i,normalizePts:()=>t});var b=L("./src/polyfills/number.ts"),D=L("./src/remux/aac-helper.ts"),P=L("./src/remux/mp4-generator.ts"),I=L("./src/events.ts"),M=L("./src/errors.ts"),A=L("./src/utils/logger.ts"),x=L("./src/types/loader.ts"),S=L("./src/utils/timescale-conversion.ts");function m(){return m=Object.assign?Object.assign.bind():function(f){for(var o=1;o<arguments.length;o++){var v=arguments[o];for(var s in v)Object.prototype.hasOwnProperty.call(v,s)&&(f[s]=v[s])}return f},m.apply(this,arguments)}var E=10*1e3,_=1024,y=1152,p=null,l=null,n=function(){function f(v,s,c,d){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=v,this.config=s,this.typeSupported=c,this.ISGenerated=!1,p===null){var a=navigator.userAgent||"",g=a.match(/Chrome\/(\d+)/i);p=g?parseInt(g[1]):0}if(l===null){var T=navigator.userAgent.match(/Safari\/(\d+)/i);l=T?parseInt(T[1]):0}}var o=f.prototype;return o.destroy=function(){},o.resetTimeStamp=function(s){A.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},o.resetNextTimestamp=function(){A.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},o.resetInitSegment=function(){A.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},o.getVideoStartPts=function(s){var c=!1,d=s.reduce(function(a,g){var T=g.pts-a;return T<-4294967296?(c=!0,t(a,g.pts)):T>0?a:g.pts},s[0].pts);return c&&A.logger.debug("PTS rollover detected"),d},o.remux=function(s,c,d,a,g,T,R,C){var O,F,U,k,N,w,K=g,G=g,H=s.pid>-1,V=c.pid>-1,X=c.samples.length,Y=s.samples.length>0,Q=R&&X>0||X>1,$=(!H||Y)&&(!V||Q)||this.ISGenerated||R;if($){this.ISGenerated||(U=this.generateIS(s,c,g));var j=this.isVideoContiguous,z=-1,J;if(Q&&(z=u(c.samples),!j&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,z>0){A.logger.warn("[mp4-remuxer]: Dropped "+z+" out of "+X+" video samples due to a missing keyframe");var Z=this.getVideoStartPts(c.samples);c.samples=c.samples.slice(z),c.dropped+=z,G+=(c.samples[0].pts-Z)/c.inputTimeScale,J=G}else z===-1&&(A.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),w=!1);if(this.ISGenerated){if(Y&&Q){var q=this.getVideoStartPts(c.samples),ae=t(s.samples[0].pts,q)-q,ee=ae/c.inputTimeScale;K+=Math.max(0,ee),G+=Math.max(0,-ee)}if(Y){if(s.samplerate||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(s,c,g)),F=this.remuxAudio(s,K,this.isAudioContiguous,T,V||Q||C===x.PlaylistLevelType.AUDIO?G:void 0),Q){var fe=F?F.endPTS-F.startPTS:0;c.inputTimeScale||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(s,c,g)),O=this.remuxVideo(c,G,j,fe)}}else Q&&(O=this.remuxVideo(c,G,j,0));O&&(O.firstKeyFrame=z,O.independent=z!==-1,O.firstKeyFramePTS=J)}}return this.ISGenerated&&(d.samples.length&&(N=h(d,g,this._initPTS,this._initDTS)),a.samples.length&&(k=i(a,g,this._initPTS))),{audio:F,video:O,initSegment:U,independent:w,text:k,id3:N}},o.generateIS=function(s,c,d){var a=s.samples,g=c.samples,T=this.typeSupported,R={},C=!(0,b.isFiniteNumber)(this._initPTS),O="audio/mp4",F,U,k;if(C&&(F=U=1/0),s.config&&a.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":T.mpeg?(O="audio/mpeg",s.codec=""):T.mp3&&(s.codec="mp3");break}R.audio={id:"audio",container:O,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&T.mpeg?new Uint8Array(0):P.default.initSegment([s]),metadata:{channelCount:s.channelCount}},C&&(k=s.inputTimeScale,F=U=a[0].pts-Math.round(k*d))}if(c.sps&&c.pps&&g.length&&(c.timescale=c.inputTimeScale,R.video={id:"main",container:"video/mp4",codec:c.codec,initSegment:P.default.initSegment([c]),metadata:{width:c.width,height:c.height}},C)){k=c.inputTimeScale;var N=this.getVideoStartPts(g),w=Math.round(k*d);U=Math.min(U,t(g[0].dts,N)-w),F=Math.min(F,N-w)}if(Object.keys(R).length)return this.ISGenerated=!0,C&&(this._initPTS=F,this._initDTS=U),{tracks:R,initPTS:F,timescale:k}},o.remuxVideo=function(s,c,d,a){var g=s.inputTimeScale,T=s.samples,R=[],C=T.length,O=this._initPTS,F=this.nextAvcDts,U=8,k=this.videoSampleDuration,N,w,K=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,H=!1;if(!d||F===null){var V=c*g,X=T[0].pts-t(T[0].dts,T[0].pts);F=V-X}for(var Y=0;Y<C;Y++){var Q=T[Y];Q.pts=t(Q.pts-O,F),Q.dts=t(Q.dts-O,F),Q.dts<T[Y>0?Y-1:Y].dts&&(H=!0)}H&&T.sort(function(Ne,He){var $e=Ne.dts-He.dts,Ze=Ne.pts-He.pts;return $e||Ze}),N=T[0].dts,w=T[T.length-1].dts;var $=w-N,j=$?Math.round($/(C-1)):k||s.inputTimeScale/30;if(d){var z=N-F,J=z>j,Z=z<-1;if((J||Z)&&(J?A.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it"):A.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),!Z||F>T[0].pts)){N=F;var q=T[0].pts-z;T[0].dts=N,T[0].pts=q,A.logger.log("Video: First PTS/DTS adjusted: "+(0,S.toMsFromMpegTsClock)(q,!0)+"/"+(0,S.toMsFromMpegTsClock)(N,!0)+", delta: "+(0,S.toMsFromMpegTsClock)(z,!0)+" ms")}}N=Math.max(0,N);for(var ae=0,ee=0,fe=0;fe<C;fe++){for(var se=T[fe],ne=se.units,ue=ne.length,he=0,me=0;me<ue;me++)he+=ne[me].data.length;ee+=he,ae+=ue,se.length=he,se.dts=Math.max(se.dts,N),K=Math.min(se.pts,K),G=Math.max(se.pts,G)}w=T[C-1].dts;var ce=ee+4*ae+8,de;try{de=new Uint8Array(ce)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ce,reason:"fail allocating video mdat "+ce});return}var pe=new DataView(de.buffer);pe.setUint32(0,ce),de.set(P.default.types.mdat,4);for(var ve=!1,Se=Number.POSITIVE_INFINITY,re=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,Ee=Number.NEGATIVE_INFINITY,te=0;te<C;te++){for(var le=T[te],ge=le.units,Ie=0,Re=0,Ce=ge.length;Re<Ce;Re++){var _e=ge[Re],Be=_e.data,Pe=_e.data.byteLength;pe.setUint32(U,Pe),U+=4,de.set(Be,U),U+=Pe,Ie+=4+Pe}var Le=void 0;if(te<C-1)k=T[te+1].dts-le.dts,Le=T[te+1].pts-le.pts;else{var Me=this.config,Oe=te>0?le.dts-T[te-1].dts:j;if(Le=te>0?le.pts-T[te-1].pts:j,Me.stretchShortVideoTrack&&this.nextAudioPts!==null){var be=Math.floor(Me.maxBufferHole*g),Ue=(a?K+a*g:this.nextAudioPts)-le.pts;Ue>be?(k=Ue-Oe,k<0?k=Oe:ve=!0,A.logger.log("[mp4-remuxer]: It is approximately "+Ue/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=Oe}else k=Oe}var Ve=Math.round(le.pts-le.dts);Se=Math.min(Se,k),oe=Math.max(oe,k),re=Math.min(re,Le),Ee=Math.max(Ee,Le),R.push(new e(le.key,k,Ie,Ve))}if(R.length){if(p){if(p<70){var Ke=R[0].flags;Ke.dependsOn=2,Ke.isNonSync=0}}else if(l&&Ee-re<oe-Se&&j/oe<.025&&R[0].cts===0){A.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ke=N,ye=0,We=R.length;ye<We;ye++){var Ge=ke+R[ye].duration,je=ke+R[ye].cts;if(ye<We-1){var Ye=Ge+R[ye+1].cts;R[ye].duration=Ye-je}else R[ye].duration=ye?R[ye-1].duration:j;R[ye].cts=0,ke=Ge}}}console.assert(k!==null,"mp4SampleDuration must be computed"),k=ve||!k?j:k,this.nextAvcDts=F=w+k,this.videoSampleDuration=k,this.isVideoContiguous=!0;var Xe=P.default.moof(s.sequenceNumber++,N,m({},s,{samples:R})),ze="video",Qe={data1:Xe,data2:de,startPTS:K/g,endPTS:(G+k)/g,startDTS:N/g,endDTS:F/g,type:ze,hasAudio:!1,hasVideo:!0,nb:R.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(de.length,"MDAT length must not be zero"),Qe},o.remuxAudio=function(s,c,d,a,g){var T=s.inputTimeScale,R=s.samplerate?s.samplerate:T,C=T/R,O=s.segmentCodec==="aac"?_:y,F=O*C,U=this._initPTS,k=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,N=[],w=g!==void 0,K=s.samples,G=k?0:8,H=this.nextAudioPts||-1,V=c*T;if(this.isAudioContiguous=d=d||K.length&&H>0&&(a&&Math.abs(V-H)<9e3||Math.abs(t(K[0].pts-U,V)-H)<20*F),K.forEach(function(_e){_e.pts=t(_e.pts-U,V)}),!d||H<0){if(K=K.filter(function(_e){return _e.pts>=0}),!K.length)return;g===0?H=0:a&&!w?H=Math.max(0,V):H=K[0].pts}if(s.segmentCodec==="aac")for(var X=this.config.maxAudioFramesDrift,Y=0,Q=H;Y<K.length;Y++){var $=K[Y],j=$.pts,z=j-Q,J=Math.abs(1e3*z/T);if(z<=-X*F&&w)Y===0&&(A.logger.warn("Audio frame @ "+(j/T).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*z/T)+" ms."),this.nextAudioPts=H=Q=j);else if(z>=X*F&&J<E&&w){var Z=Math.round(z/F);Q=j-Z*F,Q<0&&(Z--,Q+=F),Y===0&&(this.nextAudioPts=H=Q),A.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(Q/T).toFixed(3)+"s due to "+Math.round(1e3*z/T)+" ms gap.");for(var q=0;q<Z;q++){var ae=Math.max(Q,0),ee=D.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);ee||(A.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ee=$.unit.subarray()),K.splice(Y,0,{unit:ee,pts:ae}),Q+=F,Y++}}$.pts=Q,Q+=F}for(var fe=null,se=null,ne,ue=0,he=K.length;he--;)ue+=K[he].unit.byteLength;for(var me=0,ce=K.length;me<ce;me++){var de=K[me],pe=de.unit,ve=de.pts;if(se!==null){var Se=N[me-1];Se.duration=Math.round((ve-se)/C)}else if(d&&s.segmentCodec==="aac"&&(ve=H),fe=ve,ue>0){ue+=G;try{ne=new Uint8Array(ue)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ue,reason:"fail allocating audio mdat "+ue});return}if(!k){var re=new DataView(ne.buffer);re.setUint32(0,ue),ne.set(P.default.types.mdat,4)}}else return;ne.set(pe,G);var oe=pe.byteLength;G+=oe,N.push(new e(!0,O,oe,0)),se=ve}var Ee=N.length;if(Ee){var te=N[N.length-1];this.nextAudioPts=H=se+C*te.duration;var le=k?new Uint8Array(0):P.default.moof(s.sequenceNumber++,fe/C,m({},s,{samples:N}));s.samples=[];var ge=fe/T,Ie=H/T,Re="audio",Ce={data1:le,data2:ne,startPTS:ge,endPTS:Ie,startDTS:ge,endDTS:Ie,type:Re,hasAudio:!0,hasVideo:!1,nb:Ee};return this.isAudioContiguous=!0,console.assert(ne.length,"MDAT length must not be zero"),Ce}},o.remuxEmptyAudio=function(s,c,d,a){var g=s.inputTimeScale,T=s.samplerate?s.samplerate:g,R=g/T,C=this.nextAudioPts,O=(C!==null?C:a.startDTS*g)+this._initDTS,F=a.endDTS*g+this._initDTS,U=R*_,k=Math.ceil((F-O)/U),N=D.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(A.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){A.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],K=0;K<k;K++){var G=O+K*U;w.push({unit:N,pts:G,dts:G})}return s.samples=w,this.remuxAudio(s,c,d,!1)},f}();function t(f,o){var v;if(o===null)return f;for(o<f?v=-8589934592:v=8589934592;Math.abs(f-o)>4294967296;)f+=v;return f}function u(f){for(var o=0;o<f.length;o++)if(f[o].key)return o;return-1}function h(f,o,v,s){var c=f.samples.length;if(c){for(var d=f.inputTimeScale,a=0;a<c;a++){var g=f.samples[a];g.pts=t(g.pts-v,o*d)/d,g.dts=t(g.dts-s,o*d)/d}var T=f.samples;return f.samples=[],{samples:T}}}function i(f,o,v){var s=f.samples.length;if(s){for(var c=f.inputTimeScale,d=0;d<s;d++){var a=f.samples[d];a.pts=t(a.pts-v,o*c)/c}f.samples.sort(function(T,R){return T.pts-R.pts});var g=f.samples;return f.samples=[],{samples:g}}}var e=function(o,v,s,c){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=s,this.cts=c,this.flags=new r(o)},r=function(o){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=o?2:1,this.isNonSync=o?0:1}},"./src/remux/passthrough-remuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>S});var b=L("./src/polyfills/number.ts"),D=L("./src/remux/mp4-remuxer.ts"),P=L("./src/utils/mp4-tools.ts"),I=L("./src/loader/fragment.ts"),M=L("./src/utils/logger.ts"),A=function(){function m(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var E=m.prototype;return E.destroy=function(){},E.resetTimeStamp=function(y){this.initPTS=y,this.lastEndTime=null},E.resetNextTimestamp=function(){this.lastEndTime=null},E.resetInitSegment=function(y,p,l){this.audioCodec=p,this.videoCodec=l,this.generateInitSegment(y),this.emitInitSegment=!0},E.generateInitSegment=function(y){var p=this.audioCodec,l=this.videoCodec;if(!y||!y.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=(0,P.parseInitSegment)(y);p||(p=x(n.audio,I.ElementaryStreamTypes.AUDIO)),l||(l=x(n.video,I.ElementaryStreamTypes.VIDEO));var t={};n.audio&&n.video?t.audiovideo={container:"video/mp4",codec:p+","+l,initSegment:y,id:"main"}:n.audio?t.audio={container:"audio/mp4",codec:p,initSegment:y,id:"audio"}:n.video?t.video={container:"video/mp4",codec:l,initSegment:y,id:"main"}:M.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},E.remux=function(y,p,l,n,t){var u,h=this.initPTS,i=this.lastEndTime,e={audio:void 0,video:void 0,text:n,id3:l,initSegment:void 0};(0,b.isFiniteNumber)(i)||(i=this.lastEndTime=t||0);var r=p.samples;if(!r||!r.length)return e;var f={initPTS:void 0,timescale:1},o=this.initData;if((!o||!o.length)&&(this.generateInitSegment(r),o=this.initData),!o||!o.length)return M.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),e;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);var v=(0,P.getStartDTS)(o,r);(0,b.isFiniteNumber)(h)||(this.initPTS=f.initPTS=h=v-t);var s=(0,P.getDuration)(r,o),c=y?v-h:i,d=c+s;(0,P.offsetStartDTS)(o,r,h),s>0?this.lastEndTime=d:(M.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!o.audio,g=!!o.video,T="";a&&(T+="audio"),g&&(T+="video");var R={data1:r,startPTS:c,startDTS:c,endPTS:d,endDTS:d,type:T,hasAudio:a,hasVideo:g,nb:1,dropped:0};e.audio=R.type==="audio"?R:void 0,e.video=R.type!=="audio"?R:void 0,e.initSegment=f;var C=(u=this.initPTS)!=null?u:0;return e.id3=(0,D.flushTextTrackMetadataCueSamples)(l,t,C,C),n.samples.length&&(e.text=(0,D.flushTextTrackUserdataCueSamples)(n,t,C)),e},m}();function x(m,E){var _=m==null?void 0:m.codec;return _&&_.length>4?_:_==="hvc1"||_==="hev1"?"hvc1.1.c.L120.90":_==="av01"?"av01.0.04M.08":_==="avc1"||E===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const S=A},"./src/task-loop.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});var b=function(){function D(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var P=D.prototype;return P.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},P.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},P.onHandlerDestroyed=function(){},P.hasInterval=function(){return!!this._tickInterval},P.hasNextTick=function(){return!!this._tickTimer},P.setInterval=function(M){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,M),!0)},P.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},P.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},P.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},P.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},P.doTick=function(){},D}()},"./src/types/cmcd.ts":(W,B,L)=>{L.r(B),L.d(B,{CMCDObjectType:()=>D,CMCDStreamType:()=>I,CMCDStreamingFormat:()=>P,CMCDVersion:()=>b});var b=1,D;(function(M){M.MANIFEST="m",M.AUDIO="a",M.VIDEO="v",M.MUXED="av",M.INIT="i",M.CAPTION="c",M.TIMED_TEXT="tt",M.KEY="k",M.OTHER="o"})(D||(D={}));var P;(function(M){M.DASH="d",M.HLS="h",M.SMOOTH="s",M.OTHER="o"})(P||(P={}));var I;(function(M){M.VOD="v",M.LIVE="l"})(I||(I={}))},"./src/types/demuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{MetadataSchema:()=>b});var b;(function(D){D.audioId3="org.id3",D.dateRange="com.apple.quicktime.HLS",D.emsg="https://aomedia.org/emsg/ID3"})(b||(b={}))},"./src/types/level.ts":(W,B,L)=>{L.r(B),L.d(B,{HlsSkip:()=>P,HlsUrlParameters:()=>M,Level:()=>A,getSkipValue:()=>I});function b(x,S){for(var m=0;m<S.length;m++){var E=S[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(x,E.key,E)}}function D(x,S,m){return S&&b(x.prototype,S),m&&b(x,m),Object.defineProperty(x,"prototype",{writable:!1}),x}var P;(function(x){x.No="",x.Yes="YES",x.v2="v2"})(P||(P={}));function I(x,S){var m=x.canSkipUntil,E=x.canSkipDateRanges,_=x.endSN,y=S!==void 0?S-_:0;return m&&y<m?E?P.v2:P.Yes:P.No}var M=function(){function x(m,E,_){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=m,this.part=E,this.skip=_}var S=x.prototype;return S.addDirectives=function(E){var _=new self.URL(E);return this.msn!==void 0&&_.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&_.searchParams.set("_HLS_part",this.part.toString()),this.skip&&_.searchParams.set("_HLS_skip",this.skip),_.toString()},x}(),A=function(){function x(S){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[S.url],this.attrs=S.attrs,this.bitrate=S.bitrate,S.details&&(this.details=S.details),this.id=S.id||0,this.name=S.name,this.width=S.width||0,this.height=S.height||0,this.audioCodec=S.audioCodec,this.videoCodec=S.videoCodec,this.unknownCodecs=S.unknownCodecs,this.codecSet=[S.videoCodec,S.audioCodec].filter(function(m){return m}).join(",").replace(/\.[^.,]+/g,"")}return D(x,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(m){var E=m%this.url.length;this._urlId!==E&&(this.details=void 0,this._urlId=E)}}]),x}()},"./src/types/loader.ts":(W,B,L)=>{L.r(B),L.d(B,{PlaylistContextType:()=>b,PlaylistLevelType:()=>D});var b;(function(P){P.MANIFEST="manifest",P.LEVEL="level",P.AUDIO_TRACK="audioTrack",P.SUBTITLE_TRACK="subtitleTrack"})(b||(b={}));var D;(function(P){P.MAIN="main",P.AUDIO="audio",P.SUBTITLE="subtitle"})(D||(D={}))},"./src/types/transmuxer.ts":(W,B,L)=>{L.r(B),L.d(B,{ChunkMetadata:()=>b});var b=function(I,M,A,x,S,m){x===void 0&&(x=0),S===void 0&&(S=-1),m===void 0&&(m=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=D(),this.buffering={audio:D(),video:D(),audiovideo:D()},this.level=I,this.sn=M,this.id=A,this.size=x,this.part=S,this.partial=m};function D(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(W,B,L)=>{L.r(B),L.d(B,{AttrList:()=>P});var b=/^(\d+)x(\d+)$/,D=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,P=function(){function I(A){typeof A=="string"&&(A=I.parseAttrList(A));for(var x in A)A.hasOwnProperty(x)&&(this[x]=A[x])}var M=I.prototype;return M.decimalInteger=function(x){var S=parseInt(this[x],10);return S>Number.MAX_SAFE_INTEGER?1/0:S},M.hexadecimalInteger=function(x){if(this[x]){var S=(this[x]||"0x").slice(2);S=(S.length&1?"0":"")+S;for(var m=new Uint8Array(S.length/2),E=0;E<S.length/2;E++)m[E]=parseInt(S.slice(E*2,E*2+2),16);return m}else return null},M.hexadecimalIntegerAsNumber=function(x){var S=parseInt(this[x],16);return S>Number.MAX_SAFE_INTEGER?1/0:S},M.decimalFloatingPoint=function(x){return parseFloat(this[x])},M.optionalFloat=function(x,S){var m=this[x];return m?parseFloat(m):S},M.enumeratedString=function(x){return this[x]},M.bool=function(x){return this[x]==="YES"},M.decimalResolution=function(x){var S=b.exec(this[x]);if(S!==null)return{width:parseInt(S[1],10),height:parseInt(S[2],10)}},I.parseAttrList=function(x){var S,m={},E='"';for(D.lastIndex=0;(S=D.exec(x))!==null;){var _=S[2];_.indexOf(E)===0&&_.lastIndexOf(E)===_.length-1&&(_=_.slice(1,-1)),m[S[1]]=_}return m},I}()},"./src/utils/binary-search.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>D});var b={search:function(I,M){for(var A=0,x=I.length-1,S=null,m=null;A<=x;){S=(A+x)/2|0,m=I[S];var E=M(m);if(E>0)A=S+1;else if(E<0)x=S-1;else return m}return null}};const D=b},"./src/utils/buffer-helper.ts":(W,B,L)=>{L.r(B),L.d(B,{BufferHelper:()=>P});var b=L("./src/utils/logger.ts"),D={length:0,start:function(){return 0},end:function(){return 0}},P=function(){function I(){}return I.isBuffered=function(A,x){try{if(A){for(var S=I.getBuffered(A),m=0;m<S.length;m++)if(x>=S.start(m)&&x<=S.end(m))return!0}}catch{}return!1},I.bufferInfo=function(A,x,S){try{if(A){var m=I.getBuffered(A),E=[],_;for(_=0;_<m.length;_++)E.push({start:m.start(_),end:m.end(_)});return this.bufferedInfo(E,x,S)}}catch{}return{len:0,start:x,end:x,nextStart:void 0}},I.bufferedInfo=function(A,x,S){x=Math.max(0,x),A.sort(function(e,r){var f=e.start-r.start;return f||r.end-e.end});var m=[];if(S)for(var E=0;E<A.length;E++){var _=m.length;if(_){var y=m[_-1].end;A[E].start-y<S?A[E].end>y&&(m[_-1].end=A[E].end):m.push(A[E])}else m.push(A[E])}else m=A;for(var p=0,l,n=x,t=x,u=0;u<m.length;u++){var h=m[u].start,i=m[u].end;if(x+S>=h&&x<i)n=h,t=i,p=t-x;else if(x+S<h){l=h;break}}return{len:p,start:n||0,end:t||0,nextStart:l}},I.getBuffered=function(A){try{return A.buffered}catch(x){return b.logger.log("failed to get media.buffered",x),D}},I}()},"./src/utils/cea-608-parser.ts":(W,B,L)=>{L.r(B),L.d(B,{CaptionScreen:()=>u,Row:()=>t,default:()=>o});var b=L("./src/utils/logger.ts"),D={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},P=function(s){var c=s;return D.hasOwnProperty(s)&&(c=D[s]),String.fromCharCode(c)},I=15,M=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},x={17:2,18:4,21:6,22:8,23:10,19:13,20:15},S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},E=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],_;(function(v){v[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA"})(_||(_={}));var y=function(){function v(){this.time=null,this.verboseLevel=_.ERROR}var s=v.prototype;return s.log=function(d,a){this.verboseLevel>=d&&b.logger.log(this.time+" ["+d+"] "+a)},v}(),p=function(s){for(var c=[],d=0;d<s.length;d++)c.push(s[d].toString(16));return c},l=function(){function v(c,d,a,g,T){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=c||"white",this.underline=d||!1,this.italics=a||!1,this.background=g||"black",this.flash=T||!1}var s=v.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(d){for(var a=["foreground","underline","italics","background","flash"],g=0;g<a.length;g++){var T=a[g];d.hasOwnProperty(T)&&(this[T]=d[T])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(d){return this.foreground===d.foreground&&this.underline===d.underline&&this.italics===d.italics&&this.background===d.background&&this.flash===d.flash},s.copy=function(d){this.foreground=d.foreground,this.underline=d.underline,this.italics=d.italics,this.background=d.background,this.flash=d.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),n=function(){function v(c,d,a,g,T,R){this.uchar=void 0,this.penState=void 0,this.uchar=c||" ",this.penState=new l(d,a,g,T,R)}var s=v.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(d,a){this.uchar=d,this.penState.copy(a)},s.setPenState=function(d){this.penState.copy(d)},s.equals=function(d){return this.uchar===d.uchar&&this.penState.equals(d.penState)},s.copy=function(d){this.uchar=d.uchar,this.penState.copy(d.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),t=function(){function v(c){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var d=0;d<M;d++)this.chars.push(new n);this.logger=c,this.pos=0,this.currPenState=new l}var s=v.prototype;return s.equals=function(d){for(var a=!0,g=0;g<M;g++)if(!this.chars[g].equals(d.chars[g])){a=!1;break}return a},s.copy=function(d){for(var a=0;a<M;a++)this.chars[a].copy(d.chars[a])},s.isEmpty=function(){for(var d=!0,a=0;a<M;a++)if(!this.chars[a].isEmpty()){d=!1;break}return d},s.setCursor=function(d){this.pos!==d&&(this.pos=d),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>M&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=M)},s.moveCursor=function(d){var a=this.pos+d;if(d>1)for(var g=this.pos+1;g<a+1;g++)this.chars[g].setPenState(this.currPenState);this.setCursor(a)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(d){d>=144&&this.backSpace();var a=P(d);if(this.pos>=M){this.logger.log(_.ERROR,"Cannot insert "+d.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(d){var a;for(a=d;a<M;a++)this.chars[a].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var d=[],a=!0,g=0;g<M;g++){var T=this.chars[g].uchar;T!==" "&&(a=!1),d.push(T)}return a?"":d.join("")},s.setPenStyles=function(d){this.currPenState.setStyles(d);var a=this.chars[this.pos];a.setPenState(this.currPenState)},v}(),u=function(){function v(c){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var d=0;d<I;d++)this.rows.push(new t(c));this.logger=c,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=v.prototype;return s.reset=function(){for(var d=0;d<I;d++)this.rows[d].clear();this.currRow=I-1},s.equals=function(d){for(var a=!0,g=0;g<I;g++)if(!this.rows[g].equals(d.rows[g])){a=!1;break}return a},s.copy=function(d){for(var a=0;a<I;a++)this.rows[a].copy(d.rows[a])},s.isEmpty=function(){for(var d=!0,a=0;a<I;a++)if(!this.rows[a].isEmpty()){d=!1;break}return d},s.backSpace=function(){var d=this.rows[this.currRow];d.backSpace()},s.clearToEndOfRow=function(){var d=this.rows[this.currRow];d.clearToEndOfRow()},s.insertChar=function(d){var a=this.rows[this.currRow];a.insertChar(d)},s.setPen=function(d){var a=this.rows[this.currRow];a.setPenStyles(d)},s.moveCursor=function(d){var a=this.rows[this.currRow];a.moveCursor(d)},s.setCursor=function(d){this.logger.log(_.INFO,"setCursor: "+d);var a=this.rows[this.currRow];a.setCursor(d)},s.setPAC=function(d){this.logger.log(_.INFO,"pacData = "+JSON.stringify(d));var a=d.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var g=0;g<I;g++)this.rows[g].clear();var T=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var C=R.rows[T].cueStartTime,O=this.logger.time;if(C&&O!==null&&C<O)for(var F=0;F<this.nrRollUpRows;F++)this.rows[a-this.nrRollUpRows+F+1].copy(R.rows[T+F])}}this.currRow=a;var U=this.rows[this.currRow];if(d.indent!==null){var k=d.indent,N=Math.max(k-1,0);U.setCursor(d.indent),d.color=U.chars[N].penState.foreground}var w={foreground:d.color,underline:d.underline,italics:d.italics,background:"black",flash:!1};this.setPen(w)},s.setBkgData=function(d){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(d)),this.backSpace(),this.setPen(d),this.insertChar(32)},s.setRollUpRows=function(d){this.nrRollUpRows=d},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(_.TEXT,this.getDisplayText());var d=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(d,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(_.INFO,"Rolling up")},s.getDisplayText=function(d){d=d||!1;for(var a=[],g="",T=-1,R=0;R<I;R++){var C=this.rows[R].getTextString();C&&(T=R+1,d?a.push("Row "+T+": '"+C+"'"):a.push(C.trim()))}return a.length>0&&(d?g="["+a.join(" | ")+"]":g=a.join(`
`)),g},s.getTextAndFormat=function(){return this.rows},v}(),h=function(){function v(c,d,a){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=c,this.outputFilter=d,this.mode=null,this.verbose=0,this.displayedMemory=new u(a),this.nonDisplayedMemory=new u(a),this.lastOutputScreen=new u(a),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=a}var s=v.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(d){this.outputFilter=d},s.setPAC=function(d){this.writeScreen.setPAC(d)},s.setBkgData=function(d){this.writeScreen.setBkgData(d)},s.setMode=function(d){d!==this.mode&&(this.mode=d,this.logger.log(_.INFO,"MODE="+d),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=d)},s.insertChars=function(d){for(var a=0;a<d.length;a++)this.writeScreen.insertChar(d[a]);var g=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,g+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(d){this.logger.log(_.INFO,"RU("+d+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(d)},s.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var d=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=d,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(d){this.logger.log(_.INFO,"TO("+d+") - Tab Offset"),this.writeScreen.moveCursor(d)},s.ccMIDROW=function(d){var a={flash:!1};if(a.underline=d%2===1,a.italics=d>=46,a.italics)a.foreground="white";else{var g=Math.floor(d/2)-16,T=["white","green","blue","cyan","red","yellow","magenta"];a.foreground=T[g]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},s.outputDataUpdate=function(d){d===void 0&&(d=!1);var a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=a:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),d&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(d){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,d,this.displayedMemory),this.cueStartTime=d))},v}(),i=function(){function v(c,d,a){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var g=new y;this.channels=[null,new h(c,d,g),new h(c+1,a,g)],this.cmdHistory=f(),this.logger=g}var s=v.prototype;return s.getHandler=function(d){return this.channels[d].getHandler()},s.setHandler=function(d,a){this.channels[d].setHandler(a)},s.addData=function(d,a){var g,T,R,C=!1;this.logger.time=d;for(var O=0;O<a.length;O+=2)if(T=a[O]&127,R=a[O+1]&127,!(T===0&&R===0)){if(this.logger.log(_.DATA,"["+p([a[O],a[O+1]])+"] -> ("+p([T,R])+")"),g=this.parseCmd(T,R),g||(g=this.parseMidrow(T,R)),g||(g=this.parsePAC(T,R)),g||(g=this.parseBackgroundAttributes(T,R)),!g&&(C=this.parseChars(T,R),C)){var F=this.currentChannel;if(F&&F>0){var U=this.channels[F];U.insertChars(C)}else this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}!g&&!C&&this.logger.log(_.WARNING,"Couldn't parse cleaned data "+p([T,R])+" orig: "+p([a[O],a[O+1]]))}},s.parseCmd=function(d,a){var g=this.cmdHistory,T=(d===20||d===28||d===21||d===29)&&a>=32&&a<=47,R=(d===23||d===31)&&a>=33&&a<=35;if(!(T||R))return!1;if(r(d,a,g))return e(null,null,g),this.logger.log(_.DEBUG,"Repeated command ("+p([d,a])+") is dropped"),!0;var C=d===20||d===21||d===23?1:2,O=this.channels[C];return d===20||d===21||d===28||d===29?a===32?O.ccRCL():a===33?O.ccBS():a===34?O.ccAOF():a===35?O.ccAON():a===36?O.ccDER():a===37?O.ccRU(2):a===38?O.ccRU(3):a===39?O.ccRU(4):a===40?O.ccFON():a===41?O.ccRDC():a===42?O.ccTR():a===43?O.ccRTD():a===44?O.ccEDM():a===45?O.ccCR():a===46?O.ccENM():a===47&&O.ccEOC():O.ccTO(a-32),e(d,a,g),this.currentChannel=C,!0},s.parseMidrow=function(d,a){var g=0;if((d===17||d===25)&&a>=32&&a<=47){if(d===17?g=1:g=2,g!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var T=this.channels[g];return T?(T.ccMIDROW(a),this.logger.log(_.DEBUG,"MIDROW ("+p([d,a])+")"),!0):!1}return!1},s.parsePAC=function(d,a){var g,T=this.cmdHistory,R=(d>=17&&d<=23||d>=25&&d<=31)&&a>=64&&a<=127,C=(d===16||d===24)&&a>=64&&a<=95;if(!(R||C))return!1;if(r(d,a,T))return e(null,null,T),!0;var O=d<=23?1:2;a>=64&&a<=95?g=O===1?A[d]:S[d]:g=O===1?x[d]:m[d];var F=this.channels[O];return F?(F.setPAC(this.interpretPAC(g,a)),e(d,a,T),this.currentChannel=O,!0):!1},s.interpretPAC=function(d,a){var g,T={color:null,italics:!1,indent:null,underline:!1,row:d};return a>95?g=a-96:g=a-64,T.underline=(g&1)===1,g<=13?T.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(g/2)]:g<=15?(T.italics=!0,T.color="white"):T.indent=Math.floor((g-16)/2)*4,T},s.parseChars=function(d,a){var g,T=null,R=null;if(d>=25?(g=2,R=d-8):(g=1,R=d),R>=17&&R<=19){var C;R===17?C=a+80:R===18?C=a+112:C=a+144,this.logger.log(_.INFO,"Special char '"+P(C)+"' in channel "+g),T=[C]}else d>=32&&d<=127&&(T=a===0?[d]:[d,a]);if(T){var O=p(T);this.logger.log(_.DEBUG,"Char codes =  "+O.join(",")),e(d,a,this.cmdHistory)}return T},s.parseBackgroundAttributes=function(d,a){var g=(d===16||d===24)&&a>=32&&a<=47,T=(d===23||d===31)&&a>=45&&a<=47;if(!(g||T))return!1;var R,C={};d===16||d===24?(R=Math.floor((a-32)/2),C.background=E[R],a%2===1&&(C.background=C.background+"_semi")):a===45?C.background="transparent":(C.foreground="black",a===47&&(C.underline=!0));var O=d<=23?1:2,F=this.channels[O];return F.setBkgData(C),e(d,a,this.cmdHistory),!0},s.reset=function(){for(var d=0;d<Object.keys(this.channels).length;d++){var a=this.channels[d];a&&a.reset()}this.cmdHistory=f()},s.cueSplitAtTime=function(d){for(var a=0;a<this.channels.length;a++){var g=this.channels[a];g&&g.cueSplitAtTime(d)}},v}();function e(v,s,c){c.a=v,c.b=s}function r(v,s,c){return c.a===v&&c.b===s}function f(){return{a:null,b:null}}const o=i},"./src/utils/codecs.ts":(W,B,L)=>{L.r(B),L.d(B,{isCodecSupportedInMp4:()=>P,isCodecType:()=>D});var b={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function D(I,M){var A=b[M];return!!A&&A[I.slice(0,4)]===!0}function P(I,M){return MediaSource.isTypeSupported((M||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>A});var b=L("./src/utils/vttparser.ts"),D=L("./src/utils/webvtt-parser.ts"),P=L("./src/utils/texttrack-utils.ts"),I=/\s/,M={newCue:function(S,m,E,_){for(var y=[],p,l,n,t,u,h=self.VTTCue||self.TextTrackCue,i=0;i<_.rows.length;i++)if(p=_.rows[i],n=!0,t=0,u="",!p.isEmpty()){for(var e=0;e<p.chars.length;e++)I.test(p.chars[e].uchar)&&n?t++:(u+=p.chars[e].uchar,n=!1);p.cueStartTime=m,m===E&&(E+=1e-4),t>=16?t--:t++;var r=(0,b.fixLineBreaks)(u.trim()),f=(0,D.generateCueId)(m,E,r);(!S||!S.cues||!S.cues.getCueById(f))&&(l=new h(m,E,r),l.id=f,l.line=i+1,l.align="left",l.position=10+Math.min(80,Math.floor(t*8/32)*10),y.push(l))}return S&&y.length&&(y.sort(function(o,v){return o.line==="auto"||v.line==="auto"?0:o.line>8&&v.line>8?v.line-o.line:o.line-v.line}),y.forEach(function(o){return(0,P.addCueToTrack)(S,o)})),y}};const A=M},"./src/utils/discontinuities.ts":(W,B,L)=>{L.r(B),L.d(B,{adjustSlidingStart:()=>S,alignMediaPlaylistByPDT:()=>y,alignPDT:()=>_,alignStream:()=>m,findDiscontinuousReferenceFrag:()=>A,findFirstFragWithCC:()=>I,shouldAlignOnDiscontinuities:()=>M});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/logger.ts"),P=L("./src/controller/level-helper.ts");function I(p,l){for(var n=null,t=0,u=p.length;t<u;t++){var h=p[t];if(h&&h.cc===l){n=h;break}}return n}function M(p,l,n){return!!(l.details&&(n.endCC>n.startCC||p&&p.cc<n.startCC))}function A(p,l,n){var t=p.fragments,u=l.fragments;if(!u.length||!t.length){D.logger.log("No fragments to align");return}var h=I(t,u[0].cc);if(!h||h&&!h.startPTS){D.logger.log("No frag in previous level to align on");return}return h}function x(p,l){if(p){var n=p.start+l;p.start=p.startPTS=n,p.endPTS=n+p.duration}}function S(p,l){for(var n=l.fragments,t=0,u=n.length;t<u;t++)x(n[t],p);l.fragmentHint&&x(l.fragmentHint,p),l.alignedSliding=!0}function m(p,l,n){l&&(E(p,n,l),!n.alignedSliding&&l.details&&_(n,l.details),!n.alignedSliding&&l.details&&!n.skippedSegments&&(0,P.adjustSliding)(l.details,n))}function E(p,l,n){if(M(p,n,l)){var t=A(n.details,l);t&&(0,b.isFiniteNumber)(t.start)&&(D.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),S(t.start,l))}}function _(p,l){if(!(!l.fragments.length||!p.hasProgramDateTime||!l.hasProgramDateTime)){var n=l.fragments[0].programDateTime,t=p.fragments[0].programDateTime,u=(t-n)/1e3+l.fragments[0].start;u&&(0,b.isFiniteNumber)(u)&&(D.logger.log("Adjusting PTS using programDateTime delta "+(t-n)+"ms, sliding:"+u.toFixed(3)+" "+p.url+" "),S(u,p))}}function y(p,l){if(!(!p.hasProgramDateTime||!l.hasProgramDateTime)){var n=p.fragments,t=l.fragments;if(!(!n.length||!t.length)){var u=Math.round(t.length/2)-1,h=t[u],i=I(n,h.cc)||n[Math.round(n.length/2)-1],e=h.programDateTime,r=i.programDateTime;if(!(e===null||r===null)){var f=(r-e)/1e3-(i.start-h.start);S(f,p)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>P});var b=L("./src/utils/ewma.ts"),D=function(){function I(A,x,S){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=S,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new b.default(A),this.fast_=new b.default(x)}var M=I.prototype;return M.update=function(x,S){var m=this.slow_,E=this.fast_;this.slow_.halfLife!==x&&(this.slow_=new b.default(x,m.getEstimate(),m.getTotalWeight())),this.fast_.halfLife!==S&&(this.fast_=new b.default(S,E.getEstimate(),E.getTotalWeight()))},M.sample=function(x,S){x=Math.max(x,this.minDelayMs_);var m=8*S,E=x/1e3,_=m/E;this.fast_.sample(E,_),this.slow_.sample(E,_)},M.canEstimate=function(){var x=this.fast_;return x&&x.getTotalWeight()>=this.minWeight_},M.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},M.destroy=function(){},I}();const P=D},"./src/utils/ewma.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>D});var b=function(){function P(M,A,x){A===void 0&&(A=0),x===void 0&&(x=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=M,this.alpha_=M?Math.exp(Math.log(.5)/M):0,this.estimate_=A,this.totalWeight_=x}var I=P.prototype;return I.sample=function(A,x){var S=Math.pow(this.alpha_,A);this.estimate_=x*(1-S)+S*this.estimate_,this.totalWeight_+=A},I.getTotalWeight=function(){return this.totalWeight_},I.getEstimate=function(){if(this.alpha_){var A=1-Math.pow(this.alpha_,this.totalWeight_);if(A)return this.estimate_/A}return this.estimate_},P}();const D=b},"./src/utils/fetch-loader.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>u,fetchSupported:()=>y});var b=L("./src/polyfills/number.ts"),D=L("./src/loader/load-stats.ts"),P=L("./src/demux/chunk-cache.ts");function I(h,i){h.prototype=Object.create(i.prototype),h.prototype.constructor=h,m(h,i)}function M(h){var i=typeof Map=="function"?new Map:void 0;return M=function(r){if(r===null||!S(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i<"u"){if(i.has(r))return i.get(r);i.set(r,f)}function f(){return A(r,arguments,E(this).constructor)}return f.prototype=Object.create(r.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),m(f,r)},M(h)}function A(h,i,e){return x()?A=Reflect.construct.bind():A=function(f,o,v){var s=[null];s.push.apply(s,o);var c=Function.bind.apply(f,s),d=new c;return v&&m(d,v.prototype),d},A.apply(null,arguments)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(h){return Function.toString.call(h).indexOf("[native code]")!==-1}function m(h,i){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,f){return r.__proto__=f,r},m(h,i)}function E(h){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(h)}function _(){return _=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(h[r]=e[r])}return h},_.apply(this,arguments)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var p=function(){function h(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||n,this.controller=new self.AbortController,this.stats=new D.LoadStats}var i=h.prototype;return i.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},i.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},i.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},i.load=function(r,f,o){var v=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var c=l(r,this.controller.signal),d=o.onProgress,a=r.responseType==="arraybuffer",g=a?"byteLength":"length";this.context=r,this.config=f,this.callbacks=o,this.request=this.fetchSetup(r,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){v.abortInternal(),o.onTimeout(s,r,v.response)},f.timeout),self.fetch(this.request).then(function(T){if(v.response=v.loader=T,!T.ok){var R=T.status,C=T.statusText;throw new t(C||"fetch, bad network response",R,T)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(T.headers.get("Content-Length")||"0"),d&&(0,b.isFiniteNumber)(f.highWaterMark)?v.loadProgressively(T,s,r,f.highWaterMark,d):a?T.arrayBuffer():T.text()}).then(function(T){var R=v.response;self.clearTimeout(v.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var C=T[g];C&&(s.loaded=s.total=C);var O={url:R.url,data:T};d&&!(0,b.isFiniteNumber)(f.highWaterMark)&&d(s,r,T,R),o.onSuccess(O,s,r,R)}).catch(function(T){if(self.clearTimeout(v.requestTimeout),!s.aborted){var R=T&&T.code||0,C=T?T.message:null;o.onError({code:R,text:C},r,T?T.details:null)}})},i.getCacheAge=function(){var r=null;if(this.response){var f=this.response.headers.get("age");r=f?parseFloat(f):null}return r},i.loadProgressively=function(r,f,o,v,s){v===void 0&&(v=0);var c=new P.default,d=r.body.getReader(),a=function g(){return d.read().then(function(T){if(T.done)return c.dataLength&&s(f,o,c.flush(),r),Promise.resolve(new ArrayBuffer(0));var R=T.value,C=R.length;return f.loaded+=C,C<v||c.dataLength?(c.push(R),c.dataLength>=v&&s(f,o,c.flush(),r)):s(f,o,R,r),g()}).catch(function(){return Promise.reject()})};return a()},h}();function l(h,i){var e={method:"GET",mode:"cors",credentials:"same-origin",signal:i,headers:new self.Headers(_({},h.headers))};return h.rangeEnd&&e.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),e}function n(h,i){return new self.Request(h.url,i)}var t=function(h){I(i,h);function i(e,r,f){var o;return o=h.call(this,e)||this,o.code=void 0,o.details=void 0,o.code=r,o.details=f,o}return i}(M(Error));const u=p},"./src/utils/imsc1-ttml-parser.ts":(W,B,L)=>{L.r(B),L.d(B,{IMSC1_CODEC:()=>S,parseIMSC1:()=>y});var b=L("./src/utils/mp4-tools.ts"),D=L("./src/utils/vttparser.ts"),P=L("./src/utils/vttcue.ts"),I=L("./src/demux/id3.ts"),M=L("./src/utils/timescale-conversion.ts"),A=L("./src/utils/webvtt-parser.ts");function x(){return x=Object.assign?Object.assign.bind():function(o){for(var v=1;v<arguments.length;v++){var s=arguments[v];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(o[c]=s[c])}return o},x.apply(this,arguments)}var S="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,E=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(o,v,s,c,d){var a=(0,b.findBox)(new Uint8Array(o),["mdat"]);if(a.length===0){d(new Error("Could not parse IMSC1 mdat"));return}var g=a.map(function(R){return(0,I.utf8ArrayToStr)(R)}),T=(0,M.toTimescaleFromScale)(v,1,s);try{g.forEach(function(R){return c(p(R,T))})}catch(R){d(R)}}function p(o,v){var s=new DOMParser,c=s.parseFromString(o,"text/xml"),d=c.getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(a).reduce(function(F,U){return F[U]=d.getAttribute("ttp:"+U)||a[U],F},{}),T=d.getAttribute("xml:space")!=="preserve",R=n(l(d,"styling","style")),C=n(l(d,"layout","region")),O=l(d,"body","[begin]");return[].map.call(O,function(F){var U=t(F,T);if(!U||!F.hasAttribute("begin"))return null;var k=e(F.getAttribute("begin"),g),N=e(F.getAttribute("dur"),g),w=e(F.getAttribute("end"),g);if(k===null)throw i(F);if(w===null){if(N===null)throw i(F);w=k+N}var K=new P.default(k-v,w-v,U);K.id=(0,A.generateCueId)(K.startTime,K.endTime,K.text);var G=C[F.getAttribute("region")],H=R[F.getAttribute("style")];K.position=10,K.size=80;var V=u(G,H,R),X=V.textAlign;if(X){var Y=_[X];Y&&(K.lineAlign=Y),K.align=X}return x(K,V),K}).filter(function(F){return F!==null})}function l(o,v,s){var c=o.getElementsByTagName(v)[0];return c?[].slice.call(c.querySelectorAll(s)):[]}function n(o){return o.reduce(function(v,s){var c=s.getAttribute("xml:id");return c&&(v[c]=s),v},{})}function t(o,v){return[].slice.call(o.childNodes).reduce(function(s,c,d){var a;return c.nodeName==="br"&&d?s+`
`:(a=c.childNodes)!==null&&a!==void 0&&a.length?t(c,v):v?s+c.textContent.trim().replace(/\s+/g," "):s+c.textContent},"")}function u(o,v,s){var c="http://www.w3.org/ns/ttml#styling",d=null,a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],g=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return g&&s.hasOwnProperty(g)&&(d=s[g]),a.reduce(function(T,R){var C=h(v,c,R)||h(o,c,R)||h(d,c,R);return C&&(T[R]=C),T},{})}function h(o,v,s){return o&&o.hasAttributeNS(v,s)?o.getAttributeNS(v,s):null}function i(o){return new Error("Could not parse ttml timestamp "+o)}function e(o,v){if(!o)return null;var s=(0,D.parseTimeStamp)(o);return s===null&&(m.test(o)?s=r(o,v):E.test(o)&&(s=f(o,v))),s}function r(o,v){var s=m.exec(o),c=(s[4]|0)+(s[5]|0)/v.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+c/v.frameRate}function f(o,v){var s=E.exec(o),c=Number(s[1]),d=s[2];switch(d){case"h":return c*3600;case"m":return c*60;case"ms":return c*1e3;case"f":return c/v.frameRate;case"t":return c/v.tickRate}return c}},"./src/utils/logger.ts":(W,B,L)=>{L.r(B),L.d(B,{enableLogs:()=>A,logger:()=>x});var b=function(){},D={trace:b,debug:b,log:b,warn:b,info:b,error:b},P=D;function I(S){var m=self.console[S];return m?m.bind(self.console,"["+S+"] >"):b}function M(S){for(var m=arguments.length,E=new Array(m>1?m-1:0),_=1;_<m;_++)E[_-1]=arguments[_];E.forEach(function(y){P[y]=S[y]?S[y].bind(S):I(y)})}function A(S,m){if(self.console&&S===!0||typeof S=="object"){M(S,"debug","log","info","warn","error");try{P.log('Debug logs enabled for "'+m+'"')}catch{P=D}}else P=D}var x=P},"./src/utils/mediakeys-helper.ts":(W,B,L)=>{L.r(B),L.d(B,{KeySystems:()=>b,requestMediaKeySystemAccess:()=>D});var b;(function(P){P.WIDEVINE="com.widevine.alpha",P.PLAYREADY="com.microsoft.playready"})(b||(b={}));var D=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":(W,B,L)=>{L.r(B),L.d(B,{getMediaSource:()=>b});function b(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(W,B,L)=>{L.r(B),L.d(B,{RemuxerTrackIdConfig:()=>A,appendUint8Array:()=>e,bin2str:()=>x,computeRawDurationFromSamples:()=>u,discardEPB:()=>s,findBox:()=>y,getDuration:()=>t,getStartDTS:()=>n,offsetStartDTS:()=>h,parseEmsg:()=>c,parseInitSegment:()=>l,parseSEIMessageFromNALu:()=>v,parseSamples:()=>r,parseSegmentIndex:()=>p,readSint32:()=>E,readUint16:()=>S,readUint32:()=>m,segmentValidRange:()=>i,writeUint32:()=>_});var b=L("./src/utils/typed-array.ts"),D=L("./src/loader/fragment.ts"),P=L("./src/demux/id3.ts"),I=Math.pow(2,32)-1,M=[].push,A={video:1,audio:2,id3:3,text:4};function x(d){return String.fromCharCode.apply(null,d)}function S(d,a){var g=d[a]<<8|d[a+1];return g<0?65536+g:g}function m(d,a){var g=E(d,a);return g<0?4294967296+g:g}function E(d,a){return d[a]<<24|d[a+1]<<16|d[a+2]<<8|d[a+3]}function _(d,a,g){d[a]=g>>24,d[a+1]=g>>16&255,d[a+2]=g>>8&255,d[a+3]=g&255}function y(d,a){var g=[];if(!a.length)return g;for(var T=d.byteLength,R=0;R<T;){var C=m(d,R),O=x(d.subarray(R+4,R+8)),F=C>1?R+C:T;if(O===a[0])if(a.length===1)g.push(d.subarray(R+8,F));else{var U=y(d.subarray(R+8,F),a.slice(1));U.length&&M.apply(g,U)}R=F}return g}function p(d){var a=[],g=d[0],T=8,R=m(d,T);T+=4;var C=0,O=0;g===0?T+=8:T+=16,T+=2;var F=d.length+O,U=S(d,T);T+=2;for(var k=0;k<U;k++){var N=T,w=m(d,N);N+=4;var K=w&2147483647,G=(w&2147483648)>>>31;if(G===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=m(d,N);N+=4,a.push({referenceSize:K,subsegmentDuration:H,info:{duration:H/R,start:F,end:F+K-1}}),F+=K,N+=4,T=N}return{earliestPresentationTime:C,timescale:R,version:g,referencesCount:U,references:a}}function l(d){for(var a=[],g=y(d,["moov","trak"]),T=0;T<g.length;T++){var R=g[T],C=y(R,["tkhd"])[0];if(C){var O=C[0],F=O===0?12:20,U=m(C,F),k=y(R,["mdia","mdhd"])[0];if(k){O=k[0],F=O===0?12:20;var N=m(k,F),w=y(R,["mdia","hdlr"])[0];if(w){var K=x(w.subarray(8,12)),G={soun:D.ElementaryStreamTypes.AUDIO,vide:D.ElementaryStreamTypes.VIDEO}[K];if(G){var H=y(R,["mdia","minf","stbl","stsd"])[0],V=void 0;H&&(V=x(H.subarray(12,16))),a[U]={timescale:N,type:G},a[G]={timescale:N,id:U,codec:V}}}}}}var X=y(d,["moov","mvex","trex"]);return X.forEach(function(Y){var Q=m(Y,4),$=a[Q];$&&($.default={duration:m(Y,12),flags:m(Y,20)})}),a}function n(d,a){return y(a,["moof","traf"]).reduce(function(g,T){var R=y(T,["tfdt"])[0],C=R[0],O=y(T,["tfhd"]).reduce(function(F,U){var k=m(U,4),N=d[k];if(N){var w=m(R,4);C===1&&(w*=Math.pow(2,32),w+=m(R,8));var K=N.timescale||9e4,G=w/K;if(isFinite(G)&&(F===null||G<F))return G}return F},null);return O!==null&&isFinite(O)&&(g===null||O<g)?O:g},null)||0}function t(d,a){for(var g=0,T=0,R=0,C=y(d,["moof","traf"]),O=0;O<C.length;O++){var F=C[O],U=y(F,["tfhd"])[0],k=m(U,4),N=a[k];if(N){var w=N.default,K=m(U,0)|(w==null?void 0:w.flags),G=w==null?void 0:w.duration;K&8&&(K&2?G=m(U,12):G=m(U,8));for(var H=N.timescale||9e4,V=y(F,["trun"]),X=0;X<V.length;X++){if(g=u(V[X]),!g&&G){var Y=m(V[X],4);g=G*Y}N.type===D.ElementaryStreamTypes.VIDEO?T+=g/H:N.type===D.ElementaryStreamTypes.AUDIO&&(R+=g/H)}}}if(T===0&&R===0){for(var Q=0,$=y(d,["sidx"]),j=0;j<$.length;j++){var z=p($[j]);z!=null&&z.references&&(Q+=z.references.reduce(function(J,Z){return J+Z.info.duration||0},0))}return Q}return T||R}function u(d){var a=m(d,0),g=8;a&1&&(g+=4),a&4&&(g+=4);for(var T=0,R=m(d,4),C=0;C<R;C++){if(a&256){var O=m(d,g);T+=O,g+=4}a&512&&(g+=4),a&1024&&(g+=4),a&2048&&(g+=4)}return T}function h(d,a,g){y(a,["moof","traf"]).forEach(function(T){y(T,["tfhd"]).forEach(function(R){var C=m(R,4),O=d[C];if(O){var F=O.timescale||9e4;y(T,["tfdt"]).forEach(function(U){var k=U[0],N=m(U,4);if(k===0)N-=g*F,N=Math.max(N,0),_(U,4,N);else{N*=Math.pow(2,32),N+=m(U,8),N-=g*F,N=Math.max(N,0);var w=Math.floor(N/(I+1)),K=Math.floor(N%(I+1));_(U,4,w),_(U,8,K)}})}})})}function i(d){var a={valid:null,remainder:null},g=y(d,["moof"]);if(g){if(g.length<2)return a.remainder=d,a}else return a;var T=g[g.length-1];return a.valid=(0,b.sliceUint8)(d,0,T.byteOffset-8),a.remainder=(0,b.sliceUint8)(d,T.byteOffset-8),a}function e(d,a){var g=new Uint8Array(d.length+a.length);return g.set(d),g.set(a,d.length),g}function r(d,a){var g=[],T=a.samples,R=a.timescale,C=a.id,O=!1,F=y(T,["moof"]);return F.map(function(U){var k=U.byteOffset-8,N=y(U,["traf"]);N.map(function(w){var K=y(w,["tfdt"]).map(function(G){var H=G[0],V=m(G,4);return H===1&&(V*=Math.pow(2,32),V+=m(G,8)),V/R})[0];return K!==void 0&&(d=K),y(w,["tfhd"]).map(function(G){var H=m(G,4),V=m(G,0)&16777215,X=(V&1)!==0,Y=(V&2)!==0,Q=(V&8)!==0,$=0,j=(V&16)!==0,z=0,J=(V&32)!==0,Z=8;H===C&&(X&&(Z+=8),Y&&(Z+=4),Q&&($=m(G,Z),Z+=4),j&&(z=m(G,Z),Z+=4),J&&(Z+=4),a.type==="video"&&(O=f(a.codec)),y(w,["trun"]).map(function(q){var ae=q[0],ee=m(q,0)&16777215,fe=(ee&1)!==0,se=0,ne=(ee&4)!==0,ue=(ee&256)!==0,he=0,me=(ee&512)!==0,ce=0,de=(ee&1024)!==0,pe=(ee&2048)!==0,ve=0,Se=m(q,4),re=8;fe&&(se=m(q,re),re+=4),ne&&(re+=4);for(var oe=se+k,Ee=0;Ee<Se;Ee++){if(ue?(he=m(q,re),re+=4):he=$,me?(ce=m(q,re),re+=4):ce=z,de&&(re+=4),pe&&(ae===0?ve=m(q,re):ve=E(q,re),re+=4),a.type===D.ElementaryStreamTypes.VIDEO)for(var te=0;te<ce;){var le=m(T,oe);if(oe+=4,o(O,T[oe])){var ge=T.subarray(oe,oe+le);v(ge,O?2:1,d+ve/R,g)}oe+=le,te+=le+4}d+=he/R}}))})})}),g}function f(d){if(!d)return!1;var a=d.indexOf("."),g=a<0?d:d.substring(0,a);return g==="hvc1"||g==="hev1"||g==="dvh1"||g==="dvhe"}function o(d,a){if(d){var g=a>>1&63;return g===39||g===40}else{var T=a&31;return T===6}}function v(d,a,g,T){var R=s(d),C=0;C+=a;for(var O=0,F=0,U=!1,k=0;C<R.length;){O=0;do{if(C>=R.length)break;k=R[C++],O+=k}while(k===255);F=0;do{if(C>=R.length)break;k=R[C++],F+=k}while(k===255);var N=R.length-C;if(!U&&O===4&&C<R.length){U=!0;var w=R[C++];if(w===181){var K=S(R,C);if(C+=2,K===49){var G=m(R,C);if(C+=4,G===1195456820){var H=R[C++];if(H===3){var V=R[C++],X=31&V,Y=64&V,Q=Y?2+X*3:0,$=new Uint8Array(Q);if(Y){$[0]=V;for(var j=1;j<Q;j++)$[j]=R[C++]}T.push({type:H,payloadType:O,pts:g,bytes:$})}}}}}else if(O===5&&F<N){if(U=!0,F>16){for(var z=[],J=0;J<16;J++){var Z=R[C++].toString(16);z.push(Z.length==1?"0"+Z:Z),(J===3||J===5||J===7||J===9)&&z.push("-")}for(var q=F-16,ae=new Uint8Array(q),ee=0;ee<q;ee++)ae[ee]=R[C++];T.push({payloadType:O,pts:g,uuid:z.join(""),userData:(0,P.utf8ArrayToStr)(ae),userDataBytes:ae})}}else if(F<N)C+=F;else if(F>N)break}}function s(d){for(var a=d.byteLength,g=[],T=1;T<a-2;)d[T]===0&&d[T+1]===0&&d[T+2]===3?(g.push(T+2),T+=2):T++;if(g.length===0)return d;var R=a-g.length,C=new Uint8Array(R),O=0;for(T=0;T<R;O++,T++)O===g[0]&&(O++,g.shift()),C[T]=d[O];return C}function c(d){var a=d[0],g="",T="",R=0,C=0,O=0,F=0,U=0,k=0;if(a===0){for(;x(d.subarray(k,k+1))!=="\0";)g+=x(d.subarray(k,k+1)),k+=1;for(g+=x(d.subarray(k,k+1)),k+=1;x(d.subarray(k,k+1))!=="\0";)T+=x(d.subarray(k,k+1)),k+=1;T+=x(d.subarray(k,k+1)),k+=1,R=m(d,12),C=m(d,16),F=m(d,20),U=m(d,24),k=28}else if(a===1){k+=4,R=m(d,k),k+=4;var N=m(d,k);k+=4;var w=m(d,k);for(k+=4,O=Math.pow(2,32)*N+w,Number.isSafeInteger(O)||(O=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),F=m(d,k),k+=4,U=m(d,k),k+=4;x(d.subarray(k,k+1))!=="\0";)g+=x(d.subarray(k,k+1)),k+=1;for(g+=x(d.subarray(k,k+1)),k+=1;x(d.subarray(k,k+1))!=="\0";)T+=x(d.subarray(k,k+1)),k+=1;T+=x(d.subarray(k,k+1)),k+=1}var K=d.subarray(k,d.byteLength);return{schemeIdUri:g,value:T,timeScale:R,presentationTime:O,presentationTimeDelta:C,eventDuration:F,id:U,payload:K}}},"./src/utils/output-filter.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});var b=function(){function D(I,M){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=M}var P=D.prototype;return P.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},P.newCue=function(M,A,x){(this.startTime===null||this.startTime>M)&&(this.startTime=M),this.endTime=A,this.screen=x,this.timelineController.createCaptionsTrack(this.trackName)},P.reset=function(){this.cueRanges=[],this.startTime=null},D}()},"./src/utils/texttrack-utils.ts":(W,B,L)=>{L.r(B),L.d(B,{addCueToTrack:()=>P,clearCurrentCues:()=>I,getCuesInRange:()=>x,removeCuesInRange:()=>M,sendAddTrackEvent:()=>D});var b=L("./src/utils/logger.ts");function D(S,m){var E;try{E=new Event("addtrack")}catch{E=document.createEvent("Event"),E.initEvent("addtrack",!1,!1)}E.track=S,m.dispatchEvent(E)}function P(S,m){var E=S.mode;if(E==="disabled"&&(S.mode="hidden"),S.cues&&!S.cues.getCueById(m.id))try{if(S.addCue(m),!S.cues.getCueById(m.id))throw new Error("addCue is failed for: "+m)}catch(y){b.logger.debug("[texttrack-utils]: "+y);var _=new self.TextTrackCue(m.startTime,m.endTime,m.text);_.id=m.id,S.addCue(_)}E==="disabled"&&(S.mode=E)}function I(S){var m=S.mode;if(m==="disabled"&&(S.mode="hidden"),S.cues)for(var E=S.cues.length;E--;)S.removeCue(S.cues[E]);m==="disabled"&&(S.mode=m)}function M(S,m,E,_){var y=S.mode;if(y==="disabled"&&(S.mode="hidden"),S.cues&&S.cues.length>0)for(var p=x(S.cues,m,E),l=0;l<p.length;l++)(!_||_(p[l]))&&S.removeCue(p[l]);y==="disabled"&&(S.mode=y)}function A(S,m){if(m<S[0].startTime)return 0;var E=S.length-1;if(m>S[E].endTime)return-1;for(var _=0,y=E;_<=y;){var p=Math.floor((y+_)/2);if(m<S[p].startTime)y=p-1;else if(m>S[p].startTime&&_<E)_=p+1;else return p}return S[_].startTime-m<m-S[y].startTime?_:y}function x(S,m,E){var _=[],y=A(S,m);if(y>-1)for(var p=y,l=S.length;p<l;p++){var n=S[p];if(n.startTime>=m&&n.endTime<=E)_.push(n);else if(n.startTime>E)return _}return _}},"./src/utils/time-ranges.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>D});var b={toString:function(I){for(var M="",A=I.length,x=0;x<A;x++)M+="["+I.start(x).toFixed(3)+","+I.end(x).toFixed(3)+"]";return M}};const D=b},"./src/utils/timescale-conversion.ts":(W,B,L)=>{L.r(B),L.d(B,{toMpegTsClockFromTimescale:()=>M,toMsFromMpegTsClock:()=>I,toTimescaleFromBase:()=>D,toTimescaleFromScale:()=>P});var b=9e4;function D(A,x,S,m){S===void 0&&(S=1),m===void 0&&(m=!1);var E=A*x*S;return m?Math.round(E):E}function P(A,x,S,m){return S===void 0&&(S=1),m===void 0&&(m=!1),D(A,x,1/S,m)}function I(A,x){return x===void 0&&(x=!1),D(A,1e3,1/b,x)}function M(A,x){return x===void 0&&(x=1),D(A,b,1/x)}},"./src/utils/typed-array.ts":(W,B,L)=>{L.r(B),L.d(B,{sliceUint8:()=>b});function b(D,P,I){return Uint8Array.prototype.slice?D.slice(P,I):new Uint8Array(Array.prototype.slice.call(D,P,I))}},"./src/utils/vttcue.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>b});const b=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],P=["start","middle","end","left","right"];function I(m,E){if(typeof E!="string"||!Array.isArray(m))return!1;var _=E.toLowerCase();return~m.indexOf(_)?_:!1}function M(m){return I(D,m)}function A(m){return I(P,m)}function x(m){for(var E=arguments.length,_=new Array(E>1?E-1:0),y=1;y<E;y++)_[y-1]=arguments[y];for(var p=1;p<arguments.length;p++){var l=arguments[p];for(var n in l)m[n]=l[n]}return m}function S(m,E,_){var y=this,p={enumerable:!0};y.hasBeenReset=!1;var l="",n=!1,t=m,u=E,h=_,i=null,e="",r=!0,f="auto",o="start",v=50,s="middle",c=50,d="middle";Object.defineProperty(y,"id",x({},p,{get:function(){return l},set:function(g){l=""+g}})),Object.defineProperty(y,"pauseOnExit",x({},p,{get:function(){return n},set:function(g){n=!!g}})),Object.defineProperty(y,"startTime",x({},p,{get:function(){return t},set:function(g){if(typeof g!="number")throw new TypeError("Start time must be set to a number.");t=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",x({},p,{get:function(){return u},set:function(g){if(typeof g!="number")throw new TypeError("End time must be set to a number.");u=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",x({},p,{get:function(){return h},set:function(g){h=""+g,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",x({},p,{get:function(){return i},set:function(g){i=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",x({},p,{get:function(){return e},set:function(g){var T=M(g);if(T===!1)throw new SyntaxError("An invalid or illegal string was specified.");e=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",x({},p,{get:function(){return r},set:function(g){r=!!g,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",x({},p,{get:function(){return f},set:function(g){if(typeof g!="number"&&g!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");f=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",x({},p,{get:function(){return o},set:function(g){var T=A(g);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");o=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",x({},p,{get:function(){return v},set:function(g){if(g<0||g>100)throw new Error("Position must be between 0 and 100.");v=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",x({},p,{get:function(){return s},set:function(g){var T=A(g);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");s=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",x({},p,{get:function(){return c},set:function(g){if(g<0||g>100)throw new Error("Size must be between 0 and 100.");c=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",x({},p,{get:function(){return d},set:function(g){var T=A(g);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");d=T,this.hasBeenReset=!0}})),y.displayState=void 0}return S.prototype.getCueAsHTML=function(){var m=self.WebVTT;return m.convertCueToDOMTree(self,this.text)},S}()},"./src/utils/vttparser.ts":(W,B,L)=>{L.r(B),L.d(B,{VTTParser:()=>E,fixLineBreaks:()=>m,parseTimeStamp:()=>P});var b=L("./src/utils/vttcue.ts"),D=function(){function _(){}var y=_.prototype;return y.decode=function(l,n){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},_}();function P(_){function y(l,n,t,u){return(l|0)*3600+(n|0)*60+(t|0)+parseFloat(u||0)}var p=_.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return p?parseFloat(p[2])>59?y(p[2],p[3],0,p[4]):y(p[1],p[2],p[3],p[4]):null}var I=function(){function _(){this.values=Object.create(null)}var y=_.prototype;return y.set=function(l,n){!this.get(l)&&n!==""&&(this.values[l]=n)},y.get=function(l,n,t){return t?this.has(l)?this.values[l]:n[t]:this.has(l)?this.values[l]:n},y.has=function(l){return l in this.values},y.alt=function(l,n,t){for(var u=0;u<t.length;++u)if(n===t[u]){this.set(l,n);break}},y.integer=function(l,n){/^-?\d+$/.test(n)&&this.set(l,parseInt(n,10))},y.percent=function(l,n){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(n)){var t=parseFloat(n);if(t>=0&&t<=100)return this.set(l,t),!0}return!1},_}();function M(_,y,p,l){var n=l?_.split(l):[_];for(var t in n)if(typeof n[t]=="string"){var u=n[t].split(p);if(u.length===2){var h=u[0],i=u[1];y(h,i)}}}var A=new b.default(0,0,""),x=A.align==="middle"?"middle":"center";function S(_,y,p){var l=_;function n(){var h=P(_);if(h===null)throw new Error("Malformed timestamp: "+l);return _=_.replace(/^[^\sa-zA-Z-]+/,""),h}function t(h,i){var e=new I;M(h,function(o,v){var s;switch(o){case"region":for(var c=p.length-1;c>=0;c--)if(p[c].id===v){e.set(o,p[c].region);break}break;case"vertical":e.alt(o,v,["rl","lr"]);break;case"line":s=v.split(","),e.integer(o,s[0]),e.percent(o,s[0])&&e.set("snapToLines",!1),e.alt(o,s[0],["auto"]),s.length===2&&e.alt("lineAlign",s[1],["start",x,"end"]);break;case"position":s=v.split(","),e.percent(o,s[0]),s.length===2&&e.alt("positionAlign",s[1],["start",x,"end","line-left","line-right","auto"]);break;case"size":e.percent(o,v);break;case"align":e.alt(o,v,["start",x,"end","left","right"]);break}},/:/,/\s/),i.region=e.get("region",null),i.vertical=e.get("vertical","");var r=e.get("line","auto");r==="auto"&&A.line===-1&&(r=-1),i.line=r,i.lineAlign=e.get("lineAlign","start"),i.snapToLines=e.get("snapToLines",!0),i.size=e.get("size",100),i.align=e.get("align",x);var f=e.get("position","auto");f==="auto"&&A.position===50&&(f=i.align==="start"||i.align==="left"?0:i.align==="end"||i.align==="right"?100:50),i.position=f}function u(){_=_.replace(/^\s+/,"")}if(u(),y.startTime=n(),u(),_.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);_=_.slice(3),u(),y.endTime=n(),u(),t(_,y)}function m(_){return _.replace(/<br(?: \/)?>/gi,`
`)}var E=function(){function _(){this.state="INITIAL",this.buffer="",this.decoder=new D,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=_.prototype;return y.parse=function(l){var n=this;l&&(n.buffer+=n.decoder.decode(l,{stream:!0}));function t(){var f=n.buffer,o=0;for(f=m(f);o<f.length&&f[o]!=="\r"&&f[o]!==`
`;)++o;var v=f.slice(0,o);return f[o]==="\r"&&++o,f[o]===`
`&&++o,n.buffer=f.slice(o),v}function u(f){M(f,function(o,v){},/:/)}try{var h="";if(n.state==="INITIAL"){if(!/\r\n|\n/.test(n.buffer))return this;h=t();var i=h.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var e=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(e?e=!1:h=t(),n.state){case"HEADER":/:/.test(h)?u(h):h||(n.state="ID");continue;case"NOTE":h||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){n.state="NOTE";break}if(!h)continue;if(n.cue=new b.default(0,0,""),n.state="CUE",h.indexOf("-->")===-1){n.cue.id=h;continue}case"CUE":if(!n.cue){n.state="BADCUE";continue}try{S(h,n.cue,n.regionList)}catch{n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":{var r=h.indexOf("-->")!==-1;if(!h||r&&(e=!0)){n.oncue&&n.cue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}if(n.cue===null)continue;n.cue.text&&(n.cue.text+=`
`),n.cue.text+=h}continue;case"BADCUE":h||(n.state="ID")}}}catch{n.state==="CUETEXT"&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=n.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(n){l.onparsingerror&&l.onparsingerror(n)}return l.onflush&&l.onflush(),this},_}()},"./src/utils/webvtt-parser.ts":(W,B,L)=>{L.r(B),L.d(B,{generateCueId:()=>E,parseWebVTT:()=>y});var b=L("./src/polyfills/number.ts"),D=L("./src/utils/vttparser.ts"),P=L("./src/demux/id3.ts"),I=L("./src/utils/timescale-conversion.ts"),M=L("./src/remux/mp4-remuxer.ts"),A=/\r\n|\n\r|\n|\r/g,x=function(l,n,t){return t===void 0&&(t=0),l.slice(t,t+n.length)===n},S=function(l){var n=parseInt(l.slice(-3)),t=parseInt(l.slice(-6,-4)),u=parseInt(l.slice(-9,-7)),h=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,b.isFiniteNumber)(n)||!(0,b.isFiniteNumber)(t)||!(0,b.isFiniteNumber)(u)||!(0,b.isFiniteNumber)(h))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return n+=1e3*t,n+=60*1e3*u,n+=60*60*1e3*h,n},m=function(l){for(var n=5381,t=l.length;t;)n=n*33^l.charCodeAt(--t);return(n>>>0).toString()};function E(p,l,n){return m(p.toString())+m(l.toString())+m(n)}var _=function(l,n,t){var u=l[n],h=l[u.prevCC];if(!h||!h.new&&u.new){l.ccOffset=l.presentationOffset=u.start,u.new=!1;return}for(;(i=h)!==null&&i!==void 0&&i.new;){var i;l.ccOffset+=u.start-h.start,u.new=!1,u=h,h=l[u.prevCC]}l.presentationOffset=t};function y(p,l,n,t,u,h,i,e){var r=new D.VTTParser,f=(0,P.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(A,`
`).split(`
`),o=[],v=(0,I.toMpegTsClockFromTimescale)(l,n),s="00:00.000",c=0,d=0,a,g=!0;r.oncue=function(T){var R=t[u],C=t.ccOffset,O=(c-v)/9e4;R!=null&&R.new&&(d!==void 0?C=t.ccOffset=R.start:_(t,u,O)),O&&(C=O-t.presentationOffset);var F=T.endTime-T.startTime,U=(0,M.normalizePts)((T.startTime+C-d)*9e4,h*9e4)/9e4;T.startTime=Math.max(U,0),T.endTime=Math.max(U+F,0);var k=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(k)),T.id||(T.id=E(T.startTime,T.endTime,k)),T.endTime>0&&o.push(T)},r.onparsingerror=function(T){a=T},r.onflush=function(){if(a){e(a);return}i(o)},f.forEach(function(T){if(g)if(x(T,"X-TIMESTAMP-MAP=")){g=!1,T.slice(16).split(",").forEach(function(R){x(R,"LOCAL:")?s=R.slice(6):x(R,"MPEGTS:")&&(c=parseInt(R.slice(7)))});try{d=S(s)/1e3}catch(R){a=R}return}else T===""&&(g=!1);r.parse(T+`
`)}),r.flush()}},"./src/utils/xhr-loader.ts":(W,B,L)=>{L.r(B),L.d(B,{default:()=>M});var b=L("./src/utils/logger.ts"),D=L("./src/loader/load-stats.ts"),P=/^age:\s*[\d.]+\s*$/m,I=function(){function A(S){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=S?S.xhrSetup:null,this.stats=new D.LoadStats,this.retryDelay=0}var x=A.prototype;return x.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},x.abortInternal=function(){var m=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),m&&(m.onreadystatechange=null,m.onprogress=null,m.readyState!==4&&(this.stats.aborted=!0,m.abort()))},x.abort=function(){var m;this.abortInternal(),(m=this.callbacks)!==null&&m!==void 0&&m.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},x.load=function(m,E,_){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=m,this.config=E,this.callbacks=_,this.retryDelay=E.retryDelay,this.loadInternal()},x.loadInternal=function(){var m=this.config,E=this.context;if(m){var _=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var p=this.xhrSetup;try{if(p)try{p(_,E.url)}catch{_.open("GET",E.url,!0),p(_,E.url)}_.readyState||_.open("GET",E.url,!0);var l=this.context.headers;if(l)for(var n in l)_.setRequestHeader(n,l[n])}catch(t){this.callbacks.onError({code:_.status,text:t.message},E,_);return}E.rangeEnd&&_.setRequestHeader("Range","bytes="+E.rangeStart+"-"+(E.rangeEnd-1)),_.onreadystatechange=this.readystatechange.bind(this),_.onprogress=this.loadprogress.bind(this),_.responseType=E.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout),_.send()}},x.readystatechange=function(){var m=this.context,E=this.loader,_=this.stats;if(!(!m||!E)){var y=E.readyState,p=this.config;if(!_.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),_.loading.first===0&&(_.loading.first=Math.max(self.performance.now(),_.loading.start)),y===4){E.onreadystatechange=null,E.onprogress=null;var l=E.status,n=E.responseType==="arraybuffer";if(l>=200&&l<300&&(n&&E.response||E.responseText!==null)){_.loading.end=Math.max(self.performance.now(),_.loading.first);var t,u;if(n?(t=E.response,u=t.byteLength):(t=E.responseText,u=t.length),_.loaded=_.total=u,!this.callbacks)return;var h=this.callbacks.onProgress;if(h&&h(_,m,t,E),!this.callbacks)return;var i={url:E.responseURL,data:t};this.callbacks.onSuccess(i,_,m,E)}else _.retry>=p.maxRetry||l>=400&&l<499?(b.logger.error(l+" while loading "+m.url),this.callbacks.onError({code:l,text:E.statusText},m,E)):(b.logger.warn(l+" while loading "+m.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),_.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},x.loadtimeout=function(){b.logger.warn("timeout while loading "+this.context.url);var m=this.callbacks;m&&(this.abortInternal(),m.onTimeout(this.stats,this.context,this.loader))},x.loadprogress=function(m){var E=this.stats;E.loaded=m.loaded,m.lengthComputable&&(E.total=m.total)},x.getCacheAge=function(){var m=null;if(this.loader&&P.test(this.loader.getAllResponseHeaders())){var E=this.loader.getResponseHeader("age");m=E?parseFloat(E):null}return m},A}();const M=I},"./node_modules/eventemitter3/index.js":W=>{var B=Object.prototype.hasOwnProperty,L="~";function b(){}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(L=!1));function D(A,x,S){this.fn=A,this.context=x,this.once=S||!1}function P(A,x,S,m,E){if(typeof S!="function")throw new TypeError("The listener must be a function");var _=new D(S,m||A,E),y=L?L+x:x;return A._events[y]?A._events[y].fn?A._events[y]=[A._events[y],_]:A._events[y].push(_):(A._events[y]=_,A._eventsCount++),A}function I(A,x){--A._eventsCount===0?A._events=new b:delete A._events[x]}function M(){this._events=new b,this._eventsCount=0}M.prototype.eventNames=function(){var x=[],S,m;if(this._eventsCount===0)return x;for(m in S=this._events)B.call(S,m)&&x.push(L?m.slice(1):m);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(S)):x},M.prototype.listeners=function(x){var S=L?L+x:x,m=this._events[S];if(!m)return[];if(m.fn)return[m.fn];for(var E=0,_=m.length,y=new Array(_);E<_;E++)y[E]=m[E].fn;return y},M.prototype.listenerCount=function(x){var S=L?L+x:x,m=this._events[S];return m?m.fn?1:m.length:0},M.prototype.emit=function(x,S,m,E,_,y){var p=L?L+x:x;if(!this._events[p])return!1;var l=this._events[p],n=arguments.length,t,u;if(l.fn){switch(l.once&&this.removeListener(x,l.fn,void 0,!0),n){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,S),!0;case 3:return l.fn.call(l.context,S,m),!0;case 4:return l.fn.call(l.context,S,m,E),!0;case 5:return l.fn.call(l.context,S,m,E,_),!0;case 6:return l.fn.call(l.context,S,m,E,_,y),!0}for(u=1,t=new Array(n-1);u<n;u++)t[u-1]=arguments[u];l.fn.apply(l.context,t)}else{var h=l.length,i;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(x,l[u].fn,void 0,!0),n){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,S);break;case 3:l[u].fn.call(l[u].context,S,m);break;case 4:l[u].fn.call(l[u].context,S,m,E);break;default:if(!t)for(i=1,t=new Array(n-1);i<n;i++)t[i-1]=arguments[i];l[u].fn.apply(l[u].context,t)}}return!0},M.prototype.on=function(x,S,m){return P(this,x,S,m,!1)},M.prototype.once=function(x,S,m){return P(this,x,S,m,!0)},M.prototype.removeListener=function(x,S,m,E){var _=L?L+x:x;if(!this._events[_])return this;if(!S)return I(this,_),this;var y=this._events[_];if(y.fn)y.fn===S&&(!E||y.once)&&(!m||y.context===m)&&I(this,_);else{for(var p=0,l=[],n=y.length;p<n;p++)(y[p].fn!==S||E&&!y[p].once||m&&y[p].context!==m)&&l.push(y[p]);l.length?this._events[_]=l.length===1?l[0]:l:I(this,_)}return this},M.prototype.removeAllListeners=function(x){var S;return x?(S=L?L+x:x,this._events[S]&&I(this,S)):(this._events=new b,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=L,M.EventEmitter=M,W.exports=M},"./node_modules/url-toolkit/src/url-toolkit.js":function(W){(function(B){var L=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,b=/^(?=([^\/?#]*))\1([^]*)$/,D=/(?:\/|^)\.(?=\/)/g,P=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(M,A,x){if(x=x||{},M=M.trim(),A=A.trim(),!A){if(!x.alwaysNormalize)return M;var S=I.parseURL(M);if(!S)throw new Error("Error trying to parse base URL.");return S.path=I.normalizePath(S.path),I.buildURLFromParts(S)}var m=I.parseURL(A);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return x.alwaysNormalize?(m.path=I.normalizePath(m.path),I.buildURLFromParts(m)):A;var E=I.parseURL(M);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var _=b.exec(E.path);E.netLoc=_[1],E.path=_[2]}E.netLoc&&!E.path&&(E.path="/");var y={scheme:E.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(y.netLoc=E.netLoc,m.path[0]!=="/"))if(!m.path)y.path=E.path,m.params||(y.params=E.params,m.query||(y.query=E.query));else{var p=E.path,l=p.substring(0,p.lastIndexOf("/")+1)+m.path;y.path=I.normalizePath(l)}return y.path===null&&(y.path=x.alwaysNormalize?I.normalizePath(m.path):m.path),I.buildURLFromParts(y)},parseURL:function(M){var A=L.exec(M);return A?{scheme:A[1]||"",netLoc:A[2]||"",path:A[3]||"",params:A[4]||"",query:A[5]||"",fragment:A[6]||""}:null},normalizePath:function(M){for(M=M.split("").reverse().join("").replace(D,"");M.length!==(M=M.replace(P,"")).length;);return M.split("").reverse().join("")},buildURLFromParts:function(M){return M.scheme+M.netLoc+M.path+M.params+M.query+M.fragment}};W.exports=I})()}},xe={};function ie(W){var B=xe[W];if(B!==void 0)return B.exports;var L=xe[W]={exports:{}};return De[W].call(L.exports,L,L.exports,ie),L.exports}ie.m=De,ie.n=W=>{var B=W&&W.__esModule?()=>W.default:()=>W;return ie.d(B,{a:B}),B},ie.d=(W,B)=>{for(var L in B)ie.o(B,L)&&!ie.o(W,L)&&Object.defineProperty(W,L,{enumerable:!0,get:B[L]})},ie.o=(W,B)=>Object.prototype.hasOwnProperty.call(W,B),ie.r=W=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(W,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(W,"__esModule",{value:!0})};var Ae=ie("./src/hls.ts");return Ae=Ae.default,Ae})())})(we);const tt=et(we.exports),rt=Je({__proto__:null,default:tt},[we.exports]);export{rt as h};
